<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Business Incubator Hub</title>
    
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Security & Cryptography Libraries -->
    <script src="https://unpkg.com/libsodium-wrappers@0.7.11/dist/libsodium.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    
    <!-- EmailJS for sending emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        .modal {
            display: none;
        }
        .modal.active {
            display: flex;
        }
        .research-tab-content {
            display: none;
        }
        .research-tab-content.active {
            display: block;
        }
        .data-card {
            transition: all 0.3s ease;
        }
        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        .last-updated {
            color: #9ca3af;
        }
        .overdue {
            color: #ef4444;
        }
        .due-soon {
            color: #f59e0b;
        }
        .up-to-date {
            color: #10b981;
        }
        .reminder-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .financial-view-toggle-btn {
            background-color: #1f2937;
            border: 1px solid #374151;
            color: #9ca3af;
            transition: all 0.2s ease;
        }
        .financial-view-toggle-btn.active {
            background-color: #0d9488;
            color: #fff;
            border-color: #0d9488;
        }
        .financial-view-toggle-btn:hover:not(.active) {
            background-color: #374151;
            color: #fff;
        }
        .ideas-view-btn {
            transition: all 0.2s ease;
        }
        .ideas-view-btn.active {
            background-color: #0d9488;
            color: #fff !important;
        }
        .ideas-view-btn:hover:not(.active) {
            background-color: #374151;
        }
        .legal-tab-content {
            display: none;
        }
        .legal-tab-content.active {
            display: block;
        }
        .legal-tab-btn.active {
            color: #fff;
            border-color: #0d9488;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Modern Chat App Styles */
        
        /* Dark mode support */
        .dark {
            color-scheme: dark;
        }
        
        /* Chat List Styles */
        .chat-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .chat-item:hover {
            transform: translateX(2px);
        }
        
        .chat-item.active {
            background-color: #ecfdf5;
            border-left: 4px solid #14b8a6;
        }
        
        .dark .chat-item.active {
            background-color: #065f46;
        }
        
        .chat-filter-tab {
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }
        
        .chat-filter-tab.active {
            color: #14b8a6;
            border-bottom-color: #14b8a6;
        }
        
        .chat-filter-tab:hover:not(.active) {
            color: #6b7280;
        }
        
        /* Story circles */
        .story-circle {
            background: linear-gradient(45deg, #8b5cf6, #ec4899);
            padding: 2px;
            border-radius: 50%;
        }
        
        /* Message bubbles */
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .message-bubble.incoming {
            background-color: #ffffff;
            border-radius: 18px;
            border-top-left-radius: 4px;
        }
        
        .dark .message-bubble.incoming {
            background-color: #374151;
        }
        
        .message-bubble.outgoing {
            background-color: #14b8a6;
            border-radius: 18px;
            border-top-right-radius: 4px;
            color: white;
            margin-left: auto;
        }
        
        /* Voice message waveform */
        .voice-waveform {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .voice-bar {
            width: 2px;
            background-color: #14b8a6;
            border-radius: 1px;
            transition: all 0.3s ease;
        }
        
        .voice-bar.played {
            background-color: #059669;
        }
        
        /* Input area */
        .modern-input {
            background-color: #f3f4f6;
            border-radius: 20px;
            transition: all 0.2s ease;
        }
        
        .dark .modern-input {
            background-color: #374151;
        }
        
        .modern-input:focus-within {
            box-shadow: 0 0 0 2px #14b8a6;
        }
        
        /* Attachment menu */
        .attachment-menu {
            animation: slideUp 0.2s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Status indicators */
        .status-online {
            background-color: #10b981;
        }
        
        .status-away {
            background-color: #f59e0b;
        }
        
        .status-busy {
            background-color: #ef4444;
        }
        
        .status-offline {
            background-color: #6b7280;
        }
        
        /* File preview */
        .file-preview-item {
            transition: all 0.2s ease;
            border-radius: 8px;
            padding: 8px;
            background-color: #f9fafb;
        }
        
        .dark .file-preview-item {
            background-color: #1f2937;
        }
        
        .file-preview-item:hover {
            background-color: #f3f4f6;
        }
        
        .dark .file-preview-item:hover {
            background-color: #374151;
        }
        
        /* Recording indicator */
        .recording-pulse {
            animation: recordingPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes recordingPulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }
        
        /* Chat background pattern */
        .chat-background {
            background-image: radial-gradient(circle, #f3f4f6 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }
        
        .dark .chat-background {
            background-image: radial-gradient(circle, #374151 1px, transparent 1px);
        }
        
        /* Smooth scrolling */
        .smooth-scroll {
            scroll-behavior: smooth;
        }
        
        /* Message reactions */
        .reaction-bubble {
            animation: reactionPop 0.3s ease-out;
        }
        
        @keyframes reactionPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Typing indicator */
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: #9ca3af;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        
        .typing-indicator .animate-bounce {
            animation: bounce 1.4s infinite;
        }
        
        .typing-indicator .animate-bounce:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .typing-indicator .animate-bounce:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        
        #chat-input {
            min-height: 3rem;
            max-height: 7.5rem;
            transition: all 0.2s ease;
        }
        
        #emoji-picker {
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
        }
        
        #emoji-picker button:hover {
            transform: scale(1.1);
            transition: transform 0.1s ease;
        }
        
        .file-preview-item {
            transition: all 0.2s ease;
        }
        
        .file-preview-item:hover {
            background-color: #4b5563;
        }
        
        /* Online status indicators */
        .status-online {
            background-color: #10b981;
        }
        
        .status-away {
            background-color: #f59e0b;
        }
        
        .status-busy {
            background-color: #ef4444;
        }
        
        .status-offline {
            background-color: #6b7280;
        }
        
        /* Message reactions hover effects */
        .message-reactions span:hover {
            background-color: #4b5563;
            transform: scale(1.05);
            transition: all 0.1s ease;
        }
        
        /* Chat scroll smooth */
        #chat-messages {
            scroll-behavior: smooth;
        }
        
        /* File upload progress */
        #upload-progress-bar {
            transition: width 0.3s ease;
        }
        
        /* Fix inline styles */
        .chat-background {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMSIgZmlsbD0iI2Y5ZmFmYiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KPC9zdmc+Cg==');
            background-repeat: repeat;
        }
        
        .audio-bar-6 { height: 6px; }
        .audio-bar-8 { height: 8px; }
        .audio-bar-10 { height: 10px; }
        .audio-bar-12 { height: 12px; }
        .audio-bar-14 { height: 14px; }
        
        .hidden-element { display: none; }
        
        .animate-delay-200 { animation-delay: 0.2s; }
        .animate-delay-400 { animation-delay: 0.4s; }
        
        .progress-0 { width: 0%; }
        .progress-10 { width: 10%; }
        .progress-15 { width: 15%; }
        .progress-20 { width: 20%; }
        .progress-35 { width: 35%; }
        .progress-45 { width: 45%; }
        .progress-54 { width: 54%; }
        .progress-60 { width: 60%; }
        .progress-67 { width: 67%; }
        .progress-68 { width: 68%; }
        .progress-72 { width: 72%; }
        .progress-82 { width: 82%; }
        .progress-85 { width: 85%; }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 min-h-screen">
    <div class="flex">
        <!-- Left Sidebar Navigation -->
        <nav class="w-64 bg-gray-800 min-h-screen fixed left-0 top-0 p-4">
            <div class="mb-8">
                <h1 class="text-xl font-bold text-teal-500">Family Business Hub</h1>
            </div>
            
            <ul class="space-y-2">
                <li>
                    <a href="#dashboard" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="dashboard">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="#ideas" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="ideas">
                        <i data-lucide="lightbulb" class="w-5 h-5 mr-3"></i>
                        Ideas
                    </a>
                </li>
                <li>
                    <a href="#planner" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="planner">
                        <i data-lucide="file-text" class="w-5 h-5 mr-3"></i>
                        Business Planner
                    </a>
                </li>
                <li>
                    <a href="#research" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="research">
                        <i data-lucide="search" class="w-5 h-5 mr-3"></i>
                        AI Research Hub
                    </a>
                </li>
                <li>
                    <a href="#financial" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="financial">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-3"></i>
                        Financial Dashboard
                    </a>
                </li>
                <li>
                    <a href="#data-center" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="data-center">
                        <i data-lucide="database" class="w-5 h-5 mr-3"></i>
                        Data Update Center
                    </a>
                </li>
                <li>
                    <a href="#tasks" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="tasks">
                        <i data-lucide="clipboard-check" class="w-5 h-5 mr-3"></i>
                        Task Management
                    </a>
                </li>
                <li>
                    <a href="#legal" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="legal">
                        <i data-lucide="scale" class="w-5 h-5 mr-3"></i>
                        Legal & Financial
                    </a>
                </li>
                <li>
                    <a href="#milestones" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="milestones">
                        <i data-lucide="flag" class="w-5 h-5 mr-3"></i>
                        Milestone Tracker
                    </a>
                </li>
                <li>
                    <a href="#chat" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="chat">
                        <i data-lucide="message-square" class="w-5 h-5 mr-3"></i>
                        Chat
                    </a>
                </li>
                <li>
                    <a href="#profile" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="profile">
                        <i data-lucide="user" class="w-5 h-5 mr-3"></i>
                        My Profile
                    </a>
                </li>
                <li>
                    <a href="#user-management" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="user-management">
                        <i data-lucide="users" class="w-5 h-5 mr-3"></i>
                        User Management
                    </a>
                </li>
                <li>
                    <a href="#settings" class="nav-link flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors" data-page="settings">
                        <i data-lucide="settings" class="w-5 h-5 mr-3"></i>
                        Settings
                    </a>
                </li>
                
                <!-- Admin Access (Secured) -->
                <li class="mt-4 pt-4 border-t border-gray-700">
                    <a href="#admin" class="nav-link flex items-center p-3 rounded-lg hover:bg-red-700 bg-red-800/30 border border-red-700/50 transition-colors" data-page="admin" onclick="checkAdminAccess(event)">
                        <i data-lucide="shield-check" class="w-5 h-5 mr-3 text-red-400"></i>
                        <span class="text-red-300">System Admin</span>
                        <i data-lucide="lock" class="w-4 h-4 ml-auto text-red-400"></i>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="ml-64 flex-1 p-6 overflow-y-auto">
            <!-- Dashboard Page -->
            <section id="dashboard" class="page-section active">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white">Dashboard</h2>
                    <button onclick="openNewIdeaModal()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                        New Idea
                    </button>
                </div>
                
                <!-- Dashboard Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Total Ideas</p>
                                <p id="total-ideas-count" class="text-2xl font-bold text-white">5</p>
                            </div>
                            <div class="w-12 h-12 bg-teal-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="lightbulb" class="w-6 h-6 text-teal-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Total Votes</p>
                                <p id="total-votes-count" class="text-2xl font-bold text-white">48</p>
                            </div>
                            <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="thumbs-up" class="w-6 h-6 text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Active Discussions</p>
                                <p id="active-discussions-count" class="text-2xl font-bold text-white">12</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="message-circle" class="w-6 h-6 text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Completion Rate</p>
                                <p id="completion-rate" class="text-2xl font-bold text-white">25%</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="target" class="w-6 h-6 text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Dashboard Content -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Four-Column Kanban Board -->
                    <div class="lg:col-span-2">
                        <h3 class="text-xl font-semibold text-white mb-4">Ideas Pipeline</h3>
                        <div class="grid grid-cols-4 gap-4">
                            <div class="bg-gray-800 rounded-lg p-4">
                                <h3 class="text-lg font-semibold text-white mb-4">New Ideas</h3>
                                <div id="new-ideas-column" class="space-y-3">
                                    <!-- Ideas will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="bg-gray-800 rounded-lg p-4">
                                <h3 class="text-lg font-semibold text-white mb-4">Researching</h3>
                                <div id="researching-column" class="space-y-3">
                                    <!-- Ideas will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="bg-gray-800 rounded-lg p-4">
                                <h3 class="text-lg font-semibold text-white mb-4">Planning</h3>
                                <div id="planning-column" class="space-y-3">
                                    <!-- Ideas will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="bg-gray-800 rounded-lg p-4">
                                <h3 class="text-lg font-semibold text-white mb-4">Approved</h3>
                                <div id="approved-column" class="space-y-3">
                                    <!-- Ideas will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Donut Chart & Stats -->
                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Idea Votes</h3>
                        <div class="flex items-center justify-center mb-6">
                            <div class="relative w-48 h-48">
                                <svg id="donut-chart" class="w-full h-full" viewBox="0 0 200 200">
                                    <!-- Donut chart will be populated by JavaScript -->
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <p id="chart-center-number" class="text-2xl font-bold text-white">48</p>
                                        <p class="text-sm text-gray-400">Total Votes</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="ideas-legend" class="space-y-2 max-h-40 overflow-y-auto">
                            <!-- Legend will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Idea Dashboard Page -->
            <section id="idea-dashboard" class="page-section">
                <div class="mb-6">
                    <button onclick="navigateToPage('dashboard')" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center mb-4">
                        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                        Back to Main Dashboard
                    </button>
                    <h2 id="idea-title" class="text-3xl font-bold text-white mb-2">Idea Title</h2>
                    <p id="idea-description" class="text-gray-400">Idea description will appear here</p>
                </div>

                <!-- Info Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Idea Details -->
                    <div class="lg:col-span-2 grid grid-cols-3 gap-4">
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Status</h3>
                            <p id="idea-status" class="text-white font-semibold">New</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Submitted By</h3>
                            <p id="idea-submitter" class="text-white font-semibold">User</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Date Submitted</h3>
                            <p id="idea-date" class="text-white font-semibold">Today</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Priority</h3>
                            <p id="idea-priority" class="text-white font-semibold">Medium</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Category</h3>
                            <p id="idea-category" class="text-white font-semibold">Technology</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Budget</h3>
                            <p id="idea-budget" class="text-white font-semibold">$25,000</p>
                        </div>
                    </div>

                    <!-- Voting Section -->
                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Community Votes</h3>
                        
                        <!-- Voting Buttons -->
                        <div class="flex items-center justify-center mb-6">
                            <button id="idea-upvote-btn" onclick="voteOnCurrentIdea('up')" class="flex items-center space-x-2 bg-green-600/20 hover:bg-green-600/30 text-green-400 px-4 py-2 rounded-l-lg border border-green-500/30 transition-colors">
                                <i data-lucide="chevron-up" class="w-5 h-5"></i>
                                <span id="idea-upvotes-count">0</span>
                            </button>
                            <button id="idea-downvote-btn" onclick="voteOnCurrentIdea('down')" class="flex items-center space-x-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 px-4 py-2 rounded-r-lg border border-red-500/30 transition-colors">
                                <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                <span id="idea-downvotes-count">0</span>
                            </button>
                        </div>

                        <!-- Donut Chart -->
                        <div class="flex items-center justify-center mb-4">
                            <div class="relative w-32 h-32">
                                <svg id="idea-donut-chart" class="w-full h-full" viewBox="0 0 120 120">
                                    <!-- Chart will be populated by JavaScript -->
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <p id="idea-net-votes" class="text-lg font-bold text-white">+10</p>
                                        <p class="text-xs text-gray-400">Net Votes</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vote Statistics -->
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                    <span class="text-gray-300">Upvotes</span>
                                </div>
                                <span id="idea-upvotes-display" class="text-white font-medium">12</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                                    <span class="text-gray-300">Downvotes</span>
                                </div>
                                <span id="idea-downvotes-display" class="text-white font-medium">2</span>
                            </div>
                            <div class="flex items-center justify-between pt-2 border-t border-gray-700">
                                <span class="text-gray-300">Total Votes</span>
                                <span id="idea-total-votes" class="text-white font-medium">14</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Linked Sections -->
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-lg p-6 hover:bg-gray-700 cursor-pointer transition-colors" onclick="navigateToPage('planner')">
                        <i data-lucide="file-text" class="w-8 h-8 text-teal-500 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white mb-2">Business Planner</h3>
                        <p class="text-gray-400">Create a comprehensive business plan</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-6 hover:bg-gray-700 cursor-pointer transition-colors" onclick="navigateToPage('milestones')">
                        <i data-lucide="flag" class="w-8 h-8 text-teal-500 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white mb-2">Milestones</h3>
                        <p class="text-gray-400">Track project progress and goals</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-6 hover:bg-gray-700 cursor-pointer transition-colors" onclick="navigateToPage('chat')">
                        <i data-lucide="message-square" class="w-8 h-8 text-teal-500 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white mb-2">Chat</h3>
                        <p class="text-gray-400">Discuss with family members</p>
                    </div>
                </div>

                <!-- Financial Overview Panel - KEY FEATURE -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-white mb-6">Financial Overview</h3>
                    
                    <div class="grid grid-cols-2 gap-8">
                        <!-- Setup Costs -->
                        <div>
                            <h4 class="text-lg font-semibold text-white mb-4">Setup Costs</h4>
                            <div class="space-y-2 mb-4">
                                <div class="flex">
                                    <input type="text" id="cost-item" placeholder="Cost item" class="flex-1 bg-gray-700 text-white px-3 py-2 rounded-l-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                                    <input type="number" id="cost-amount" placeholder="Amount" class="w-24 bg-gray-700 text-white px-3 py-2 border-t border-b border-gray-600 focus:border-teal-500 focus:outline-none">
                                    <button onclick="addCostItem()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-r-lg">Add</button>
                                </div>
                            </div>
                            <ul id="cost-list" class="space-y-2 mb-4">
                                <!-- Cost items will be added here -->
                            </ul>
                            <div class="border-t border-gray-600 pt-2">
                                <p class="text-lg font-semibold text-white">Total: $<span id="total-cost">0.00</span></p>
                            </div>
                        </div>

                        <!-- Family Funding -->
                        <div>
                            <h4 class="text-lg font-semibold text-white mb-4">Family Funding</h4>
                            <div class="space-y-2 mb-4">
                                <div class="flex">
                                    <input type="text" id="funding-member" placeholder="Family member" class="flex-1 bg-gray-700 text-white px-3 py-2 rounded-l-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                                    <input type="number" id="funding-amount" placeholder="Amount" class="w-24 bg-gray-700 text-white px-3 py-2 border-t border-b border-gray-600 focus:border-teal-500 focus:outline-none">
                                    <button onclick="addFundingItem()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-r-lg">Add</button>
                                </div>
                            </div>
                            <ul id="funding-list" class="space-y-2 mb-4">
                                <!-- Funding items will be added here -->
                            </ul>
                            <div class="border-t border-gray-600 pt-2">
                                <p class="text-lg font-semibold text-white">Total: $<span id="total-funding">0.00</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- ROI Calculator -->
                    <div class="mt-8 border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-white mb-4">ROI Calculator</h4>
                        <div class="grid grid-cols-3 gap-4 items-end">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Total Investment</label>
                                <input type="number" id="total-investment" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Projected Annual Net Profit</label>
                                <input type="number" id="projected-profit" placeholder="0" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" oninput="calculateROI()">
                            </div>
                            <div>
                                <div class="bg-teal-500 text-white px-4 py-2 rounded-lg text-center">
                                    <span class="text-sm font-medium">ROI</span>
                                    <div class="text-xl font-bold"><span id="roi-percentage">0.0</span>%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ideas Page -->
            <section id="ideas" class="page-section">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-white">Family Ideas Hub</h2>
                        <p class="text-gray-400 mt-1">Collaborate, vote, and develop business ideas together</p>
                    </div>
                    <button onclick="openNewIdeaModal()" class="mt-4 sm:mt-0 bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                        Submit New Idea
                    </button>
                </div>

                <!-- Search Bar -->
                <div class="bg-gray-800 rounded-lg p-4 mb-4">
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"></i>
                        <input 
                            type="text" 
                            id="ideas-search" 
                            placeholder="Search ideas, descriptions, tags..." 
                            class="w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                        >
                    </div>
                </div>
                
                <!-- Filters and Sorting -->
                <div class="bg-gray-800 rounded-lg p-4 mb-6">
                    <div class="flex flex-wrap items-center gap-4">
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-400">Filter by:</label>
                            <select id="ideas-status-filter" class="bg-gray-700 border border-gray-600 rounded px-3 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="all">All Status</option>
                                <option value="New Ideas">New Ideas</option>
                                <option value="Researching">Researching</option>
                                <option value="Planning">Planning</option>
                                <option value="Approved">Approved</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-400">Category:</label>
                            <select id="ideas-category-filter" class="bg-gray-700 border border-gray-600 rounded px-3 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="all">All Categories</option>
                                <option value="Technology">Technology</option>
                                <option value="Food & Beverage">Food & Beverage</option>
                                <option value="Retail">Retail</option>
                                <option value="Service">Service</option>
                                <option value="Agriculture">Agriculture</option>
                                <option value="Education">Education</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-400">Sort by:</label>
                            <select id="ideas-sort" class="bg-gray-700 border border-gray-600 rounded px-3 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="votes">Most Votes</option>
                                <option value="recent">Most Recent</option>
                                <option value="comments">Most Comments</option>
                                <option value="priority">Highest Priority</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2 ml-auto">
                            <label class="text-sm text-gray-400">View:</label>
                            <div class="flex bg-gray-700 rounded overflow-hidden">
                                <button id="ideas-grid-view" onclick="toggleIdeasView('grid')" class="ideas-view-btn active px-3 py-1 text-gray-400 hover:text-white transition-colors" title="Grid View">
                                    <i data-lucide="grid" class="w-4 h-4"></i>
                                </button>
                                <button id="ideas-list-view" onclick="toggleIdeasView('list')" class="ideas-view-btn px-3 py-1 text-gray-400 hover:text-white transition-colors" title="List View">
                                    <i data-lucide="list" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ideas Container -->
                <div id="ideas-grid-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Ideas will be populated by JavaScript -->
                </div>
                
                <div id="ideas-list-container" class="hidden space-y-4">
                    <!-- List view will be populated by JavaScript -->
                </div>
            </section>

            <!-- Business Planner Page -->
            <section id="planner" class="page-section">
                <h2 class="text-3xl font-bold text-white mb-6">Interactive Business Plan Builder</h2>
                <p class="text-gray-400 mb-8">Create a comprehensive business plan with AI-powered suggestions and templates</p>
                
                <!-- Business Idea Selection -->
                <div class="bg-gray-800 rounded-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold text-white mb-4">Business Idea Selection</h3>
                    <div class="flex gap-4 mb-4">
                        <select id="planner-idea-select" class="flex-1 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            <option value="">-- Select a Business Idea --</option>
                            <option value="family-catering-service">Family Catering Service</option>
                            <option value="online-tutoring-platform">Online Tutoring Platform</option>
                            <option value="handmade-crafts-shop">Handmade Crafts Shop</option>
                            <option value="farm-to-table">Johnson Farm-to-Table</option>
                            <option value="custom">Add Custom Idea</option>
                        </select>
                        <button onclick="addCustomIdea()" class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-2 rounded-lg flex items-center">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Custom
                        </button>
                    </div>
                    <div id="selected-idea-info" class="hidden bg-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-white mb-2" id="idea-name-display">Business Idea Name</h4>
                        <p class="text-gray-300 text-sm" id="idea-description-display">Business description will appear here</p>
                    </div>
                </div>

                <!-- Business Plan Sections -->
                <div class="space-y-6">
                    <!-- Executive Summary -->
                    <div class="bg-gray-800 rounded-lg">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-white">1.0 Executive Summary</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="generateSuggestion('executive')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                        AI Suggestions
                                    </button>
                                    <button onclick="toggleSection('executive')" class="text-gray-400 hover:text-white">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="executive-content" class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Business Concept</label>
                                <textarea id="business-concept" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Describe your core business concept and what makes it unique..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Target Market</label>
                                <textarea id="target-market" class="w-full h-20 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Who are your ideal customers?"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Competitive Advantage</label>
                                <textarea id="competitive-advantage" class="w-full h-20 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="What sets you apart from competitors?"></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Financial Highlights</label>
                                    <input type="text" id="financial-highlights" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" placeholder="e.g., Break-even in 18 months">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Funding Required</label>
                                    <input type="text" id="funding-required" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" placeholder="e.g., $50,000">
                                </div>
                            </div>
                            <div id="executive-suggestions" class="hidden bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-300 mb-2">AI Suggestions</h4>
                                <div class="text-blue-200 text-sm"></div>
                            </div>
                            
                            <!-- Goal Breakdown Section -->
                            <div class="border-t border-gray-600 pt-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-white">Goal Breakdown</h4>
                                    <button onclick="addGoal()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                        Add Goal
                                    </button>
                                </div>
                                <div id="goals-container" class="space-y-4">
                                    <!-- Goals will be added here dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Analysis -->
                    <div class="bg-gray-800 rounded-lg">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-white">2.0 Market Analysis</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="generateSuggestion('market')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                        AI Suggestions
                                    </button>
                                    <button onclick="toggleSection('market')" class="text-gray-400 hover:text-white">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="market-content" class="hidden p-6 space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Industry Overview</label>
                                <textarea id="industry-overview" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Describe the industry size, growth trends, and key characteristics..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Target Customer Analysis</label>
                                <textarea id="target-customer" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Define your customer segments, their needs, and buying behavior..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Competitive Landscape</label>
                                <textarea id="competitive-landscape" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Identify main competitors, their strengths/weaknesses, and market positioning..."></textarea>
                            </div>
                            
                            <!-- SWOT Analysis Section -->
                            <div class="border-t border-gray-600 pt-6">
                                <h4 class="text-lg font-semibold text-white mb-4">SWOT Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Strengths -->
                                    <div class="bg-green-600/10 border border-green-500/20 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <label class="text-lg font-semibold text-green-300 flex items-center">
                                                <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i>
                                                Strengths
                                            </label>
                                            <button onclick="generateSWOTSuggestion('strengths')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                                                <i data-lucide="sparkles" class="w-3 h-3 mr-1 inline"></i>
                                                AI Suggest
                                            </button>
                                        </div>
                                        <textarea id="swot-strengths" rows="4" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-green-500 focus:outline-none resize-none" placeholder="List your business's internal strengths and advantages..."></textarea>
                                        <div id="strengths-suggestions" class="hidden mt-3 bg-green-600/10 border border-green-500/20 rounded-lg p-3">
                                            <h5 class="font-semibold text-green-300 mb-2 text-sm">AI Suggestions</h5>
                                            <div class="text-green-200 text-sm"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Weaknesses -->
                                    <div class="bg-red-600/10 border border-red-500/20 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <label class="text-lg font-semibold text-red-300 flex items-center">
                                                <i data-lucide="trending-down" class="w-5 h-5 mr-2"></i>
                                                Weaknesses
                                            </label>
                                            <button onclick="generateSWOTSuggestion('weaknesses')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                                <i data-lucide="sparkles" class="w-3 h-3 mr-1 inline"></i>
                                                AI Suggest
                                            </button>
                                        </div>
                                        <textarea id="swot-weaknesses" rows="4" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-red-500 focus:outline-none resize-none" placeholder="Identify internal limitations and areas for improvement..."></textarea>
                                        <div id="weaknesses-suggestions" class="hidden mt-3 bg-red-600/10 border border-red-500/20 rounded-lg p-3">
                                            <h5 class="font-semibold text-red-300 mb-2 text-sm">AI Suggestions</h5>
                                            <div class="text-red-200 text-sm"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Opportunities -->
                                    <div class="bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <label class="text-lg font-semibold text-blue-300 flex items-center">
                                                <i data-lucide="target" class="w-5 h-5 mr-2"></i>
                                                Opportunities
                                            </label>
                                            <button onclick="generateSWOTSuggestion('opportunities')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                                <i data-lucide="sparkles" class="w-3 h-3 mr-1 inline"></i>
                                                AI Suggest
                                            </button>
                                        </div>
                                        <textarea id="swot-opportunities" rows="4" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none resize-none" placeholder="Identify external opportunities and market possibilities..."></textarea>
                                        <div id="opportunities-suggestions" class="hidden mt-3 bg-blue-600/10 border border-blue-500/20 rounded-lg p-3">
                                            <h5 class="font-semibold text-blue-300 mb-2 text-sm">AI Suggestions</h5>
                                            <div class="text-blue-200 text-sm"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Threats -->
                                    <div class="bg-yellow-600/10 border border-yellow-500/20 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <label class="text-lg font-semibold text-yellow-300 flex items-center">
                                                <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                                                Threats
                                            </label>
                                            <button onclick="generateSWOTSuggestion('threats')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">
                                                <i data-lucide="sparkles" class="w-3 h-3 mr-1 inline"></i>
                                                AI Suggest
                                            </button>
                                        </div>
                                        <textarea id="swot-threats" rows="4" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-yellow-500 focus:outline-none resize-none" placeholder="Identify external threats and potential challenges..."></textarea>
                                        <div id="threats-suggestions" class="hidden mt-3 bg-yellow-600/10 border border-yellow-500/20 rounded-lg p-3">
                                            <h5 class="font-semibold text-yellow-300 mb-2 text-sm">AI Suggestions</h5>
                                            <div class="text-yellow-200 text-sm"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="market-suggestions" class="hidden bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-300 mb-2">AI Suggestions</h4>
                                <div class="text-blue-200 text-sm"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Marketing & Sales Strategy -->
                    <div class="bg-gray-800 rounded-lg">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-white">3.0 Marketing & Sales Strategy</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="generateSuggestion('marketing')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                        AI Suggestions
                                    </button>
                                    <button onclick="toggleSection('marketing')" class="text-gray-400 hover:text-white">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="marketing-content" class="hidden p-6 space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Marketing Mix (4Ps)</label>
                                <textarea id="marketing-mix" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Product/Service, Price, Place (distribution), Promotion strategies..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Sales Strategy</label>
                                <textarea id="sales-strategy" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="How will you acquire and retain customers? Sales process, channels, team..."></textarea>
                            </div>
                            
                            <!-- Marketing Checklist Section -->
                            <div class="border-t border-gray-600 pt-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-white">Marketing Checklist</h4>
                                    <button onclick="addMarketingTask()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                        Add Task
                                    </button>
                                </div>
                                <div id="marketing-checklist" class="space-y-3">
                                    <!-- Default marketing tasks -->
                                    <div class="flex items-center bg-gray-700 rounded-lg p-3">
                                        <input type="checkbox" class="mr-3 h-4 w-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        <div class="flex-1">
                                            <span class="text-white font-medium">Define target customer personas</span>
                                            <p class="text-gray-400 text-sm">Create detailed profiles of ideal customers</p>
                                        </div>
                                        <span class="text-xs text-gray-500 bg-gray-600 px-2 py-1 rounded">High Priority</span>
                                    </div>
                                    
                                    <div class="flex items-center bg-gray-700 rounded-lg p-3">
                                        <input type="checkbox" class="mr-3 h-4 w-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        <div class="flex-1">
                                            <span class="text-white font-medium">Develop brand identity and messaging</span>
                                            <p class="text-gray-400 text-sm">Logo, colors, tagline, brand voice</p>
                                        </div>
                                        <span class="text-xs text-gray-500 bg-gray-600 px-2 py-1 rounded">High Priority</span>
                                    </div>
                                    
                                    <div class="flex items-center bg-gray-700 rounded-lg p-3">
                                        <input type="checkbox" class="mr-3 h-4 w-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        <div class="flex-1">
                                            <span class="text-white font-medium">Create website and online presence</span>
                                            <p class="text-gray-400 text-sm">Professional website, social media profiles</p>
                                        </div>
                                        <span class="text-xs text-gray-500 bg-gray-600 px-2 py-1 rounded">Medium Priority</span>
                                    </div>
                                    
                                    <div class="flex items-center bg-gray-700 rounded-lg p-3">
                                        <input type="checkbox" class="mr-3 h-4 w-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        <div class="flex-1">
                                            <span class="text-white font-medium">Develop content marketing strategy</span>
                                            <p class="text-gray-400 text-sm">Blog posts, social media content, newsletters</p>
                                        </div>
                                        <span class="text-xs text-gray-500 bg-gray-600 px-2 py-1 rounded">Medium Priority</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="marketing-suggestions" class="hidden bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-300 mb-2">AI Suggestions</h4>
                                <div class="text-blue-200 text-sm"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Operations Plan -->
                    <div class="bg-gray-800 rounded-lg">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-white">4.0 Operations Plan</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="generateSuggestion('operations')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                        AI Suggestions
                                    </button>
                                    <button onclick="toggleSection('operations')" class="text-gray-400 hover:text-white">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="operations-content" class="hidden p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Business Operations</label>
                                <textarea class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Day-to-day operations, workflow, quality control, technology needs..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Organizational Structure</label>
                                <textarea class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Team structure, roles and responsibilities, hiring plans..."></textarea>
                            </div>
                            <div id="operations-suggestions" class="hidden bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-300 mb-2">AI Suggestions</h4>
                                <div class="text-blue-200 text-sm"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Projections -->
                    <div class="bg-gray-800 rounded-lg">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-white">5.0 Financial Projections</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="generateSuggestion('financial')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                        AI Suggestions
                                    </button>
                                    <button onclick="toggleSection('financial')" class="text-gray-400 hover:text-white">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="financial-content" class="hidden p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Revenue Model</label>
                                <textarea class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="How will you make money? Pricing strategy, revenue streams..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Financial Forecasts</label>
                                <textarea class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="3-5 year revenue, expense, and profit projections..."></textarea>
                            </div>
                            <div id="financial-suggestions" class="hidden bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-300 mb-2">AI Suggestions</h4>
                                <div class="text-blue-200 text-sm"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Team Structure -->
                    <div class="bg-gray-800 rounded-lg">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-white">6.0 Team Structure</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="generateSuggestion('team')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                        AI Suggestions
                                    </button>
                                    <button onclick="toggleSection('team')" class="text-gray-400 hover:text-white">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="team-content" class="hidden p-6 space-y-6">
                            <div class="flex items-center justify-between">
                                <h4 class="text-lg font-semibold text-white">Team Members</h4>
                                <button onclick="addTeamMember()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i>
                                    Add Team Member
                                </button>
                            </div>
                            <div id="team-container" class="space-y-4">
                                <!-- Team members will be added here dynamically -->
                            </div>
                            <div id="team-suggestions" class="hidden bg-blue-600/10 border border-blue-500/20 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-300 mb-2">AI Suggestions</h4>
                                <div class="text-blue-200 text-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-8 flex justify-between items-center">
                    <button onclick="savePlan()" class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-3 rounded-lg flex items-center">
                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                        Save Plan
                    </button>
                    <div class="flex space-x-4">
                        <button onclick="exportPlan()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            Export PDF
                        </button>
                        <button onclick="sharePlan()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg flex items-center">
                            <i data-lucide="share" class="w-4 h-4 mr-2"></i>
                            Share with Family
                        </button>
                    </div>
                </div>
            </section>

            <!-- AI Research Hub Page -->
            <section id="research" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-white">Deep Research Hub</h2>
                        <p class="text-gray-400 mt-2">Advanced AI-powered research tools for comprehensive business analysis</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex -space-x-2 overflow-hidden">
                            <div class="inline-block h-8 w-8 rounded-full ring-2 ring-gray-900 bg-teal-500 flex items-center justify-center text-white text-sm font-semibold">S</div>
                            <div class="inline-block h-8 w-8 rounded-full ring-2 ring-gray-900 bg-purple-500 flex items-center justify-center text-white text-sm font-semibold">J</div>
                            <div class="inline-block h-8 w-8 rounded-full ring-2 ring-gray-900 bg-blue-500 flex items-center justify-center text-white text-sm font-semibold">M</div>
                        </div>
                        <button class="flex items-center px-4 py-2 text-sm font-medium text-white bg-teal-600 rounded-md hover:bg-teal-700">
                            <i data-lucide="share-2" class="mr-2 h-4 w-4"></i> Share
                        </button>
                    </div>
                </div>
                
                <!-- Smart Search Bar -->
                <div class="relative mb-6">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="smart-search" class="w-full pl-12 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Ask Leo: e.g., 'Market size for family-owned coffee shops in Melbourne'">
                    <button onclick="performSmartSearch()" class="absolute right-2 top-1/2 -translate-y-1/2 bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-md text-sm">
                        <i data-lucide="zap" class="w-4 h-4 mr-1 inline"></i>
                        Ask Leo
                    </button>
                </div>

                <!-- Advanced Research Tools -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button onclick="openMarketAnalysis()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white p-4 rounded-lg text-left transition-all">
                        <i data-lucide="trending-up" class="w-6 h-6 mb-2"></i>
                        <h3 class="font-semibold">Market Analysis</h3>
                        <p class="text-sm opacity-90">Deep dive into market opportunities</p>
                    </button>
                    <button onclick="openCompetitorIntel()" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white p-4 rounded-lg text-left transition-all">
                        <i data-lucide="users" class="w-6 h-6 mb-2"></i>
                        <h3 class="font-semibold">Competitor Intel</h3>
                        <p class="text-sm opacity-90">AI-powered competitor analysis</p>
                    </button>
                    <button onclick="openRiskAssessment()" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white p-4 rounded-lg text-left transition-all">
                        <i data-lucide="shield-alert" class="w-6 h-6 mb-2"></i>
                        <h3 class="font-semibold">Risk Assessment</h3>
                        <p class="text-sm opacity-90">Identify and mitigate business risks</p>
                    </button>
                </div>

                <!-- Tabs -->
                <div class="mb-6 border-b border-gray-700">
                    <nav class="flex -mb-px space-x-6" aria-label="Tabs">
                        <button onclick="switchResearchTab('market')" class="research-tab-btn active text-white group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm border-teal-500">
                            <i data-lucide="line-chart" class="mr-2 text-teal-400"></i> Market Intelligence
                        </button>
                        <button onclick="switchResearchTab('competitor')" class="research-tab-btn text-gray-400 hover:text-white group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm border-transparent hover:border-gray-300">
                            <i data-lucide="swords" class="mr-2"></i> Competitor Analysis
                        </button>
                        <button onclick="switchResearchTab('family')" class="research-tab-btn text-gray-400 hover:text-white group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm border-transparent hover:border-gray-300">
                            <i data-lucide="home" class="mr-2"></i> Family & Succession
                        </button>
                        <button onclick="switchResearchTab('instructions')" class="research-tab-btn text-gray-400 hover:text-white group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm border-transparent hover:border-gray-300">
                            <i data-lucide="help-circle" class="mr-2"></i> Instructions & Workflow
                        </button>
                    </nav>
                </div>

                <!-- Smart Search Results -->
                <div id="smart-search-results" class="hidden mb-6 bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/30 rounded-lg p-6">
                    <div class="flex items-start mb-4">
                        <div class="p-2 mr-3 bg-blue-900/50 rounded-full">
                            <i data-lucide="bot" class="text-blue-300 w-5 h-5"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-white mb-2">Leo's Analysis</h4>
                            <div id="search-analysis-content" class="text-gray-300">
                                <!-- Analysis results will appear here -->
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="pinToBusinessPlan()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg text-sm">
                            <i data-lucide="pin" class="w-4 h-4 mr-2 inline"></i>
                            Pin to Business Plan
                        </button>
                    </div>
                </div>

                <!-- Tab Content -->
                <!-- Market Intelligence Tab -->
                <div id="market-intelligence-content" class="research-tab-content active">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Main Chart -->
                        <div class="lg:col-span-2 p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-lg font-semibold text-white">Market Size & Growth (Coffee Shops, Melbourne)</h3>
                                    <p class="text-sm text-gray-400">Source: IBISWorld, Australian Bureau of Statistics</p>
                                </div>
                                <button class="flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gray-700 rounded-md hover:bg-gray-600">
                                    <i data-lucide="pin" class="mr-1.5 h-3 w-3"></i> Pin to Plan
                                </button>
                            </div>
                            <div class="mt-4 h-64 bg-gray-700/50 rounded-md flex items-center justify-center">
                                <div class="text-center">
                                    <i data-lucide="trending-up" class="w-12 h-12 text-teal-500 mx-auto mb-2"></i>
                                    <p class="text-gray-400">Interactive Chart Placeholder</p>
                                    <p class="text-gray-500 text-sm">Market analysis visualization will appear here</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Key Metrics -->
                        <div class="p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-semibold text-white mb-4">Key Metrics</h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm text-gray-400">Total Addressable Market (TAM)</p>
                                    <p class="text-2xl font-bold text-white">$1.2 Billion</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-400">Serviceable Available Market (SAM)</p>
                                    <p class="text-2xl font-bold text-white">$350 Million</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-400">Serviceable Obtainable Market (SOM)</p>
                                    <p class="text-2xl font-bold text-teal-400">$15 Million</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Personas -->
                        <div class="lg:col-span-3 p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-semibold text-white mb-4">AI-Identified Customer Personas</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-4 bg-gray-700/50 rounded-lg">
                                    <h4 class="font-semibold text-white">The Remote Worker</h4>
                                    <p class="text-sm text-gray-400 mt-1">Seeks reliable Wi-Fi, ample power outlets, and a quiet atmosphere. Values loyalty programs.</p>
                                </div>
                                <div class="p-4 bg-gray-700/50 rounded-lg">
                                    <h4 class="font-semibold text-white">The University Student</h4>
                                    <p class="text-sm text-gray-400 mt-1">Price-sensitive, looks for discounts and late-night hours. Attracted by social media presence.</p>
                                </div>
                                <div class="p-4 bg-gray-700/50 rounded-lg">
                                    <h4 class="font-semibold text-white">The Weekend Socializer</h4>
                                    <p class="text-sm text-gray-400 mt-1">Values ambiance, unique specialty drinks, and Instagrammable decor. Less price-sensitive.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Competitor Analysis Tab -->
                <div id="competitor-analysis-content" class="research-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Competitor Map -->
                        <div class="lg:col-span-2 p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-semibold text-white mb-4">Competitor Map</h3>
                            <div class="h-80 bg-gray-700/50 rounded-md flex items-center justify-center">
                                <div class="text-center">
                                    <i data-lucide="map" class="w-12 h-12 text-teal-500 mx-auto mb-2"></i>
                                    <p class="text-gray-400">Visual Map Placeholder</p>
                                    <p class="text-gray-500 text-sm">(e.g., plotting by price vs. quality)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Opportunity Gap -->
                        <div class="p-6 bg-green-900/30 rounded-lg border border-green-800">
                            <div class="flex items-center mb-2">
                                <div class="p-2 mr-3 bg-green-800/50 rounded-full">
                                    <i data-lucide="lightbulb" class="text-green-300"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-white">Opportunity Gap</h3>
                            </div>
                            <p class="text-green-200">Analysis shows a gap in the market for coffee shops offering late-night study hours and bookable private meeting spaces. This aligns with the 'University Student' and 'Remote Worker' personas.</p>
                            <button class="mt-4 flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gray-700 rounded-md hover:bg-gray-600">
                                <i data-lucide="pin" class="mr-1.5 h-3 w-3"></i> Pin to Strategy
                            </button>
                        </div>
                        
                        <!-- Competitor Profiles -->
                        <div class="lg:col-span-3 p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <h3 class="text-lg font-semibold text-white mb-4">Key Competitor Profiles</h3>
                            <div class="space-y-4">
                                <div class="p-4 bg-gray-700/50 rounded-lg flex items-start justify-between">
                                    <div>
                                        <h4 class="font-semibold text-white">Seven Seeds Coffee Roasters</h4>
                                        <p class="text-sm text-gray-400 mt-1">Strong brand recognition, focuses on high-quality beans. Limited food menu, often crowded.</p>
                                    </div>
                                    <span class="text-xs font-medium text-yellow-400 bg-yellow-900/50 px-2 py-1 rounded-full">Direct Competitor</span>
                                </div>
                                <div class="p-4 bg-gray-700/50 rounded-lg flex items-start justify-between">
                                    <div>
                                        <h4 class="font-semibold text-white">Starbucks (CBD)</h4>
                                        <p class="text-sm text-gray-400 mt-1">Global chain, strong on convenience and consistency. Lacks local, artisanal appeal.</p>
                                    </div>
                                    <span class="text-xs font-medium text-purple-400 bg-purple-900/50 px-2 py-1 rounded-full">Indirect Competitor</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Family & Succession Tab -->
                <div id="family-succession-content" class="research-tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <i data-lucide="landmark" class="w-8 h-8 mb-3 text-teal-400"></i>
                            <h3 class="text-lg font-semibold text-white">Family Council Model</h3>
                            <p class="mt-2 text-sm text-gray-400">Best for fostering communication and making major strategic decisions collectively. Can be slow for day-to-day operations.</p>
                            <button class="mt-4 flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gray-700 rounded-md hover:bg-gray-600">
                                <i data-lucide="pin" class="mr-1.5 h-3 w-3"></i> Pin to Governance
                            </button>
                        </div>
                        <div class="p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <i data-lucide="briefcase" class="w-8 h-8 mb-3 text-teal-400"></i>
                            <h3 class="text-lg font-semibold text-white">Owner-Operator Model</h3>
                            <p class="mt-2 text-sm text-gray-400">Enables swift decision-making, ideal for early-stage ventures. Risks key-person dependency and potential conflict.</p>
                            <button class="mt-4 flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gray-700 rounded-md hover:bg-gray-600">
                                <i data-lucide="pin" class="mr-1.5 h-3 w-3"></i> Pin to Governance
                            </button>
                        </div>
                        <div class="p-6 bg-gray-800/50 rounded-lg border border-gray-800">
                            <i data-lucide="book-open-check" class="w-8 h-8 mb-3 text-teal-400"></i>
                            <h3 class="text-lg font-semibold text-white">Succession Case Study</h3>
                            <p class="mt-2 text-sm text-gray-400">The "Patel & Sons" transition highlights the importance of a 5-year leadership handover plan and formal mentorship.</p>
                            <button class="mt-4 flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gray-700 rounded-md hover:bg-gray-600">
                                <i data-lucide="pin" class="mr-1.5 h-3 w-3"></i> Pin to Succession
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Instructions & Workflow Tab -->
                <div id="instructions-workflow-content" class="research-tab-content hidden">
                    <div class="space-y-8">
                        <!-- Getting Started -->
                        <div class="bg-gray-800/50 rounded-lg border border-gray-800 p-6">
                            <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                                <i data-lucide="play-circle" class="mr-3 text-teal-400"></i>
                                Getting Started with AI Research
                            </h3>
                            <div class="space-y-4">
                                <div class="bg-gray-700/50 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">Welcome to Leo's Research Hub</h4>
                                    <p class="text-gray-300 text-sm">This AI-powered research center helps family businesses gather market intelligence, analyze competitors, and plan succession strategies. Follow the workflow below to maximize your research effectiveness.</p>
                                </div>
                                
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div class="bg-gray-700/50 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <span class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">1</span>
                                            <h5 class="font-semibold text-white">Start Your Search</h5>
                                        </div>
                                        <p class="text-gray-300 text-sm">Use the smart search bar to ask specific questions about your market or industry.</p>
                                    </div>
                                    <div class="bg-gray-700/50 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <span class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">2</span>
                                            <h5 class="font-semibold text-white">Explore Insights</h5>
                                        </div>
                                        <p class="text-gray-300 text-sm">Navigate through different tabs to explore market intelligence, competitors, and family business strategies.</p>
                                    </div>
                                    <div class="bg-gray-700/50 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <span class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">3</span>
                                            <h5 class="font-semibold text-white">Pin & Apply</h5>
                                        </div>
                                        <p class="text-gray-300 text-sm">Pin relevant insights to your business plan and apply findings to your strategy.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Legal & Financial Page -->
            <section id="legal" class="page-section">
                <h2 class="text-3xl font-bold text-white mb-6">Legal & Financial Center</h2>
                
                <!-- Legal Tab Navigation -->
                <nav class="flex -mb-px space-x-6" aria-label="Legal Tabs">
                    <button onclick="switchLegalTab('business-advice')" id="business-advice-tab" class="legal-tab-btn px-3 py-2 font-medium text-sm text-gray-300 border-b-2 border-transparent hover:text-white hover:border-gray-300 transition-colors">
                        Business Advice
                    </button>
                    <button onclick="switchLegalTab('terms-of-service')" id="terms-of-service-tab" class="legal-tab-btn px-3 py-2 font-medium text-sm text-gray-300 border-b-2 border-transparent hover:text-white hover:border-gray-300 transition-colors">
                        Terms of Service
                    </button>
                    <button onclick="switchLegalTab('privacy-policy')" id="privacy-policy-tab" class="legal-tab-btn px-3 py-2 font-medium text-sm text-gray-300 border-b-2 border-transparent hover:text-white hover:border-gray-300 transition-colors">
                        Privacy Policy
                    </button>
                </nav>

                <!-- Business Advice Tab Content -->
                <div id="business-advice-content" class="legal-tab-content mt-8">
                <div class="bg-gray-800 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Business Description</h3>
                    <textarea id="business-description" class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Describe your business idea to get personalized legal and financial advice..."></textarea>
                </div>

                <div class="grid grid-cols-3 gap-6 mb-6">
                    <button onclick="getLegalAdvice('structure')" class="bg-gray-800 hover:bg-gray-700 rounded-lg p-6 text-left transition-colors">
                        <i data-lucide="building" class="w-8 h-8 text-teal-500 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white mb-2">Business Structure</h3>
                        <p class="text-gray-400">Get suggestions for LLC, Corp, etc.</p>
                    </button>

                    <button onclick="getLegalAdvice('tax')" class="bg-gray-800 hover:bg-gray-700 rounded-lg p-6 text-left transition-colors">
                        <i data-lucide="calculator" class="w-8 h-8 text-teal-500 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white mb-2">Tax Guidance</h3>
                        <p class="text-gray-400">Understand tax implications</p>
                    </button>

                    <button onclick="getLegalAdvice('licensing')" class="bg-gray-800 hover:bg-gray-700 rounded-lg p-6 text-left transition-colors">
                        <i data-lucide="file-check" class="w-8 h-8 text-teal-500 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white mb-2">Licensing</h3>
                        <p class="text-gray-400">Required permits and licenses</p>
                    </button>
                </div>

                <div id="legal-advice" class="bg-gray-800 rounded-lg p-6 hidden">
                    <div id="legal-loader" class="text-center py-8 hidden">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-teal-500 mx-auto mb-4"></div>
                        <p class="text-gray-400">Generating legal advice...</p>
                    </div>
                    <div id="legal-content" class="hidden">
                        <!-- Legal advice will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Terms of Service Tab Content -->
                <div id="terms-of-service-content" class="legal-tab-content mt-8 hidden">
                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-2xl font-bold text-white mb-6">Terms of Service</h3>
                        <div class="text-gray-300 space-y-4 text-sm leading-relaxed max-h-96 overflow-y-auto">
                            <p><strong>Last Updated:</strong> December 2024</p>
                            
                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">1. Acceptance of Terms</h4>
                            <p>By accessing and using the Family Business Incubator Hub ("Service"), you accept and agree to be bound by the terms and provision of this agreement. This Service is operated from Australia and complies with Australian and New Zealand law.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">2. Description of Service</h4>
                            <p>Family Business Incubator Hub provides family business management tools, idea development platforms, financial tracking, and collaborative workspace features designed specifically for family-owned enterprises.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">3. User Obligations</h4>
                            <ul class="list-disc ml-6 space-y-2">
                                <li>You must be at least 18 years old or have parental consent to use this Service</li>
                                <li>You agree to provide accurate, current, and complete information</li>
                                <li>You are responsible for maintaining the confidentiality of your account</li>
                                <li>You agree not to use the Service for any unlawful purposes</li>
                            </ul>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">4. Intellectual Property</h4>
                            <p>The Service and its original content, features, and functionality are owned by Family Business Incubator Hub and are protected by international copyright, trademark, patent, trade secret, and other intellectual property laws.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">5. Data and Privacy</h4>
                            <p>We comply with the Australian Privacy Act 1988 and New Zealand Privacy Act 2020. Your use of our Service is also governed by our Privacy Policy, which forms part of these Terms.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">6. Service Availability</h4>
                            <p>While we strive to maintain continuous service availability, we do not guarantee uninterrupted access. We may modify, suspend, or discontinue the Service at any time with reasonable notice.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">7. Limitation of Liability</h4>
                            <p>To the maximum extent permitted by Australian and New Zealand law, we shall not be liable for any indirect, incidental, special, consequential, or punitive damages, or any loss of profits or revenues.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">8. Australian Consumer Law</h4>
                            <p>Nothing in these Terms excludes, restricts, or modifies any guarantee, condition, warranty, or right that you may have under the Australian Consumer Law (or any similar legislation in New Zealand) which cannot be excluded, restricted, or modified.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">9. Governing Law</h4>
                            <p>These Terms shall be governed by and construed in accordance with the laws of Australia. Any disputes shall be subject to the exclusive jurisdiction of the Australian courts, with recognition in New Zealand courts as applicable.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">10. Contact Information</h4>
                            <p>For questions about these Terms, please contact us at legal@familybusinesshub.com.au</p>
                        </div>
                    </div>
                </div>

                <!-- Privacy Policy Tab Content -->
                <div id="privacy-policy-content" class="legal-tab-content mt-8 hidden">
                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-2xl font-bold text-white mb-6">Privacy Policy</h3>
                        <div class="text-gray-300 space-y-4 text-sm leading-relaxed max-h-96 overflow-y-auto">
                            <p><strong>Last Updated:</strong> December 2024</p>
                            <p>This Privacy Policy complies with the Australian Privacy Act 1988 (including the Privacy Amendment Act 2012) and the New Zealand Privacy Act 2020.</p>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">1. Information We Collect</h4>
                            <h5 class="font-semibold text-white mt-4 mb-2">Personal Information:</h5>
                            <ul class="list-disc ml-6 space-y-1">
                                <li>Name, email address, and business contact details</li>
                                <li>Business information and family structure data</li>
                                <li>Financial data you choose to input for tracking purposes</li>
                                <li>User communications and support interactions</li>
                            </ul>

                            <h5 class="font-semibold text-white mt-4 mb-2">Technical Information:</h5>
                            <ul class="list-disc ml-6 space-y-1">
                                <li>IP address, browser type, and device information</li>
                                <li>Usage patterns and feature interaction data</li>
                                <li>Log files and performance analytics</li>
                            </ul>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">2. How We Use Your Information</h4>
                            <ul class="list-disc ml-6 space-y-2">
                                <li>Providing and maintaining our Service</li>
                                <li>Personalizing your user experience</li>
                                <li>Communicating with you about your account and updates</li>
                                <li>Improving our Service through analytics</li>
                                <li>Complying with legal obligations</li>
                            </ul>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">3. Information Sharing and Disclosure</h4>
                            <p>We do not sell, trade, or rent your personal information. We may share information only in these circumstances:</p>
                            <ul class="list-disc ml-6 space-y-2">
                                <li>With your explicit consent</li>
                                <li>To comply with legal requirements or court orders</li>
                                <li>To protect our rights, property, or safety</li>
                                <li>With trusted service providers under strict confidentiality agreements</li>
                                <li>In connection with a business transfer (with notification)</li>
                            </ul>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">4. Your Rights (Australia & New Zealand)</h4>
                            <h5 class="font-semibold text-white mt-4 mb-2">Under Australian Privacy Act 1988:</h5>
                            <ul class="list-disc ml-6 space-y-1">
                                <li>Right to access your personal information</li>
                                <li>Right to correct inaccurate information</li>
                                <li>Right to complain to the Office of the Australian Information Commissioner (OAIC)</li>
                            </ul>

                            <h5 class="font-semibold text-white mt-4 mb-2">Under New Zealand Privacy Act 2020:</h5>
                            <ul class="list-disc ml-6 space-y-1">
                                <li>Right to access and correction</li>
                                <li>Right to complain to the Privacy Commissioner</li>
                                <li>Right to request deletion (where legally permissible)</li>
                            </ul>

                            <h4 class="text-lg font-semibold text-white mt-6 mb-3">5. Contact Information</h4>
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <p><strong>Privacy Officer</strong></p>
                                <p>Email: privacy@familybusinesshub.com.au</p>
                                <p>Address: [Your Australian Business Address]</p>
                                <p>Phone: [Your Contact Number]</p>
                                
                                <p class="mt-4"><strong>For complaints in Australia:</strong></p>
                                <p>Office of the Australian Information Commissioner (OAIC)<br>
                                Website: www.oaic.gov.au<br>
                                Phone: 1300 363 992</p>
                                
                                <p class="mt-4"><strong>For complaints in New Zealand:</strong></p>
                                <p>Office of the Privacy Commissioner<br>
                                Website: www.privacy.org.nz<br>
                                Phone: 0800 803 909</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Milestone Tracker Page -->
            <section id="milestones" class="page-section">
                <h2 class="text-3xl font-bold text-white mb-6">Milestone Tracker</h2>
                
                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-white">Project Milestones</h3>
                        <button onclick="addMilestone()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Milestone
                        </button>
                    </div>
                    
                    <div id="milestones-list" class="space-y-4">
                        <div class="flex items-center p-4 bg-gray-700 rounded-lg">
                            <input type="checkbox" class="mr-4 h-5 w-5 text-teal-500 bg-gray-600 border-gray-500 rounded">
                            <div class="flex-1">
                                <h4 class="font-semibold text-white">Initial Market Research</h4>
                                <p class="text-gray-400 text-sm">Complete preliminary market analysis</p>
                            </div>
                            <span class="text-sm text-gray-400">Due: Next Week</span>
                        </div>
                        
                        <div class="flex items-center p-4 bg-gray-700 rounded-lg">
                            <input type="checkbox" checked class="mr-4 h-5 w-5 text-teal-500 bg-gray-600 border-gray-500 rounded">
                            <div class="flex-1">
                                <h4 class="font-semibold text-white line-through">Business Plan Draft</h4>
                                <p class="text-gray-400 text-sm">Create first version of business plan</p>
                            </div>
                            <span class="text-sm text-green-400">Completed</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modern Chat App Interface -->
            <section id="chat" class="page-section">
                <div class="flex h-screen max-h-[calc(100vh-6rem)] bg-white dark:bg-gray-900">
                    <!-- Chat List Sidebar -->
                    <div class="w-96 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col">
                        <!-- Header with Profile and Actions -->
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' rx='20' fill='%2314b8a6'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-family='Arial' font-size='16' font-weight='bold'%3EY%3C/text%3E%3C/svg%3E" alt="Your Profile" class="w-10 h-10 rounded-full">
                                        <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></div>
                                    </div>
                                    <div class="ml-3">
                                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Family Hub</h2>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <button onclick="openStoryCamera()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="camera" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="startNewChat()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="edit" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="openChatMenu()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="more-vertical" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Search Bar -->
                            <div class="relative">
                                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                <input type="text" id="chat-search" placeholder="Search chats or content..." class="w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-700 border-0 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-500">
                            </div>
                    </div>
                    
                        <!-- Stories Section -->
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-3 overflow-x-auto pb-2">
                                <!-- Add Your Story -->
                                <div class="flex-shrink-0 text-center">
                                    <div class="relative">
                                        <div class="w-14 h-14 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center border-2 border-dashed border-gray-400 dark:border-gray-500">
                                            <i data-lucide="plus" class="w-6 h-6 text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Add Story</p>
                        </div>
                        
                                <!-- Family Stories -->
                                <div class="flex-shrink-0 text-center cursor-pointer" onclick="viewStory('john')">
                                    <div class="relative">
                                        <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full p-0.5">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='52' height='52' viewBox='0 0 52 52'%3E%3Crect width='52' height='52' rx='26' fill='%236366f1'/%3E%3Ctext x='26' y='32' text-anchor='middle' fill='white' font-family='Arial' font-size='20' font-weight='bold'%3EJ%3C/text%3E%3C/svg%3E" alt="John" class="w-full h-full rounded-full">
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">John</p>
                                </div>
                                
                                <div class="flex-shrink-0 text-center cursor-pointer" onclick="viewStory('sarah')">
                                    <div class="relative">
                                        <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-blue-500 rounded-full p-0.5">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='52' height='52' viewBox='0 0 52 52'%3E%3Crect width='52' height='52' rx='26' fill='%23ec4899'/%3E%3Ctext x='26' y='32' text-anchor='middle' fill='white' font-family='Arial' font-size='20' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E" alt="Sarah" class="w-full h-full rounded-full">
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Sarah</p>
                            </div>
                            
                                <div class="flex-shrink-0 text-center cursor-pointer" onclick="viewStory('mike')">
                                    <div class="relative">
                                        <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-red-500 rounded-full p-0.5">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='52' height='52' viewBox='0 0 52 52'%3E%3Crect width='52' height='52' rx='26' fill='%233b82f6'/%3E%3Ctext x='26' y='32' text-anchor='middle' fill='white' font-family='Arial' font-size='20' font-weight='bold'%3EM%3C/text%3E%3C/svg%3E" alt="Mike" class="w-full h-full rounded-full">
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Mike</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chat Filter Tabs -->
                        <div class="flex border-b border-gray-200 dark:border-gray-700">
                            <button class="chat-filter-tab active flex-1 py-3 px-4 text-sm font-medium text-teal-600 dark:text-teal-400 border-b-2 border-teal-600 dark:border-teal-400" onclick="filterChats('all')">
                                All
                                </button>
                            <button class="chat-filter-tab flex-1 py-3 px-4 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" onclick="filterChats('unread')">
                                Unread
                                <span class="ml-1 bg-teal-500 text-white text-xs px-1.5 py-0.5 rounded-full">3</span>
                            </button>
                            <button class="chat-filter-tab flex-1 py-3 px-4 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" onclick="filterChats('groups')">
                                Groups
                            </button>
                        </div>

                        <!-- Chat List -->
                        <div class="flex-1 overflow-y-auto" id="chat-list-container">
                            <!-- Family Business Group -->
                            <div class="chat-item active p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-l-4 border-teal-500" onclick="openChat('family-business')">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-blue-500 rounded-full flex items-center justify-center">
                                            <i data-lucide="users" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div class="absolute -top-1 -right-1 bg-teal-500 text-white text-xs px-1.5 py-0.5 rounded-full">5</div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-semibold text-gray-900 dark:text-white">Family Business</h3>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">2:45 PM</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Sarah: Here's the catering menu I designed! 📸</p>
                                            <div class="flex items-center space-x-1">
                                                <i data-lucide="volume-2" class="w-3 h-3 text-gray-400"></i>
                                                <div class="w-2 h-2 bg-teal-500 rounded-full"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Individual Chats -->
                            <div class="chat-item p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer" onclick="openChat('john-private')">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Crect width='48' height='48' rx='24' fill='%236366f1'/%3E%3Ctext x='24' y='30' text-anchor='middle' fill='white' font-family='Arial' font-size='18' font-weight='bold'%3EJ%3C/text%3E%3C/svg%3E" alt="John" class="w-12 h-12 rounded-full">
                                        <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-semibold text-gray-900 dark:text-white">John</h3>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">1:20 PM</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i data-lucide="check-check" class="w-4 h-4 text-blue-500 mr-1"></i>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Great idea! Let's discuss this more</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-item p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer" onclick="openChat('sarah-private')">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Crect width='48' height='48' rx='24' fill='%23ec4899'/%3E%3Ctext x='24' y='30' text-anchor='middle' fill='white' font-family='Arial' font-size='18' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E" alt="Sarah" class="w-12 h-12 rounded-full">
                                        <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-semibold text-gray-900 dark:text-white">Sarah</h3>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">12:45 PM</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i data-lucide="mic" class="w-4 h-4 text-teal-500 mr-1"></i>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Voice message</p>
                                            </div>
                                            <div class="w-2 h-2 bg-teal-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-item p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer" onclick="openChat('mike-private')">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Crect width='48' height='48' rx='24' fill='%233b82f6'/%3E%3Ctext x='24' y='30' text-anchor='middle' fill='white' font-family='Arial' font-size='18' font-weight='bold'%3EM%3C/text%3E%3C/svg%3E" alt="Mike" class="w-12 h-12 rounded-full">
                                        <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-orange-500 border-2 border-white dark:border-gray-800 rounded-full"></div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-semibold text-gray-900 dark:text-white">Mike</h3>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">Yesterday</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i data-lucide="video" class="w-4 h-4 text-blue-500 mr-1"></i>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Video call ended</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-item p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer" onclick="openChat('emma-private')">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Crect width='48' height='48' rx='24' fill='%2310b981'/%3E%3Ctext x='24' y='30' text-anchor='middle' fill='white' font-family='Arial' font-size='18' font-weight='bold'%3EE%3C/text%3E%3C/svg%3E" alt="Emma" class="w-12 h-12 rounded-full">
                                        <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-gray-400 border-2 border-white dark:border-gray-800 rounded-full"></div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-semibold text-gray-900 dark:text-white">Emma</h3>
                                            <span class="text-xs text-gray-500 dark:text-gray-400">Monday</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i data-lucide="check" class="w-4 h-4 text-gray-400 mr-1"></i>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Thanks for the business updates!</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modern Chat Detail Area -->
                    <div class="flex-1 bg-white dark:bg-gray-900 flex flex-col" id="chat-detail-container">
                        <!-- Chat Header -->
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <button onclick="backToChatList()" class="lg:hidden p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg mr-2">
                                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                    </button>
                                    <div class="relative">
                                        <div class="w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-500 rounded-full flex items-center justify-center">
                                            <i data-lucide="users" class="w-5 h-5 text-white"></i>
                                        </div>
                                        <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></div>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="font-semibold text-gray-900 dark:text-white" id="current-chat-name">Family Business</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" id="current-chat-status">John, Sarah, Mike, Emma online</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <button onclick="startVideoCall()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="video" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="startVoiceCall()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="phone" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="openChatInfo()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="info" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="openChatMenu()" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                        <i data-lucide="more-vertical" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                                                
                        <!-- Messages Area -->
                        <div class="flex-1 overflow-y-auto px-4 py-2 chat-background" id="chat-messages">
                            <!-- Date Divider -->
                            <div class="flex items-center justify-center my-4">
                                <div class="bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full">
                                    <span class="text-xs text-gray-600 dark:text-gray-400">Today</span>
                                </div>
                            </div>

                            <!-- Incoming Messages -->
                            <div class="flex items-start mb-4">
                                <div class="w-8 h-8 rounded-full mr-2 mt-2">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='16' fill='%236366f1'/%3E%3Ctext x='16' y='20' text-anchor='middle' fill='white' font-family='Arial' font-size='12' font-weight='bold'%3EJ%3C/text%3E%3C/svg%3E" alt="John" class="w-full h-full rounded-full">
                                </div>
                                <div class="flex-1 max-w-xs">
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-sm p-3 shadow-sm">
                                        <p class="text-gray-900 dark:text-white text-sm">Hey everyone! Excited to start brainstorming our family business ideas. 🚀</p>
                                    </div>
                                    <div class="flex items-center mt-1 ml-2">
                                        <span class="text-xs text-gray-500 dark:text-gray-400">John • 2:30 PM</span>
                                        <div class="flex items-center ml-2 space-x-1">
                                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">👍 3</span>
                                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">🚀 2</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Message with Image -->
                            <div class="flex items-start mb-4">
                                <div class="w-8 h-8 rounded-full mr-2 mt-2">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='16' fill='%23ec4899'/%3E%3Ctext x='16' y='20' text-anchor='middle' fill='white' font-family='Arial' font-size='12' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E" alt="Sarah" class="w-full h-full rounded-full">
                                </div>
                                <div class="flex-1 max-w-sm">
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-sm p-3 shadow-sm">
                                        <p class="text-gray-900 dark:text-white text-sm mb-2">I've been thinking about the catering idea. Here's a sample menu I designed!</p>
                                        <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='180' viewBox='0 0 280 180'%3E%3Crect width='280' height='180' fill='%23f3f4f6'/%3E%3Cg transform='translate(140,90)'%3E%3Ccircle r='20' fill='%239ca3af'/%3E%3Cpath d='M-10,-5 L-5,5 L10,-10' stroke='white' stroke-width='2' fill='none'/%3E%3C/g%3E%3Ctext x='140' y='130' text-anchor='middle' fill='%236b7280' font-family='Arial' font-size='12'%3ESample Menu Design%3C/text%3E%3C/svg%3E" alt="Menu Design" class="w-full h-auto">
                                        </div>
                                    </div>
                                    <div class="flex items-center mt-1 ml-2">
                                        <span class="text-xs text-gray-500 dark:text-gray-400">Sarah • 2:35 PM</span>
                                        <div class="flex items-center ml-2 space-x-1">
                                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">😍 4</span>
                                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full">👏 2</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Voice Message -->
                            <div class="flex items-start mb-4">
                                <div class="w-8 h-8 rounded-full mr-2 mt-2">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='16' fill='%233b82f6'/%3E%3Ctext x='16' y='20' text-anchor='middle' fill='white' font-family='Arial' font-size='12' font-weight='bold'%3EM%3C/text%3E%3C/svg%3E" alt="Mike" class="w-full h-full rounded-full">
                                </div>
                                <div class="flex-1 max-w-xs">
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-sm p-3 shadow-sm">
                                        <div class="flex items-center space-x-3">
                                            <button class="flex-shrink-0 w-8 h-8 bg-teal-500 rounded-full flex items-center justify-center">
                                                <i data-lucide="play" class="w-4 h-4 text-white"></i>
                                            </button>
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-1 mb-1">
                                                    <div class="flex space-x-0.5">
                                                        <div class="w-0.5 bg-teal-500 rounded-full audio-bar-8"></div>
                                                        <div class="w-0.5 bg-teal-500 rounded-full audio-bar-12"></div>
                                                        <div class="w-0.5 bg-teal-500 rounded-full audio-bar-6"></div>
                                                        <div class="w-0.5 bg-teal-500 rounded-full audio-bar-14"></div>
                                                        <div class="w-0.5 bg-teal-500 rounded-full audio-bar-10"></div>
                                                        <div class="w-0.5 bg-gray-300 dark:bg-gray-600 rounded-full audio-bar-8"></div>
                                                        <div class="w-0.5 bg-gray-300 dark:bg-gray-600 rounded-full audio-bar-12"></div>
                                                        <div class="w-0.5 bg-gray-300 dark:bg-gray-600 rounded-full audio-bar-6"></div>
                                                        <div class="w-0.5 bg-gray-300 dark:bg-gray-600 rounded-full audio-bar-14"></div>
                                                        <div class="w-0.5 bg-gray-300 dark:bg-gray-600 rounded-full audio-bar-10"></div>
                                                    </div>
                                                </div>
                                                <span class="text-xs text-gray-500 dark:text-gray-400">2:15</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center mt-1 ml-2">
                                        <span class="text-xs text-gray-500 dark:text-gray-400">Mike • 2:42 PM</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Outgoing Messages (Your messages) -->
                            <div class="flex items-end justify-end mb-4">
                                <div class="flex-1 max-w-xs text-right">
                                    <div class="bg-teal-500 rounded-2xl rounded-tr-sm p-3 shadow-sm">
                                        <p class="text-white text-sm">That sounds like a fantastic idea! The menu looks professional. Should we schedule a family meeting to discuss the business plan?</p>
                                    </div>
                                    <div class="flex items-center justify-end mt-1 mr-2">
                                        <i data-lucide="check-check" class="w-3 h-3 text-blue-500 mr-1"></i>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">2:45 PM</span>
                                    </div>
                                </div>
                            </div>

                            <!-- System Message -->
                            <div class="flex items-center justify-center my-4">
                                <div class="bg-yellow-100 dark:bg-yellow-900 px-3 py-1 rounded-full">
                                    <span class="text-xs text-yellow-800 dark:text-yellow-200">🔔 Emma joined the chat</span>
                                </div>
                            </div>

                            <!-- Typing Indicator -->
                            <div class="flex items-start mb-4 hidden-element" id="typing-indicator">
                                <div class="w-8 h-8 rounded-full mr-2 mt-2">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='16' fill='%2310b981'/%3E%3Ctext x='16' y='20' text-anchor='middle' fill='white' font-family='Arial' font-size='12' font-weight='bold'%3EE%3C/text%3E%3C/svg%3E" alt="Emma" class="w-full h-full rounded-full">
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-sm p-3 shadow-sm">
                                    <div class="flex space-x-1">
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse animate-delay-200"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse animate-delay-400"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Modern Message Input -->
                        <div class="p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                            <!-- Reply Preview (hidden by default) -->
                            <div id="reply-preview" class="hidden mb-3 bg-gray-100 dark:bg-gray-700 rounded-lg p-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i data-lucide="corner-down-right" class="w-4 h-4 text-teal-500 mr-2"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Replying to <span class="font-semibold text-gray-900 dark:text-white">John</span></span>
                                    </div>
                                    <button onclick="cancelReply()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1 truncate">Hey everyone! Excited to start brainstorming...</p>
                            </div>

                            <!-- File Upload Progress (hidden by default) -->
                            <div id="upload-progress" class="hidden mb-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-blue-700 dark:text-blue-300">Uploading files...</span>
                                    <button onclick="cancelUpload()" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <div class="w-full bg-blue-100 dark:bg-blue-800 rounded-full h-2">
                                    <div id="upload-progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300 progress-0"></div>
                                </div>
                            </div>
                            
                            <!-- Message Input Container -->
                            <div class="flex items-end space-x-2">
                                <!-- Attachment Button -->
                                <div class="relative">
                                    <input type="file" id="file-input" multiple accept="image/*,video/*,.pdf,.doc,.docx,.txt,.mp3,.wav" class="hidden" onchange="handleFileSelect(event)">
                                    <button onclick="toggleAttachmentMenu()" class="p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
                                        <i data-lucide="paperclip" class="w-5 h-5"></i>
                                    </button>
                                    
                                    <!-- Attachment Menu -->
                                    <div id="attachment-menu" class="hidden absolute bottom-full left-0 mb-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-2 w-48">
                                        <button onclick="selectFiles('image')" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                                            <i data-lucide="image" class="w-4 h-4 mr-3 text-blue-500"></i>
                                            Photo or Video
                                        </button>
                                        <button onclick="selectFiles('file')" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                                            <i data-lucide="file" class="w-4 h-4 mr-3 text-green-500"></i>
                                            Document
                                        </button>
                                        <button onclick="selectFiles('audio')" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                                            <i data-lucide="mic" class="w-4 h-4 mr-3 text-red-500"></i>
                                            Audio
                                        </button>
                                        <button onclick="openContactPicker()" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                                            <i data-lucide="user" class="w-4 h-4 mr-3 text-purple-500"></i>
                                            Contact
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Main Input Area -->
                                <div class="flex-1 relative bg-gray-100 dark:bg-gray-700 rounded-2xl">
                                    <textarea 
                                        id="chat-input" 
                                        placeholder="Type a message..." 
                                        class="w-full bg-transparent text-gray-900 dark:text-white px-4 py-3 pr-20 rounded-2xl border-0 focus:outline-none resize-none placeholder-gray-500 dark:placeholder-gray-400"
                                        rows="1"
                                        onkeydown="handleChatKeydown(event)"
                                        oninput="handleChatInput(event)"
                                    ></textarea>
                                    
                                    <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center space-x-1">
                                        <!-- Emoji Button -->
                                        <button onclick="toggleEmojiPicker()" class="p-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full transition-colors">
                                            <i data-lucide="smile" class="w-4 h-4"></i>
                                        </button>
                                        
                                        <!-- Voice Message Button -->
                                        <button id="voice-btn" onmousedown="startVoiceRecording()" onmouseup="stopVoiceRecording()" ontouchstart="startVoiceRecording()" ontouchend="stopVoiceRecording()" class="p-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full transition-colors">
                                            <i data-lucide="mic" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Emoji Picker -->
                                    <div id="emoji-picker" class="hidden absolute bottom-full right-0 mb-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg max-h-64 overflow-y-auto">
                                        <div class="grid grid-cols-8 gap-1 w-64">
                                            <button onclick="insertEmoji('😀')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">😀</button>
                                            <button onclick="insertEmoji('😍')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">😍</button>
                                            <button onclick="insertEmoji('👍')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">👍</button>
                                            <button onclick="insertEmoji('👏')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">👏</button>
                                            <button onclick="insertEmoji('🚀')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">🚀</button>
                                            <button onclick="insertEmoji('💡')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">💡</button>
                                            <button onclick="insertEmoji('🎉')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">🎉</button>
                                            <button onclick="insertEmoji('❤️')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">❤️</button>
                                            <button onclick="insertEmoji('😂')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">😂</button>
                                            <button onclick="insertEmoji('🤔')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">🤔</button>
                                            <button onclick="insertEmoji('💰')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">💰</button>
                                            <button onclick="insertEmoji('📈')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">📈</button>
                                            <button onclick="insertEmoji('✅')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">✅</button>
                                            <button onclick="insertEmoji('❌')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">❌</button>
                                            <button onclick="insertEmoji('🤝')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">🤝</button>
                                            <button onclick="insertEmoji('📝')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg">📝</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Send/Voice Button -->
                                <button id="send-btn" onclick="sendModernMessage()" class="p-3 bg-teal-500 hover:bg-teal-600 text-white rounded-full transition-colors">
                                    <i data-lucide="send" class="w-5 h-5"></i>
                                </button>
                            </div>
                            
                            <!-- File Preview Area -->
                            <div id="file-preview" class="hidden mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Attachments</span>
                                    <button onclick="clearFilePreview()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <div id="file-preview-list" class="space-y-2"></div>
                            </div>

                            <!-- Voice Recording Indicator -->
                            <div id="voice-recording" class="hidden mt-3 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0">
                                        <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                                    </div>
                                    <div class="flex-1">
                                        <span class="text-sm text-red-700 dark:text-red-300">Recording voice message...</span>
                                        <div class="text-xs text-red-600 dark:text-red-400 mt-1" id="recording-time">0:00</div>
                                    </div>
                                    <button onclick="cancelVoiceRecording()" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section id="settings" class="page-section">
                <h2 class="text-3xl font-bold text-white mb-6">Settings</h2>
                
                <div class="max-w-2xl space-y-6">
                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Profile Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Full Name</label>
                                <input type="text" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" value="John Doe">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                                <input type="email" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" value="john@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Role in Family Business</label>
                                <select class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                                    <option>Founder</option>
                                    <option>Co-founder</option>
                                    <option>Investor</option>
                                    <option>Advisor</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Notification Settings</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-white">New Ideas</h4>
                                    <p class="text-sm text-gray-400">Get notified when new business ideas are submitted</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-white">Chat Messages</h4>
                                    <p class="text-sm text-gray-400">Get notified of new chat messages</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium text-white">Milestone Updates</h4>
                                    <p class="text-sm text-gray-400">Get notified when milestones are completed</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-2 rounded-lg">Save Settings</button>
                    </div>
                </div>
            </section>

            <!-- Financial Dashboard Page -->
            <section id="financial" class="page-section">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-2">Financial Dashboard</h2>
                        <p class="text-gray-400">Real-time financial overview for Q3 2025</p>
                    </div>
                    <div class="mt-4 sm:mt-0 flex items-center space-x-4">
                        <button onclick="navigateToPage('data-center')" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                            Update Data
                        </button>
                        <select class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                            <option>Q3 2025</option>
                            <option>Q2 2025</option>
                            <option>Q1 2025</option>
                            <option>Last 12 Months</option>
                        </select>
                    </div>
                </div>
                
                <!-- Top Level Metrics -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Total Revenue Card -->
                    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                        <h3 class="text-sm font-medium text-gray-400">Total Revenue</h3>
                        <div class="mt-2 flex items-baseline space-x-2">
                            <p class="text-3xl font-bold text-white">$1,250,650.75</p>
                            <span class="flex items-center text-sm font-semibold text-green-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                </svg>
                                5.2%
                            </span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">vs. previous quarter</p>
                    </div>

                    <!-- Total Outgoing Card -->
                    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                        <h3 class="text-sm font-medium text-gray-400">Total Outgoing</h3>
                        <div class="mt-2 flex items-baseline space-x-2">
                            <p class="text-3xl font-bold text-white">$840,110.20</p>
                            <span class="flex items-center text-sm font-semibold text-red-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                                </svg>
                                1.8%
                            </span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">vs. previous quarter</p>
                    </div>

                    <!-- Net Profit Card -->
                    <div class="bg-teal-600/20 border border-teal-500 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                        <h3 class="text-sm font-medium text-teal-300">Net Profit</h3>
                        <div class="mt-2 flex items-baseline space-x-2">
                            <p class="text-3xl font-bold text-white">$410,540.55</p>
                            <span class="flex items-center text-sm font-semibold text-green-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                </svg>
                                12.1%
                            </span>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Profit Margin: 32.8%</p>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Main Chart: Performance Over Time -->
                    <div class="lg:col-span-2 bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                        <h3 class="text-lg font-semibold text-white mb-4">Performance Over Time</h3>
                        <div class="h-80 w-full">
                            <svg width="100%" height="100%" viewBox="0 0 400 200" preserveAspectRatio="xMidYMid meet">
                                <!-- Grid lines -->
                                <g class="text-gray-700" stroke="currentColor" stroke-width="0.5">
                                    <line x1="0" y1="40" x2="400" y2="40"></line>
                                    <line x1="0" y1="80" x2="400" y2="80"></line>
                                    <line x1="0" y1="120" x2="400" y2="120"></line>
                                    <line x1="0" y1="160" x2="400" y2="160"></line>
                                </g>
                                <!-- Revenue line (teal) -->
                                <path d="M 0 100 C 40 80, 80 120, 120 100 S 200 60, 240 80 S 320 110, 400 90" fill="none" stroke="#2dd4bf" stroke-width="2"/>
                                <!-- Outgoing line (red) -->
                                <path d="M 0 150 C 40 160, 80 140, 120 150 S 200 130, 240 140 S 320 160, 400 150" fill="none" stroke="#f87171" stroke-width="2"/>
                                <!-- Month labels -->
                                <g class="text-xs" fill="#9ca3af">
                                    <text x="20" y="195">Jul</text>
                                    <text x="100" y="195">Aug</text>
                                    <text x="180" y="195">Sep</text>
                                    <text x="260" y="195">Oct</text>
                                    <text x="340" y="195">Nov</text>
                                </g>
                                <!-- Legend -->
                                <g class="text-xs">
                                    <rect x="280" y="10" width="10" height="10" fill="#2dd4bf" rx="2"></rect>
                                    <text x="295" y="18" fill="#9ca3af">Revenue</text>
                                    <rect x="280" y="30" width="10" height="10" fill="#f87171" rx="2"></rect>
                                    <text x="295" y="38" fill="#9ca3af">Outgoing</text>
                                </g>
                            </svg>
                        </div>
                    </div>

                    <!-- Side Panel: Outgoing Breakdown -->
                    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                        <h3 class="text-lg font-semibold text-white mb-4">Outgoing by Category</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-300">Payroll</span>
                                    <span class="text-sm font-medium text-gray-400">45%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div class="bg-sky-500 h-2 rounded-full progress-45"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-300">Marketing</span>
                                    <span class="text-sm font-medium text-gray-400">20%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div class="bg-indigo-500 h-2 rounded-full progress-20"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-300">Operations & Cloud</span>
                                    <span class="text-sm font-medium text-gray-400">15%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div class="bg-purple-500 h-2 rounded-full progress-15"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-300">Research & Development</span>
                                    <span class="text-sm font-medium text-gray-400">10%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div class="bg-pink-500 h-2 rounded-full progress-10"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-300">Other</span>
                                    <span class="text-sm font-medium text-gray-400">10%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div class="bg-gray-500 h-2 rounded-full progress-10"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Individual Business Performance Section -->
                <div>
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-white">Individual Business Performance</h3>
                        <div class="flex items-center space-x-2 sm:space-x-4 mt-4 sm:mt-0">
                            <!-- Timeline Filter -->
                            <select class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-xs text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option>Monthly</option>
                                <option>Quarterly</option>
                                <option>Yearly</option>
                            </select>
                            <!-- View Toggles -->
                            <div class="flex items-center p-0.5 rounded-lg bg-gray-800 border border-gray-700">
                                <button id="financial-grid-view-btn" type="button" class="financial-view-toggle-btn active p-1.5 rounded-md" title="Grid View" onclick="toggleFinancialView('grid')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                                    </svg>
                                </button>
                                <button id="financial-list-view-btn" type="button" class="financial-view-toggle-btn p-1.5 rounded-md" title="List View" onclick="toggleFinancialView('list')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Grid View Container -->
                    <div id="financial-grid-view" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                            <h4 class="font-semibold text-white">🏢 Alpha Division</h4>
                            <div class="h-24 w-full my-4">
                                <svg width="100%" height="100%" viewBox="0 0 200 50" preserveAspectRatio="none">
                                    <path d="M 0 30 C 20 10, 40 40, 60 30 S 100 0, 120 20 S 160 45, 200 35" fill="none" stroke="#2dd4bf" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Revenue:</span>
                                    <span class="font-medium text-green-400">$650,200</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Outgoing:</span>
                                    <span class="font-medium text-red-400">$400,000</span>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-gray-700/50 mt-2 font-semibold">
                                    <span class="text-gray-300">Net Profit:</span>
                                    <span class="text-white">$250,200</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                            <h4 class="font-semibold text-white">⚙️ Bravo Operations</h4>
                            <div class="h-24 w-full my-4">
                                <svg width="100%" height="100%" viewBox="0 0 200 50" preserveAspectRatio="none">
                                    <path d="M 0 20 C 20 40, 40 10, 60 20 S 100 50, 120 30 S 160 5, 200 15" fill="none" stroke="#f87171" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Revenue:</span>
                                    <span class="font-medium text-green-400">$400,300</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Outgoing:</span>
                                    <span class="font-medium text-red-400">$310,110</span>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-gray-700/50 mt-2 font-semibold">
                                    <span class="text-gray-300">Net Profit:</span>
                                    <span class="text-white">$90,190</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200">
                            <h4 class="font-semibold text-white">🌐 Charlie Services</h4>
                            <div class="h-24 w-full my-4">
                                <svg width="100%" height="100%" viewBox="0 0 200 50" preserveAspectRatio="none">
                                    <path d="M 0 30 C 20 10, 40 40, 60 30 S 100 0, 120 20 S 160 45, 200 35" fill="none" stroke="#2dd4bf" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Revenue:</span>
                                    <span class="font-medium text-green-400">$200,150</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Outgoing:</span>
                                    <span class="font-medium text-red-400">$130,000</span>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-gray-700/50 mt-2 font-semibold">
                                    <span class="text-gray-300">Net Profit:</span>
                                    <span class="text-white">$70,150</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 opacity-60">
                            <h4 class="font-semibold text-white">📦 Delta Logistics</h4>
                            <div class="h-24 w-full my-4 flex items-center justify-center bg-gray-900/30 rounded-lg">
                                <span class="text-gray-500 text-sm">No data available</span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Revenue:</span>
                                    <span class="font-medium text-gray-500">$0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Outgoing:</span>
                                    <span class="font-medium text-gray-500">$0</span>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-gray-700/50 mt-2 font-semibold">
                                    <span class="text-gray-300">Net Profit:</span>
                                    <span class="text-white">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- List View Container -->
                    <div id="financial-list-view" class="hidden">
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-4 sm:p-6">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-gray-400 uppercase bg-gray-900/50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 rounded-l-lg">Business / Division</th>
                                            <th scope="col" class="px-6 py-3 text-right">Revenue</th>
                                            <th scope="col" class="px-6 py-3 text-right">Outgoing</th>
                                            <th scope="col" class="px-6 py-3 text-right rounded-r-lg">Net Profit</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-gray-700 hover:bg-gray-800/50">
                                            <th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">🏢 Alpha Division</th>
                                            <td class="px-6 py-4 text-right text-green-400">$650,200</td>
                                            <td class="px-6 py-4 text-right text-red-400">$400,000</td>
                                            <td class="px-6 py-4 text-right font-semibold text-white">$250,200</td>
                                        </tr>
                                        <tr class="border-b border-gray-700 hover:bg-gray-800/50">
                                            <th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">⚙️ Bravo Operations</th>
                                            <td class="px-6 py-4 text-right text-green-400">$400,300</td>
                                            <td class="px-6 py-4 text-right text-red-400">$310,110</td>
                                            <td class="px-6 py-4 text-right font-semibold text-white">$90,190</td>
                                        </tr>
                                        <tr class="border-b border-gray-700 hover:bg-gray-800/50">
                                            <th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">🌐 Charlie Services</th>
                                            <td class="px-6 py-4 text-right text-green-400">$200,150</td>
                                            <td class="px-6 py-4 text-right text-red-400">$130,000</td>
                                            <td class="px-6 py-4 text-right font-semibold text-white">$70,150</td>
                                        </tr>
                                        <tr class="hover:bg-gray-800/50">
                                            <th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">📦 Delta Logistics</th>
                                            <td class="px-6 py-4 text-right text-gray-500">$0</td>
                                            <td class="px-6 py-4 text-right text-gray-500">$0</td>
                                            <td class="px-6 py-4 text-right font-semibold text-white">$0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Update Center Page -->
            <section id="data-center" class="page-section">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-white">Data Update Center</h2>
                        <p class="text-gray-400 mt-2">Keep your business information accurate and up-to-date</p>
                    </div>
                    <div class="mt-4 sm:mt-0 flex space-x-3">
                        <button onclick="toggleReminderSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors">
                            <i data-lucide="bell" class="w-4 h-4 mr-2"></i>
                            Reminder Settings
                        </button>
                        <button onclick="sendUpdateReminders()" class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-2 rounded-lg flex items-center">
                            <i data-lucide="send" class="w-4 h-4 mr-2"></i>
                            Send Reminders
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats Overview -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 data-card">
                        <h3 class="text-sm font-medium text-gray-400">Data Items</h3>
                        <p class="text-2xl font-bold text-white mt-2" id="total-items">12</p>
                        <p class="text-xs text-gray-500 mt-1">Total trackable items</p>
                    </div>
                    <div class="bg-green-600/20 border border-green-500 rounded-xl p-6 data-card">
                        <h3 class="text-sm font-medium text-green-300">Up to Date</h3>
                        <p class="text-2xl font-bold text-white mt-2" id="up-to-date-count">8</p>
                        <p class="text-xs text-gray-500 mt-1">Recently updated</p>
                    </div>
                    <div class="bg-yellow-600/20 border border-yellow-500 rounded-xl p-6 data-card">
                        <h3 class="text-sm font-medium text-yellow-300">Due Soon</h3>
                        <p class="text-2xl font-bold text-white mt-2" id="due-soon-count">3</p>
                        <p class="text-xs text-gray-500 mt-1">Need attention</p>
                    </div>
                    <div class="bg-red-600/20 border border-red-500 rounded-xl p-6 data-card">
                        <h3 class="text-sm font-medium text-red-300">Overdue</h3>
                        <p class="text-2xl font-bold text-white mt-2" id="overdue-count">1</p>
                        <p class="text-xs text-gray-500 mt-1">Require updates</p>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-gray-800 rounded-xl p-4 mb-6">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <div class="flex-1 relative">
                            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"></i>
                            <input type="text" id="data-search" placeholder="Search data items..." class="w-full pl-10 pr-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                        </div>
                        <select id="status-filter" class="bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            <option value="all">All Status</option>
                            <option value="up-to-date">Up to Date</option>
                            <option value="due-soon">Due Soon</option>
                            <option value="overdue">Overdue</option>
                        </select>
                        <select id="category-filter" class="bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            <option value="all">All Categories</option>
                            <option value="financial">Financial</option>
                            <option value="operational">Operational</option>
                            <option value="legal">Legal</option>
                            <option value="business-metrics">Business Metrics</option>
                        </select>
                    </div>
                </div>

                <!-- Data Items List -->
                <div class="bg-gray-800 rounded-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-white">Data Items</h3>
                        <button onclick="addNewDataItem()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center text-sm">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Data Item
                        </button>
                    </div>
                    
                    <div id="data-items-container" class="space-y-4">
                        <!-- Data items will be dynamically rendered -->
                    </div>
                </div>

                <!-- Reminder Settings Modal -->
                <div id="reminder-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
                    <div class="bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex justify-between items-center">
                                <h3 class="text-xl font-bold text-white">Reminder Settings</h3>
                                <button onclick="toggleReminderSettings()" title="Close settings" aria-label="Close reminder settings" class="text-gray-400 hover:text-white">
                                    <i data-lucide="x" class="w-6 h-6"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-6">
                                <!-- Reminder Frequency -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-3">Reminder Frequency</label>
                                    <div class="space-y-3">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="weekly-reminders" checked class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                                            <label for="weekly-reminders" class="ml-2 text-sm text-gray-300">Weekly status reminders</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="overdue-reminders" checked class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                                            <label for="overdue-reminders" class="ml-2 text-sm text-gray-300">Immediate overdue alerts</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="upcoming-reminders" checked class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                                            <label for="upcoming-reminders" class="ml-2 text-sm text-gray-300">Upcoming due date alerts (7 days)</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Notification Methods -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-3">Notification Methods</label>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <label for="email-notifications" class="text-sm text-gray-300">Email Notifications</label>
                                            <input type="checkbox" id="email-notifications" title="Enable email notifications" checked class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <label for="app-notifications" class="text-sm text-gray-300">In-App Notifications</label>
                                            <input type="checkbox" id="app-notifications" title="Enable in-app notifications" checked class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                                        </div>
                                    </div>
                                </div>

                                <!-- Family Members -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-3">Family Members to Notify</label>
                                    <div id="family-members-list" class="space-y-2">
                                        <div class="flex items-center justify-between bg-gray-700 rounded-lg p-3">
                                            <div>
                                                <p class="text-white font-medium">John Smith</p>
                                                <p class="text-gray-400 text-sm">john@familybusiness.com - CEO</p>
                                            </div>
                                            <input type="checkbox" checked class="w-4 h-4 text-teal-600 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        </div>
                                        <div class="flex items-center justify-between bg-gray-700 rounded-lg p-3">
                                            <div>
                                                <p class="text-white font-medium">Sarah Smith</p>
                                                <p class="text-gray-400 text-sm">sarah@familybusiness.com - CFO</p>
                                            </div>
                                            <input type="checkbox" checked class="w-4 h-4 text-teal-600 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        </div>
                                        <div class="flex items-center justify-between bg-gray-700 rounded-lg p-3">
                                            <div>
                                                <p class="text-white font-medium">Mike Smith</p>
                                                <p class="text-gray-400 text-sm">mike@familybusiness.com - Operations</p>
                                            </div>
                                            <input type="checkbox" class="w-4 h-4 text-teal-600 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                                        </div>
                                    </div>
                                    <button onclick="addFamilyMember()" class="mt-3 bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg text-sm">
                                        <i data-lucide="user-plus" class="w-4 h-4 mr-2 inline"></i>
                                        Add Family Member
                                    </button>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-700">
                                <button onclick="toggleReminderSettings()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg">
                                    Cancel
                                </button>
                                <button onclick="saveReminderSettings()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg">
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Update Data Modal -->
                <div id="update-data-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
                    <div class="bg-gray-800 rounded-lg w-full max-w-5xl max-h-[90vh] overflow-auto">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex justify-between items-center">
                                <h3 id="update-modal-title" class="text-xl font-bold text-white">Update Data</h3>
                                <button onclick="closeUpdateModal()" title="Close modal" aria-label="Close update modal" class="text-gray-400 hover:text-white">
                                    <i data-lucide="x" class="w-6 h-6"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            <!-- Tab Navigation -->
                            <div class="mb-6">
                                <div class="border-b border-gray-700">
                                    <nav class="-mb-px flex space-x-8">
                                        <!-- Year Tabs -->
                                        <div class="flex space-x-2" id="year-tabs">
                                            <!-- Year tabs will be generated dynamically -->
                                        </div>
                                    </nav>
                                </div>
                                <!-- Quarter Tabs (shown for applicable data types) -->
                                <div class="mt-4 hidden" id="quarter-tabs-container">
                                    <div class="flex space-x-2">
                                        <button onclick="setActiveQuarter('Q1')" class="quarter-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600 transition-colors" data-quarter="Q1">Q1</button>
                                        <button onclick="setActiveQuarter('Q2')" class="quarter-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600 transition-colors" data-quarter="Q2">Q2</button>
                                        <button onclick="setActiveQuarter('Q3')" class="quarter-tab px-4 py-2 text-sm font-medium rounded-lg bg-teal-500 text-white transition-colors" data-quarter="Q3">Q3</button>
                                        <button onclick="setActiveQuarter('Q4')" class="quarter-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600 transition-colors" data-quarter="Q4">Q4</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="update-form-content">
                                <!-- Form content will be dynamically generated -->
                            </div>
                            
                            <!-- Business Metrics Section (for business cards) -->
                            <div id="business-metrics-section" class="hidden mt-6 pt-6 border-t border-gray-700">
                                <h4 class="text-lg font-semibold text-white mb-4">Business Metrics</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <!-- Employee Headcount -->
                                    <div class="bg-gray-700 rounded-lg p-4">
                                        <h5 class="text-sm font-medium text-gray-300 mb-3">Employee Headcount</h5>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Full-time Employees</label>
                                                <input type="number" id="fulltime-employees" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="0">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Part-time Employees</label>
                                                <input type="number" id="parttime-employees" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="0">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Contractors</label>
                                                <input type="number" id="contractors" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="0">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Inventory Levels -->
                                    <div class="bg-gray-700 rounded-lg p-4">
                                        <h5 class="text-sm font-medium text-gray-300 mb-3">Inventory Levels</h5>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Total Inventory Value ($)</label>
                                                <input type="number" id="inventory-value" step="0.01" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="0.00">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Items in Stock</label>
                                                <input type="number" id="items-stock" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="0">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Turnover Rate</label>
                                                <input type="number" id="turnover-rate" step="0.1" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="0.0">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Legal Compliance Status -->
                                    <div class="bg-gray-700 rounded-lg p-4">
                                        <h5 class="text-sm font-medium text-gray-300 mb-3">Legal Compliance Status</h5>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Business License Status</label>
                                                <select id="license-status" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                                    <option>Active</option>
                                                    <option>Renewal Required</option>
                                                    <option>Expired</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Tax Compliance</label>
                                                <select id="tax-compliance" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                                    <option>Current</option>
                                                    <option>Filing Required</option>
                                                    <option>Overdue</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Insurance Status</label>
                                                <select id="insurance-status" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                                    <option>Active</option>
                                                    <option>Needs Renewal</option>
                                                    <option>Expired</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-700">
                                <button onclick="closeUpdateModal()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg">
                                    Cancel
                                </button>
                                <button onclick="saveAdvancedDataUpdate()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg">
                                    Save Update
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Task Management Page -->
            <section id="tasks" class="page-section">
                <h2 class="text-3xl font-bold text-white mb-6">Task Management</h2>
                
                <!-- Task Stats -->
                <div class="grid grid-cols-1 sm:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-lg p-6">
                        <h3 class="text-sm font-medium text-gray-400">Total Tasks</h3>
                        <p class="text-2xl font-bold text-white mt-2">24</p>
                    </div>
                    <div class="bg-blue-600/20 border border-blue-500 rounded-lg p-6">
                        <h3 class="text-sm font-medium text-blue-300">In Progress</h3>
                        <p class="text-2xl font-bold text-white mt-2">8</p>
                    </div>
                    <div class="bg-green-600/20 border border-green-500 rounded-lg p-6">
                        <h3 class="text-sm font-medium text-green-300">Completed</h3>
                        <p class="text-2xl font-bold text-white mt-2">12</p>
                    </div>
                    <div class="bg-red-600/20 border border-red-500 rounded-lg p-6">
                        <h3 class="text-sm font-medium text-red-300">Overdue</h3>
                        <p class="text-2xl font-bold text-white mt-2">4</p>
                    </div>
                </div>

                <!-- Task Board -->
                <div class="bg-gray-800 rounded-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-white">Project Tasks</h3>
                        <button onclick="addNewTask()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Task
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- To Do -->
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-4">To Do</h4>
                            <div class="space-y-3">
                                <div class="bg-gray-800 rounded-lg p-3">
                                    <h5 class="text-white font-medium">Market Research</h5>
                                    <p class="text-gray-400 text-sm">Analyze competitor pricing</p>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="text-xs text-gray-500">Due: Tomorrow</span>
                                        <div class="w-6 h-6 bg-blue-500 rounded-full text-white text-xs flex items-center justify-center">J</div>
                                    </div>
                                </div>
                                <div class="bg-gray-800 rounded-lg p-3">
                                    <h5 class="text-white font-medium">Logo Design</h5>
                                    <p class="text-gray-400 text-sm">Create brand identity</p>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="text-xs text-gray-500">Due: Next week</span>
                                        <div class="w-6 h-6 bg-purple-500 rounded-full text-white text-xs flex items-center justify-center">S</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- In Progress -->
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-4">In Progress</h4>
                            <div class="space-y-3">
                                <div class="bg-gray-800 rounded-lg p-3">
                                    <h5 class="text-white font-medium">Business Plan Draft</h5>
                                    <p class="text-gray-400 text-sm">Executive summary section</p>
                                    <div class="w-full bg-gray-600 rounded-full h-2 mt-2">
                                        <div class="bg-teal-500 h-2 rounded-full progress-60"></div>
                                    </div>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="text-xs text-gray-500">60% complete</span>
                                        <div class="w-6 h-6 bg-green-500 rounded-full text-white text-xs flex items-center justify-center">M</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Done -->
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-4">Done</h4>
                            <div class="space-y-3">
                                <div class="bg-gray-800 rounded-lg p-3 opacity-75">
                                    <h5 class="text-white font-medium line-through">Initial Meeting</h5>
                                    <p class="text-gray-400 text-sm">Kick-off discussion</p>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="text-xs text-green-400">Completed</span>
                                        <div class="w-6 h-6 bg-teal-500 rounded-full text-white text-xs flex items-center justify-center">✓</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- User Profile Dashboard -->
            <section id="profile" class="page-section">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-white">My Profile</h2>
                        <p class="text-gray-400 mt-2">Manage your personal information and account settings</p>
                    </div>
                    <button onclick="editProfile()" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i data-lucide="edit" class="w-4 h-4 mr-2"></i>
                        Edit Profile
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Profile Card -->
                    <div class="lg:col-span-1">
                        <div class="bg-gray-800 rounded-xl p-6 text-center">
                            <div class="relative inline-block mb-4">
                                <div class="w-24 h-24 bg-gradient-to-br from-teal-400 to-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                                    SJ
                                </div>
                                <button onclick="changeProfilePhoto()" class="absolute -bottom-1 -right-1 bg-teal-500 hover:bg-teal-600 text-white p-2 rounded-full transition-colors">
                                    <i data-lucide="camera" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <h3 class="text-xl font-semibold text-white mb-2">Sarah Johnson</h3>
                            <p class="text-gray-400 mb-1">CEO & Co-Founder</p>
                            <p class="text-gray-500 text-sm mb-4">Johnson Family Enterprises</p>
                            
                            <div class="flex justify-center space-x-4 mb-6">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-teal-400">15</div>
                                    <div class="text-xs text-gray-400">Ideas Submitted</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-400">3</div>
                                    <div class="text-xs text-gray-400">Projects Led</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-400">92%</div>
                                    <div class="text-xs text-gray-400">Success Rate</div>
                                </div>
                            </div>

                            <div class="space-y-3 text-left">
                                <div class="flex items-center text-sm">
                                    <i data-lucide="mail" class="w-4 h-4 text-gray-400 mr-3"></i>
                                    <span class="text-gray-300">sarah@johnsonfamily.com</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i data-lucide="phone" class="w-4 h-4 text-gray-400 mr-3"></i>
                                    <span class="text-gray-300">+1 (555) 123-4567</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i data-lucide="map-pin" class="w-4 h-4 text-gray-400 mr-3"></i>
                                    <span class="text-gray-300">Melbourne, Australia</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i data-lucide="calendar" class="w-4 h-4 text-gray-400 mr-3"></i>
                                    <span class="text-gray-300">Joined January 2024</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="bg-gray-800 rounded-xl p-6 mt-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Quick Actions</h4>
                            <div class="space-y-3">
                                <button onclick="navigateToPage('ideas')" class="w-full flex items-center p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                                    <i data-lucide="lightbulb" class="w-5 h-5 text-teal-400 mr-3"></i>
                                    <span class="text-white">Submit New Idea</span>
                                </button>
                                <button onclick="navigateToPage('data-center')" class="w-full flex items-center p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                                    <i data-lucide="database" class="w-5 h-5 text-blue-400 mr-3"></i>
                                    <span class="text-white">Update Data</span>
                                </button>
                                <button onclick="navigateToPage('chat')" class="w-full flex items-center p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                                    <i data-lucide="message-square" class="w-5 h-5 text-green-400 mr-3"></i>
                                    <span class="text-white">Send Message</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Details -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Personal Information -->
                        <div class="bg-gray-800 rounded-xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h4 class="text-lg font-semibold text-white">Personal Information</h4>
                                <button onclick="editPersonalInfo()" class="text-teal-400 hover:text-teal-300 text-sm">Edit</button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">First Name</label>
                                    <div class="text-white">Sarah</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Last Name</label>
                                    <div class="text-white">Johnson</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                                    <div class="text-white">sarah@johnsonfamily.com</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Phone</label>
                                    <div class="text-white">+1 (555) 123-4567</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Date of Birth</label>
                                    <div class="text-white">March 15, 1985</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Time Zone</label>
                                    <div class="text-white">Australia/Melbourne (UTC+11)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Business Information -->
                        <div class="bg-gray-800 rounded-xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h4 class="text-lg font-semibold text-white">Business Information</h4>
                                <button onclick="editBusinessInfo()" class="text-teal-400 hover:text-teal-300 text-sm">Edit</button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Company</label>
                                    <div class="text-white">Johnson Family Enterprises</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Position</label>
                                    <div class="text-white">CEO & Co-Founder</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Department</label>
                                    <div class="text-white">Executive Leadership</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Employee ID</label>
                                    <div class="text-white">JFE-001</div>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Bio</label>
                                    <div class="text-white">Passionate about building sustainable family businesses and fostering innovation across generations. Leading the digital transformation initiative for our family enterprise.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Activity & Performance -->
                        <div class="bg-gray-800 rounded-xl p-6">
                            <h4 class="text-lg font-semibold text-white mb-6">Activity & Performance</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div class="bg-gray-700 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-teal-400 mb-2">15</div>
                                    <div class="text-sm text-gray-400">Ideas Submitted</div>
                                </div>
                                <div class="bg-gray-700 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-blue-400 mb-2">142</div>
                                    <div class="text-sm text-gray-400">Votes Cast</div>
                                </div>
                                <div class="bg-gray-700 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-green-400 mb-2">28</div>
                                    <div class="text-sm text-gray-400">Comments Posted</div>
                                </div>
                            </div>
                            
                            <!-- Recent Activity -->
                            <div>
                                <h5 class="text-white font-medium mb-4">Recent Activity</h5>
                                <div class="space-y-3">
                                    <div class="flex items-center space-x-3 p-3 bg-gray-700 rounded-lg">
                                        <div class="w-8 h-8 bg-teal-500 rounded-full flex items-center justify-center">
                                            <i data-lucide="lightbulb" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm">Submitted idea "Family Catering Service"</div>
                                            <div class="text-gray-400 text-xs">2 hours ago</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3 p-3 bg-gray-700 rounded-lg">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                            <i data-lucide="thumbs-up" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm">Voted on "Online Tutoring Platform"</div>
                                            <div class="text-gray-400 text-xs">1 day ago</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3 p-3 bg-gray-700 rounded-lg">
                                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                            <i data-lucide="message-circle" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm">Commented on "Farm-to-Table Initiative"</div>
                                            <div class="text-gray-400 text-xs">3 days ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preferences -->
                        <div class="bg-gray-800 rounded-xl p-6">
                            <h4 class="text-lg font-semibold text-white mb-6">Preferences</h4>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-white font-medium">Email Notifications</div>
                                        <div class="text-gray-400 text-sm">Receive email updates about activity</div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" value="" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-white font-medium">Desktop Notifications</div>
                                        <div class="text-gray-400 text-sm">Show browser notifications</div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" value="" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-white font-medium">Weekly Summary</div>
                                        <div class="text-gray-400 text-sm">Receive weekly activity summary</div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" value="" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- User Management Page -->
            <section id="user-management" class="page-section">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-white">User Management</h2>
                        <p class="text-gray-400 mt-2">Manage family members and team access</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="inviteUser()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center">
                            <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i>
                            Invite User
                        </button>
                        <button onclick="exportUsers()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            Export
                        </button>
                    </div>
                </div>

                <!-- User Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Total Users</p>
                                <p class="text-2xl font-bold text-white">12</p>
                            </div>
                            <div class="w-12 h-12 bg-teal-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="users" class="w-6 h-6 text-teal-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Active Today</p>
                                <p class="text-2xl font-bold text-white">8</p>
                            </div>
                            <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="activity" class="w-6 h-6 text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Pending Invites</p>
                                <p data-stat="pending" class="text-2xl font-bold text-white">3</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="clock" class="w-6 h-6 text-yellow-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-400">Admins</p>
                                <p class="text-2xl font-bold text-white">2</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="shield" class="w-6 h-6 text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <div class="relative">
                                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                <input type="text" id="user-search" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-500">
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <select id="role-filter" class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="all">All Roles</option>
                                <option value="admin">Admin</option>
                                <option value="member">Member</option>
                                <option value="viewer">Viewer</option>
                            </select>
                            <select id="status-filter" class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="all">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="bg-gray-800 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-900">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Last Active</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Ideas</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                <tr class="hover:bg-gray-700/50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-gradient-to-br from-teal-400 to-blue-500 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                                SJ
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Sarah Johnson</div>
                                                <div class="text-gray-400 text-sm">sarah@johnsonfamily.com</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-purple-600/20 text-purple-300 rounded-full">Admin</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-green-600/20 text-green-300 rounded-full">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">2 hours ago</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex space-x-2">
                                            <button onclick="editUser(1)" class="text-blue-400 hover:text-blue-300">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="viewUser(1)" class="text-green-400 hover:text-green-300">
                                                <i data-lucide="eye" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="suspendUser(1)" class="text-yellow-400 hover:text-yellow-300">
                                                <i data-lucide="pause" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-700/50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                                MJ
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Mike Johnson</div>
                                                <div class="text-gray-400 text-sm">mike@johnsonfamily.com</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-blue-600/20 text-blue-300 rounded-full">Member</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-green-600/20 text-green-300 rounded-full">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">1 day ago</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">8</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex space-x-2">
                                            <button onclick="editUser(2)" class="text-blue-400 hover:text-blue-300">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="viewUser(2)" class="text-green-400 hover:text-green-300">
                                                <i data-lucide="eye" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="suspendUser(2)" class="text-yellow-400 hover:text-yellow-300">
                                                <i data-lucide="pause" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-700/50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-teal-500 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                                EJ
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Emma Johnson</div>
                                                <div class="text-gray-400 text-sm">emma@johnsonfamily.com</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-blue-600/20 text-blue-300 rounded-full">Member</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-green-600/20 text-green-300 rounded-full">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">3 hours ago</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">12</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex space-x-2">
                                            <button onclick="editUser(3)" class="text-blue-400 hover:text-blue-300">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="viewUser(3)" class="text-green-400 hover:text-green-300">
                                                <i data-lucide="eye" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="suspendUser(3)" class="text-yellow-400 hover:text-yellow-300">
                                                <i data-lucide="pause" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-700/50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                                JJ
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Jane Johnson</div>
                                                <div class="text-gray-400 text-sm">jane@johnsonfamily.com</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-gray-600/20 text-gray-300 rounded-full">Viewer</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium bg-yellow-600/20 text-yellow-300 rounded-full">Pending</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-gray-400">Never</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">0</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex space-x-2">
                                            <button onclick="editUser(4)" class="text-blue-400 hover:text-blue-300">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="resendInvite(4)" class="text-teal-400 hover:text-teal-300">
                                                <i data-lucide="send" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="cancelInvite(4)" class="text-red-400 hover:text-red-300">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="flex items-center justify-between mt-6">
                    <div class="text-sm text-gray-400">
                        <span id="pagination-info">Showing 1 to 4 of 12 users</span>
                    </div>
                    <div class="flex space-x-2">
                        <button id="prev-page" onclick="changePage('prev')" class="px-3 py-1 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 disabled:opacity-50" disabled>
                            Previous
                        </button>
                        <button onclick="goToPage(1)" class="pagination-btn px-3 py-1 bg-teal-500 text-white rounded-lg" data-page="1">1</button>
                        <button onclick="goToPage(2)" class="pagination-btn px-3 py-1 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600" data-page="2">2</button>
                        <button onclick="goToPage(3)" class="pagination-btn px-3 py-1 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600" data-page="3">3</button>
                        <button id="next-page" onclick="changePage('next')" class="px-3 py-1 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600">
                            Next
                        </button>
                    </div>
                </div>
            </section>

            <!-- System Admin Page -->
            <section id="admin" class="page-section">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-white flex items-center">
                            <i data-lucide="shield-check" class="w-8 h-8 mr-3 text-red-400"></i>
                            System Administration
                        </h2>
                        <p class="text-gray-400 mt-2">Complete system management and oversight dashboard</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm font-medium">
                            <i data-lucide="shield-check" class="w-4 h-4 inline mr-1"></i>
                            Admin Mode Active
                        </div>
                        <button onclick="exportSystemReport()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            System Report
                        </button>
                    </div>
                </div>

                <!-- Admin Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm font-medium">Total Users</p>
                                <p class="text-3xl font-bold">247</p>
                                <p class="text-blue-200 text-xs mt-1">+12 this week</p>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="users" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm font-medium">System Health</p>
                                <p class="text-3xl font-bold">98.5%</p>
                                <p class="text-green-200 text-xs mt-1">All systems operational</p>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="activity" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-red-600 to-red-700 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100 text-sm font-medium">Security Alerts</p>
                                <p class="text-3xl font-bold">3</p>
                                <p class="text-red-200 text-xs mt-1">2 require attention</p>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="shield-alert" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm font-medium">Storage Used</p>
                                <p class="text-3xl font-bold">67%</p>
                                <p class="text-purple-200 text-xs mt-1">2.1TB / 3.2TB</p>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="hard-drive" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Navigation Tabs -->
                <div class="bg-gray-800 rounded-lg mb-6">
                    <nav class="flex flex-wrap border-b border-gray-700">
                        <button onclick="showAdminTab('overview')" class="admin-tab-btn active px-6 py-4 text-sm font-medium text-white border-b-2 border-teal-500">
                            <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-2"></i>
                            Overview
                        </button>
                        <button onclick="showAdminTab('users')" class="admin-tab-btn px-6 py-4 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white">
                            <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>
                            User Management
                        </button>
                        <button onclick="showAdminTab('content')" class="admin-tab-btn px-6 py-4 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white">
                            <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>
                            Content Management
                        </button>
                        <button onclick="showAdminTab('security')" class="admin-tab-btn px-6 py-4 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white">
                            <i data-lucide="shield" class="w-4 h-4 inline mr-2"></i>
                            Security Center
                        </button>
                        <button onclick="showAdminTab('system')" class="admin-tab-btn px-6 py-4 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white">
                            <i data-lucide="server" class="w-4 h-4 inline mr-2"></i>
                            System Monitor
                        </button>
                        <button onclick="showAdminTab('analytics')" class="admin-tab-btn px-6 py-4 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 inline mr-2"></i>
                            Analytics
                        </button>
                        <button onclick="showAdminTab('settings')" class="admin-tab-btn px-6 py-4 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white">
                            <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>
                            System Settings
                        </button>
                    </nav>
                </div>

                <!-- Admin Tab Content -->
                <div class="bg-gray-800 rounded-lg p-6">
                    
                    <!-- Overview Tab -->
                    <div id="admin-overview" class="admin-tab-content active">
                        <h3 class="text-xl font-bold text-white mb-6">System Overview</h3>
                        
                        <!-- Recent Activity Feed -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
                                    <i data-lucide="activity" class="w-5 h-5 mr-2 text-blue-400"></i>
                                    Recent Activity
                                    <div class="ml-auto flex space-x-2">
                                        <button onclick="refreshActivity()" class="text-xs bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded">
                                            <i data-lucide="refresh-cw" class="w-3 h-3 inline mr-1"></i>Refresh
                                        </button>
                                        <button onclick="viewAllActivity()" class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-white">
                                            View All
                                        </button>
                                    </div>
                                </h4>
                                <div class="space-y-4" id="activity-feed">
                                    <div class="flex items-center space-x-3 p-3 bg-gray-600 rounded-lg hover:bg-gray-500 cursor-pointer transition-colors" onclick="viewActivityDetails('user-registration', 'john.doe@family.com')">
                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <div class="flex-1">
                                            <p class="text-white text-sm">New user registration: john.doe@family.com</p>
                                            <p class="text-gray-400 text-xs">2 minutes ago</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); viewUser('john.doe@family.com')" class="text-xs bg-green-600 hover:bg-green-700 px-2 py-1 rounded text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                            View User
                                        </button>
                                    </div>
                                    <div class="flex items-center space-x-3 p-3 bg-gray-600 rounded-lg hover:bg-gray-500 cursor-pointer transition-colors" onclick="viewActivityDetails('backup', 'system-backup-001')">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                        <div class="flex-1">
                                            <p class="text-white text-sm">System backup completed successfully</p>
                                            <p class="text-gray-400 text-xs">15 minutes ago</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); downloadBackup('system-backup-001')" class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                            Download
                                        </button>
                                    </div>
                                    <div class="flex items-center space-x-3 p-3 bg-gray-600 rounded-lg hover:bg-gray-500 cursor-pointer transition-colors" onclick="viewActivityDetails('security-scan', 'scan-report-034')">
                                        <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                        <div class="flex-1">
                                            <p class="text-white text-sm">Security scan detected 1 low-risk issue</p>
                                            <p class="text-gray-400 text-xs">1 hour ago</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); viewSecurityReport('scan-report-034')" class="text-xs bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                            View Report
                                        </button>
                                    </div>
                                    <div class="flex items-center space-x-3 p-3 bg-gray-600 rounded-lg hover:bg-gray-500 cursor-pointer transition-colors" onclick="viewActivityDetails('database-optimization', 'opt-job-012')">
                                        <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                        <div class="flex-1">
                                            <p class="text-white text-sm">Database optimization completed</p>
                                            <p class="text-gray-400 text-xs">3 hours ago</p>
                                        </div>
                                        <button onclick="event.stopPropagation(); viewOptimizationReport('opt-job-012')" class="text-xs bg-purple-600 hover:bg-purple-700 px-2 py-1 rounded text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                            View Stats
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- System Alerts -->
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
                                    <i data-lucide="alert-triangle" class="w-5 h-5 mr-2 text-yellow-400"></i>
                                    System Alerts
                                    <button onclick="refreshAlerts()" class="ml-auto text-xs bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded">
                                        <i data-lucide="refresh-cw" class="w-3 h-3 inline mr-1"></i>Refresh
                                    </button>
                                </h4>
                                <div class="space-y-4">
                                    <div class="bg-red-500/20 border border-red-500/50 rounded-lg p-4 cursor-pointer hover:bg-red-500/30 transition-colors" onclick="handleAlert('cpu-usage')">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-red-300 font-medium">High CPU Usage</p>
                                                <p class="text-red-200 text-sm">Server load at 85% - investigate</p>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <i data-lucide="cpu" class="w-5 h-5 text-red-400"></i>
                                                <button onclick="event.stopPropagation(); resolveAlert('cpu-usage')" class="text-xs bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-white">
                                                    Resolve
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4 cursor-pointer hover:bg-yellow-500/30 transition-colors" onclick="handleAlert('ssl-expiry')">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-yellow-300 font-medium">SSL Certificate Expiry</p>
                                                <p class="text-yellow-200 text-sm">Expires in 30 days - renew soon</p>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <i data-lucide="shield-alert" class="w-5 h-5 text-yellow-400"></i>
                                                <button onclick="event.stopPropagation(); resolveAlert('ssl-expiry')" class="text-xs bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded text-white">
                                                    Renew
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-blue-500/20 border border-blue-500/50 rounded-lg p-4 cursor-pointer hover:bg-blue-500/30 transition-colors" onclick="handleAlert('update-available')">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-blue-300 font-medium">Update Available</p>
                                                <p class="text-blue-200 text-sm">Security patch v2.1.4 ready</p>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <i data-lucide="download" class="w-5 h-5 text-blue-400"></i>
                                                <button onclick="event.stopPropagation(); resolveAlert('update-available')" class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-white">
                                                    Install
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="performBackup()" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="database" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">Backup System</div>
                            </button>
                            <button onclick="runSecurityScan()" class="bg-red-600 hover:bg-red-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="shield-check" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">Security Scan</div>
                            </button>
                            <button onclick="optimizeDatabase()" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="zap" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">Optimize DB</div>
                            </button>
                            <button onclick="viewSystemLogs()" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="file-text" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">View Logs</div>
                            </button>
                        </div>
                    </div>

                    <!-- User Management Tab -->
                    <div id="admin-users" class="admin-tab-content">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Advanced User Management</h3>
                            <div class="flex space-x-3">
                                <button onclick="bulkUserActions()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="users" class="w-4 h-4 mr-2"></i>
                                    Bulk Actions
                                </button>
                                <button onclick="exportUserData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                    Export Users
                                </button>
                            </div>
                        </div>

                        <!-- User Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">User Activity</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Active Today</span>
                                        <span class="text-green-400 font-medium">142</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Active This Week</span>
                                        <span class="text-blue-400 font-medium">203</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Inactive (30+ days)</span>
                                        <span class="text-red-400 font-medium">15</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">User Roles</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Administrators</span>
                                        <span class="text-red-400 font-medium">3</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Moderators</span>
                                        <span class="text-yellow-400 font-medium">8</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Regular Users</span>
                                        <span class="text-green-400 font-medium">236</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Security Status</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">2FA Enabled</span>
                                        <span class="text-green-400 font-medium">89%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Email Verified</span>
                                        <span class="text-blue-400 font-medium">96%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Suspended</span>
                                        <span class="text-red-400 font-medium">2</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced User Search and Filters -->
                        <div class="bg-gray-700 rounded-lg p-6 mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Search Users</label>
                                    <input type="text" placeholder="Name, email, or ID..." class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white placeholder-gray-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Role Filter</label>
                                    <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                        <option>All Roles</option>
                                        <option>Administrators</option>
                                        <option>Moderators</option>
                                        <option>Regular Users</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Status Filter</label>
                                    <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                        <option>All Statuses</option>
                                        <option>Active</option>
                                        <option>Inactive</option>
                                        <option>Suspended</option>
                                        <option>Pending</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Registration Date</label>
                                    <input type="date" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                </div>
                            </div>
                        </div>

                        <!-- User Table -->
                        <div class="bg-gray-700 rounded-lg overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-600">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                                <input type="checkbox" class="rounded border-gray-400">
                                            </th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">User</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Role</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Last Active</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-600">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <input type="checkbox" class="rounded border-gray-400">
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold">JS</div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-white">John Smith</div>
                                                        <div class="text-sm text-gray-400">john.smith@family.com</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium bg-red-500/20 text-red-300 rounded-full">Administrator</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium bg-green-500/20 text-green-300 rounded-full">Active</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">5 minutes ago</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button class="text-blue-400 hover:text-blue-300">Edit</button>
                                                <button class="text-yellow-400 hover:text-yellow-300">Suspend</button>
                                                <button class="text-red-400 hover:text-red-300">Delete</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <input type="checkbox" class="rounded border-gray-400">
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-semibold">SD</div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-white">Sarah Davis</div>
                                                        <div class="text-sm text-gray-400">sarah.davis@family.com</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium bg-yellow-500/20 text-yellow-300 rounded-full">Moderator</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium bg-green-500/20 text-green-300 rounded-full">Active</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">2 hours ago</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button class="text-blue-400 hover:text-blue-300">Edit</button>
                                                <button class="text-yellow-400 hover:text-yellow-300">Suspend</button>
                                                <button class="text-red-400 hover:text-red-300">Delete</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Content Management Tab -->
                    <div id="admin-content" class="admin-tab-content">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Content Management Center</h3>
                            <div class="flex space-x-3">
                                <button onclick="moderateContent()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="eye" class="w-4 h-4 mr-2"></i>
                                    Moderate
                                </button>
                                <button onclick="contentAnalytics()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="bar-chart" class="w-4 h-4 mr-2"></i>
                                    Analytics
                                </button>
                            </div>
                        </div>

                        <!-- Content Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Total Ideas</p>
                                        <p class="text-2xl font-bold text-white">1,247</p>
                                    </div>
                                    <i data-lucide="lightbulb" class="w-8 h-8 text-yellow-400"></i>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Chat Messages</p>
                                        <p class="text-2xl font-bold text-white">45,892</p>
                                    </div>
                                    <i data-lucide="message-square" class="w-8 h-8 text-blue-400"></i>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Business Plans</p>
                                        <p class="text-2xl font-bold text-white">89</p>
                                    </div>
                                    <i data-lucide="file-text" class="w-8 h-8 text-green-400"></i>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Pending Review</p>
                                        <p class="text-2xl font-bold text-white">12</p>
                                    </div>
                                    <i data-lucide="clock" class="w-8 h-8 text-red-400"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Content Moderation Queue -->
                        <div class="bg-gray-700 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Content Moderation Queue</h4>
                            <div class="space-y-4">
                                <div class="bg-gray-600 rounded-lg p-4 border-l-4 border-yellow-500">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="flex items-center space-x-3 mb-2">
                                                <span class="text-white font-medium">Flagged Idea: "Revolutionary AI Product"</span>
                                                <span class="px-2 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded-full">Pending Review</span>
                                            </div>
                                            <p class="text-gray-300 text-sm mb-2">Reported for: Potential spam content</p>
                                            <p class="text-gray-400 text-xs">Submitted by: mike.johnson@family.com • 3 hours ago</p>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">Approve</button>
                                            <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Reject</button>
                                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Review</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-600 rounded-lg p-4 border-l-4 border-red-500">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="flex items-center space-x-3 mb-2">
                                                <span class="text-white font-medium">Chat Message: Inappropriate Language</span>
                                                <span class="px-2 py-1 text-xs bg-red-500/20 text-red-300 rounded-full">High Priority</span>
                                            </div>
                                            <p class="text-gray-300 text-sm mb-2">Reported for: Offensive language, harassment</p>
                                            <p class="text-gray-400 text-xs">In chat: Family Business Planning • 1 hour ago</p>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">Approve</button>
                                            <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Remove</button>
                                            <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">Warn User</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Content Management Tools -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Content Tools</h4>
                                <div class="space-y-3">
                                    <button onclick="bulkContentActions()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg flex items-center justify-center">
                                        <i data-lucide="layers" class="w-4 h-4 mr-2"></i>
                                        Bulk Content Actions
                                    </button>
                                    <button onclick="contentBackup()" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg flex items-center justify-center">
                                        <i data-lucide="archive" class="w-4 h-4 mr-2"></i>
                                        Backup All Content
                                    </button>
                                    <button onclick="contentSearch()" class="w-full bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg flex items-center justify-center">
                                        <i data-lucide="search" class="w-4 h-4 mr-2"></i>
                                        Advanced Content Search
                                    </button>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Content Policies</h4>
                                <div class="space-y-3">
                                    <button onclick="editContentPolicies()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg flex items-center justify-center">
                                        <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>
                                        Edit Content Policies
                                    </button>
                                    <button onclick="automationRules()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg flex items-center justify-center">
                                        <i data-lucide="zap" class="w-4 h-4 mr-2"></i>
                                        Automation Rules
                                    </button>
                                    <button onclick="reportTemplates()" class="w-full bg-gray-600 hover:bg-gray-500 text-white p-3 rounded-lg flex items-center justify-center">
                                        <i data-lucide="clipboard" class="w-4 h-4 mr-2"></i>
                                        Report Templates
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Center Tab -->
                    <div id="admin-security" class="admin-tab-content">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Security Center</h3>
                            <div class="flex space-x-3">
                                <button onclick="securityScan()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="shield-check" class="w-4 h-4 mr-2"></i>
                                    Run Security Scan
                                </button>
                                <button onclick="securityReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>
                                    Security Report
                                </button>
                            </div>
                        </div>

                        <!-- Security Status Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-green-600 rounded-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">Security Score</p>
                                        <p class="text-3xl font-bold">94/100</p>
                                        <p class="text-green-200 text-xs">Excellent</p>
                                    </div>
                                    <i data-lucide="shield-check" class="w-8 h-8"></i>
                                </div>
                            </div>
                            <div class="bg-yellow-600 rounded-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-yellow-100 text-sm">Active Threats</p>
                                        <p class="text-3xl font-bold">2</p>
                                        <p class="text-yellow-200 text-xs">Low Risk</p>
                                    </div>
                                    <i data-lucide="alert-triangle" class="w-8 h-8"></i>
                                </div>
                            </div>
                            <div class="bg-blue-600 rounded-lg p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">Last Scan</p>
                                        <p class="text-xl font-bold">2h ago</p>
                                        <p class="text-blue-200 text-xs">Automated</p>
                                    </div>
                                    <i data-lucide="clock" class="w-8 h-8"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Security Threats & Alerts -->
                        <div class="bg-gray-700 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Active Security Threats</h4>
                            <div class="space-y-4">
                                <div class="bg-red-500/20 border border-red-500/50 rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="alert-circle" class="w-5 h-5 text-red-400"></i>
                                            <div>
                                                <p class="text-red-300 font-medium">Suspicious Login Attempts</p>
                                                <p class="text-red-200 text-sm">15 failed login attempts from IP: 192.168.1.100</p>
                                                <p class="text-red-300 text-xs">Last attempt: 5 minutes ago</p>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Block IP</button>
                                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Investigate</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="shield-alert" class="w-5 h-5 text-yellow-400"></i>
                                            <div>
                                                <p class="text-yellow-300 font-medium">Outdated User Passwords</p>
                                                <p class="text-yellow-200 text-sm">23 users haven't updated passwords in 90+ days</p>
                                                <p class="text-yellow-300 text-xs">Recommendation: Force password reset</p>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">Force Reset</button>
                                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Send Warning</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Configuration -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Security Settings</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">Force 2FA for Admins</p>
                                            <p class="text-gray-400 text-sm">Require two-factor authentication</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">Auto-Lock Sessions</p>
                                            <p class="text-gray-400 text-sm">Lock inactive sessions after 30 minutes</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">IP Whitelist</p>
                                            <p class="text-gray-400 text-sm">Restrict access to approved IPs</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Encryption Status</h4>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="lock" class="w-5 h-5 text-green-400"></i>
                                            <span class="text-white">End-to-End Encryption</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-500/20 text-green-300 rounded-full">Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="database" class="w-5 h-5 text-green-400"></i>
                                            <span class="text-white">Database Encryption</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-500/20 text-green-300 rounded-full">Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="wifi" class="w-5 h-5 text-green-400"></i>
                                            <span class="text-white">SSL/TLS Encryption</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-500/20 text-green-300 rounded-full">Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="hard-drive" class="w-5 h-5 text-green-400"></i>
                                            <span class="text-white">File Storage Encryption</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-500/20 text-green-300 rounded-full">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Monitor Tab -->
                    <div id="admin-system" class="admin-tab-content">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">System Monitor</h3>
                            <div class="flex space-x-3">
                                <button onclick="refreshSystemStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                                    Refresh
                                </button>
                                <button onclick="systemMaintenance()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="wrench" class="w-4 h-4 mr-2"></i>
                                    Maintenance
                                </button>
                            </div>
                        </div>

                        <!-- System Performance Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">CPU Usage</p>
                                        <p class="text-2xl font-bold text-white">67%</p>
                                    </div>
                                    <i data-lucide="cpu" class="w-8 h-8 text-blue-400"></i>
                                </div>
                                <div class="mt-3">
                                    <div class="bg-gray-600 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full progress-67"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Memory Usage</p>
                                        <p class="text-2xl font-bold text-white">45%</p>
                                    </div>
                                    <i data-lucide="memory-stick" class="w-8 h-8 text-green-400"></i>
                                </div>
                                <div class="mt-3">
                                    <div class="bg-gray-600 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full progress-45"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Disk Usage</p>
                                        <p class="text-2xl font-bold text-white">82%</p>
                                    </div>
                                    <i data-lucide="hard-drive" class="w-8 h-8 text-yellow-400"></i>
                                </div>
                                <div class="mt-3">
                                    <div class="bg-gray-600 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full progress-82"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Network I/O</p>
                                        <p class="text-2xl font-bold text-white">23MB/s</p>
                                    </div>
                                    <i data-lucide="wifi" class="w-8 h-8 text-purple-400"></i>
                                </div>
                                <div class="mt-3">
                                    <div class="bg-gray-600 rounded-full h-2">
                                        <div class="bg-purple-500 h-2 rounded-full progress-35"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Service Status -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Service Status</h4>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-white">Web Server</span>
                                        </div>
                                        <span class="text-green-400 text-sm">Running</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-white">Database</span>
                                        </div>
                                        <span class="text-green-400 text-sm">Running</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-white">Cache Service</span>
                                        </div>
                                        <span class="text-green-400 text-sm">Running</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                            <span class="text-white">Email Service</span>
                                        </div>
                                        <span class="text-yellow-400 text-sm">Warning</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-white">File Storage</span>
                                        </div>
                                        <span class="text-green-400 text-sm">Running</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Recent System Events</h4>
                                <div class="space-y-3">
                                    <div class="bg-gray-600 rounded-lg p-3">
                                        <div class="flex items-center space-x-2 text-sm">
                                            <i data-lucide="info" class="w-4 h-4 text-blue-400"></i>
                                            <span class="text-white">System backup completed</span>
                                        </div>
                                        <p class="text-gray-400 text-xs mt-1">10 minutes ago</p>
                                    </div>
                                    <div class="bg-gray-600 rounded-lg p-3">
                                        <div class="flex items-center space-x-2 text-sm">
                                            <i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-400"></i>
                                            <span class="text-white">High CPU usage detected</span>
                                        </div>
                                        <p class="text-gray-400 text-xs mt-1">25 minutes ago</p>
                                    </div>
                                    <div class="bg-gray-600 rounded-lg p-3">
                                        <div class="flex items-center space-x-2 text-sm">
                                            <i data-lucide="check" class="w-4 h-4 text-green-400"></i>
                                            <span class="text-white">Database optimization completed</span>
                                        </div>
                                        <p class="text-gray-400 text-xs mt-1">1 hour ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Actions -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="restartService('web')" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="power" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">Restart Web Server</div>
                            </button>
                            <button onclick="clearCache()" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="trash-2" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">Clear Cache</div>
                            </button>
                            <button onclick="runDiskCleanup()" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="hard-drive" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">Disk Cleanup</div>
                            </button>
                            <button onclick="viewSystemLogs()" class="bg-gray-600 hover:bg-gray-700 text-white p-4 rounded-lg text-center transition-colors">
                                <i data-lucide="file-text" class="w-6 h-6 mx-auto mb-2"></i>
                                <div class="text-sm font-medium">View Logs</div>
                            </button>
                        </div>
                    </div>

                    <!-- Analytics Tab -->
                    <div id="admin-analytics" class="admin-tab-content">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Analytics Dashboard</h3>
                            <div class="flex space-x-3">
                                <select class="bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    <option>Last 7 days</option>
                                    <option>Last 30 days</option>
                                    <option>Last 90 days</option>
                                    <option>Custom range</option>
                                </select>
                                <button onclick="exportAnalytics()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                    Export
                                </button>
                            </div>
                        </div>

                        <!-- Analytics Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Daily Active Users</p>
                                        <p class="text-2xl font-bold text-white">142</p>
                                        <p class="text-green-400 text-xs">+12% vs yesterday</p>
                                    </div>
                                    <i data-lucide="users" class="w-8 h-8 text-blue-400"></i>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Page Views</p>
                                        <p class="text-2xl font-bold text-white">3,247</p>
                                        <p class="text-green-400 text-xs">+8% vs yesterday</p>
                                    </div>
                                    <i data-lucide="eye" class="w-8 h-8 text-green-400"></i>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Ideas Created</p>
                                        <p class="text-2xl font-bold text-white">28</p>
                                        <p class="text-green-400 text-xs">+15% vs yesterday</p>
                                    </div>
                                    <i data-lucide="lightbulb" class="w-8 h-8 text-yellow-400"></i>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-400 text-sm">Chat Messages</p>
                                        <p class="text-2xl font-bold text-white">1,892</p>
                                        <p class="text-red-400 text-xs">-3% vs yesterday</p>
                                    </div>
                                    <i data-lucide="message-square" class="w-8 h-8 text-purple-400"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Feature Usage Statistics -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Most Used Features</h4>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="message-square" class="w-5 h-5 text-blue-400"></i>
                                            <span class="text-white">Chat</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="bg-gray-600 rounded-full h-2 w-20">
                                                <div class="bg-blue-500 h-2 rounded-full progress-85"></div>
                                            </div>
                                            <span class="text-gray-300 text-sm">85%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-400"></i>
                                            <span class="text-white">Ideas</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="bg-gray-600 rounded-full h-2 w-20">
                                                <div class="bg-yellow-500 h-2 rounded-full progress-72"></div>
                                            </div>
                                            <span class="text-gray-300 text-sm">72%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="trending-up" class="w-5 h-5 text-green-400"></i>
                                            <span class="text-white">Financial Dashboard</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="bg-gray-600 rounded-full h-2 w-20">
                                                <div class="bg-green-500 h-2 rounded-full progress-68"></div>
                                            </div>
                                            <span class="text-gray-300 text-sm">68%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <i data-lucide="clipboard-check" class="w-5 h-5 text-purple-400"></i>
                                            <span class="text-white">Task Management</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="bg-gray-600 rounded-full h-2 w-20">
                                                <div class="bg-purple-500 h-2 rounded-full progress-54"></div>
                                            </div>
                                            <span class="text-gray-300 text-sm">54%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">User Engagement</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Average Session Duration</span>
                                        <span class="text-white font-medium">18m 32s</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Pages per Session</span>
                                        <span class="text-white font-medium">4.2</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Bounce Rate</span>
                                        <span class="text-white font-medium">23%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Return Visitor Rate</span>
                                        <span class="text-white font-medium">76%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Geographic Distribution -->
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-white mb-4">User Geographic Distribution</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">United States</span>
                                        <span class="text-white font-medium">45%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Canada</span>
                                        <span class="text-white font-medium">23%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">United Kingdom</span>
                                        <span class="text-white font-medium">12%</span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Australia</span>
                                        <span class="text-white font-medium">8%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Germany</span>
                                        <span class="text-white font-medium">6%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">France</span>
                                        <span class="text-white font-medium">4%</span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-300">Other</span>
                                        <span class="text-white font-medium">2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings Tab -->
                    <div id="admin-settings" class="admin-tab-content">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">System Settings</h3>
                            <div class="flex space-x-3">
                                <button onclick="saveSystemSettings()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                    Save Changes
                                </button>
                                <button onclick="resetToDefaults()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i data-lucide="rotate-ccw" class="w-4 h-4 mr-2"></i>
                                    Reset to Defaults
                                </button>
                            </div>
                        </div>

                        <!-- System Configuration -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">General Settings</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Site Name</label>
                                        <input type="text" value="Family Business Hub" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Site Description</label>
                                        <textarea rows="3" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">A comprehensive platform for family business management and collaboration.</textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Time Zone</label>
                                        <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                            <option>UTC-5 (Eastern Time)</option>
                                            <option>UTC-6 (Central Time)</option>
                                            <option>UTC-7 (Mountain Time)</option>
                                            <option>UTC-8 (Pacific Time)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Default Language</label>
                                        <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                            <option>English</option>
                                            <option>Spanish</option>
                                            <option>French</option>
                                            <option>German</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Feature Controls</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">User Registration</p>
                                            <p class="text-gray-400 text-sm">Allow new users to register</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">Email Notifications</p>
                                            <p class="text-gray-400 text-sm">Send system notifications via email</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">Chat Feature</p>
                                            <p class="text-gray-400 text-sm">Enable real-time chat functionality</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">File Uploads</p>
                                            <p class="text-gray-400 text-sm">Allow users to upload files</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">API Access</p>
                                            <p class="text-gray-400 text-sm">Enable external API access</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Email & Notification Settings -->
                        <div class="bg-gray-700 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Email & Notification Settings</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">SMTP Server</label>
                                        <input type="text" value="smtp.gmail.com" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">SMTP Port</label>
                                        <input type="text" value="587" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">From Email</label>
                                        <input type="email" value="noreply@familybusinesshub.com" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">From Name</label>
                                        <input type="text" value="Family Business Hub" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Admin Email</label>
                                        <input type="email" value="admin@familybusinesshub.com" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" id="test-email" class="rounded border-gray-400" checked>
                                        <label for="test-email" class="text-gray-300">Enable email notifications</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup & Maintenance Settings -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Backup Settings</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Backup Frequency</label>
                                        <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                            <option>Daily</option>
                                            <option>Weekly</option>
                                            <option>Monthly</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Backup Time</label>
                                        <input type="time" value="02:00" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Retention Period (days)</label>
                                        <input type="number" value="30" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                    <button onclick="runManualBackup()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg">
                                        Run Manual Backup
                                    </button>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-white mb-4">Maintenance Mode</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-white font-medium">Maintenance Mode</p>
                                            <p class="text-gray-400 text-sm">Put site in maintenance mode</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"></div>
                                        </label>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Maintenance Message</label>
                                        <textarea rows="3" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white" placeholder="We're performing scheduled maintenance..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Estimated Duration</label>
                                        <input type="text" placeholder="e.g., 2 hours" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- New Idea Modal -->
    <div id="new-idea-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">Submit New Idea</h3>
                <button onclick="closeNewIdeaModal()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
                            <form id="new-idea-form" onsubmit="submitNewIdea(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Idea Name</label>
                        <input type="text" id="new-idea-name" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Description</label>
                        <textarea id="new-idea-description" required class="w-full h-24 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">Category</label>
                            <select id="new-idea-category" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                                <option value="">Select Category</option>
                                <option value="Technology">Technology</option>
                                <option value="Food & Beverage">Food & Beverage</option>
                                <option value="Retail">Retail</option>
                                <option value="Service">Service</option>
                                <option value="Agriculture">Agriculture</option>
                                <option value="Education">Education</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">Priority</label>
                            <select id="new-idea-priority" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                                <option value="">Select Priority</option>
                                <option value="High">High Priority</option>
                                <option value="Medium">Medium Priority</option>
                                <option value="Low">Low Priority</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Estimated Budget ($)</label>
                        <input type="number" id="new-idea-budget" min="0" step="1000" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" placeholder="e.g. 15000">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Tags (comma-separated)</label>
                        <input type="text" id="new-idea-tags" class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" placeholder="e.g. technology, online, education">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Submitted By</label>
                        <input type="text" id="new-idea-submitter" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" value="Sarah Johnson">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeNewIdeaModal()" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                    <button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg">Submit Idea</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invite User Modal -->
    <div id="invite-user-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">Invite New User</h3>
                <button onclick="closeInviteUserModal()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <form id="invite-user-form" onsubmit="submitInviteUser(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Full Name</label>
                        <input type="text" id="invite-user-name" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" placeholder="Enter full name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Email Address</label>
                        <input type="email" id="invite-user-email" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none" placeholder="user@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Role</label>
                        <select id="invite-user-role" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            <option value="">Select Role</option>
                            <option value="admin">Admin - Full access to all features</option>
                            <option value="member">Member - Access to ideas, planning, and collaboration</option>
                            <option value="viewer">Viewer - Read-only access to shared content</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Welcome Message (Optional)</label>
                        <textarea id="invite-user-message" class="w-full h-20 bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none" placeholder="Add a personal welcome message..."></textarea>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="invite-user-notify" checked class="mr-3 h-4 w-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                        <label for="invite-user-notify" class="text-sm text-gray-300">Send invitation email immediately</label>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeInviteUserModal()" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i data-lucide="send" class="w-4 h-4 mr-2"></i>
                        Send Invitation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">Edit User</h3>
                <button onclick="closeEditUserModal()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <form id="edit-user-form" onsubmit="submitEditUser(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Full Name</label>
                        <input type="text" id="edit-user-name" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Email Address</label>
                        <input type="email" id="edit-user-email" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Role</label>
                        <select id="edit-user-role" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            <option value="admin">Admin - Full access to all features</option>
                            <option value="member">Member - Access to ideas, planning, and collaboration</option>
                            <option value="viewer">Viewer - Read-only access to shared content</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Status</label>
                        <select id="edit-user-status" required class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeEditUserModal()" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                    <button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                        Save Changes
                    </button>
                </div>
                <input type="hidden" id="edit-user-id" value="">
            </form>
        </div>
    </div>

    <!-- View User Modal -->
    <div id="view-user-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">User Details</h3>
                <button onclick="closeViewUserModal()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- User Avatar and Basic Info -->
                <div class="flex items-center space-x-4">
                    <div id="view-user-avatar" class="w-16 h-16 bg-gradient-to-br from-teal-400 to-blue-500 rounded-full flex items-center justify-center text-white font-semibold text-xl">
                        SJ
                    </div>
                    <div>
                        <h4 id="view-user-name" class="text-xl font-semibold text-white">Sarah Johnson</h4>
                        <p id="view-user-email" class="text-gray-400">sarah@johnsonfamily.com</p>
                        <span id="view-user-status" class="px-2 py-1 text-xs font-medium bg-green-600/20 text-green-300 rounded-full">Active</span>
                    </div>
                </div>
                
                <!-- User Stats -->
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <p class="text-2xl font-bold text-white" id="view-user-ideas">15</p>
                        <p class="text-sm text-gray-400">Ideas</p>
                    </div>
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <p class="text-2xl font-bold text-white" id="view-user-role">Admin</p>
                        <p class="text-sm text-gray-400">Role</p>
                    </div>
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <p class="text-sm font-medium text-white" id="view-user-last-active">2 hours ago</p>
                        <p class="text-sm text-gray-400">Last Active</p>
                    </div>
                </div>
                
                <!-- Additional Info -->
                <div class="space-y-3">
                    <div class="bg-gray-700/30 rounded-lg p-4">
                        <h5 class="font-semibold text-white mb-2">Access Level</h5>
                        <p id="view-user-permissions" class="text-gray-300 text-sm">Full access to all features including user management, business planning, and administrative functions.</p>
                    </div>
                    
                    <div class="bg-gray-700/30 rounded-lg p-4">
                        <h5 class="font-semibold text-white mb-2">Member Since</h5>
                        <p id="view-user-member-since" class="text-gray-300 text-sm">January 15, 2024</p>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-between pt-4">
                    <button onclick="editUserFromView()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <i data-lucide="edit" class="w-4 h-4 mr-2"></i>
                        Edit User
                    </button>
                    <button onclick="closeViewUserModal()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="alert-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm">
            <div class="text-center">
                <i data-lucide="check-circle" class="w-12 h-12 text-teal-500 mx-auto mb-4"></i>
                <p id="alert-message" class="text-white mb-4">Message will appear here</p>
                <button onclick="closeAlert()" class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-2 rounded-lg">OK</button>
            </div>
        </div>
    </div>

    <!-- Simple Footer -->
    <footer class="bg-gray-900 border-t border-gray-700 mt-8 px-4 py-6">
        <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
            <div class="text-gray-400 text-sm mb-4 md:mb-0">
                © 2024 Family Business Incubator Hub. All rights reserved.
            </div>
            <div class="flex space-x-6 text-sm">
                <a href="javascript:void(0)" onclick="navigateToLegal('terms-of-service')" class="text-gray-400 hover:text-white transition-colors">Terms of Service</a>
                <a href="javascript:void(0)" onclick="navigateToLegal('privacy-policy')" class="text-gray-400 hover:text-white transition-colors">Privacy Policy</a>
                <a href="mailto:legal@familybusinesshub.com.au" class="text-gray-400 hover:text-white transition-colors">Legal Contact</a>
            </div>
        </div>
    </footer>

    <script>
        // EmailJS Configuration for Email Invitations
        // 
        // DEMO MODE: Currently enabled - emails are simulated and logged to console
        // 
        // To set up REAL email functionality:
        // 1. Go to https://www.emailjs.com/
        // 2. Create a free account
        // 3. Add an email service (Gmail, Outlook, etc.)
        // 4. Create an email template with these variables:
        //    {{to_name}} - Recipient name
        //    {{to_email}} - Recipient email
        //    {{from_name}} - Your organization name
        //    {{user_role}} - User role (admin/member/viewer)
        //    {{welcome_message}} - Custom welcome message
        //    {{login_url}} - Link to login page
        //    {{invitation_date}} - Date of invitation
        //    {{role_description}} - Description of user role
        // 5. Replace the values below with your actual EmailJS credentials
        // 6. Set demoMode to false to enable real email sending
        
        const EMAILJS_CONFIG = {
            publicKey: 'YOUR_PUBLIC_KEY', // Replace with your EmailJS public key
            serviceId: 'YOUR_SERVICE_ID', // Replace with your EmailJS service ID  
            templateId: 'YOUR_TEMPLATE_ID', // Replace with your EmailJS template ID
            demoMode: true // Set to false when real EmailJS credentials are configured
        };

        // Initialize EmailJS
        function initializeEmailJS() {
            try {
                if (typeof emailjs !== 'undefined') {
                    emailjs.init(EMAILJS_CONFIG.publicKey);
                    console.log('EmailJS initialized successfully');
                }
            } catch (error) {
                console.error('EmailJS failed to initialize:', error);
            }
        }

        // Initialize Lucide icons with error handling
        function initializeLucide() {
            try {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            } catch (error) {
                console.error('Lucide icons failed to load:', error);
            }
        }
        
        // Initialize everything when page loads
        function initializePage() {
            initializeEmailJS();
        initializeLucide();
            
            // Initialize pagination if on user management page
            setTimeout(() => {
                const userManagement = document.getElementById('user-management');
                if (userManagement && userManagement.classList.contains('active')) {
                    updatePagination();
                }
            }, 500);
            
            console.log('🚀 Family Business Hub initialized - Action icons ready!');
        }
        
        // Test function to verify action icons work
        function testActionIcons() {
            console.log('🧪 Testing Action Icons...');
            console.log('✅ Edit User function:', typeof editUser === 'function');
            console.log('✅ View User function:', typeof viewUser === 'function'); 
            console.log('✅ Suspend User function:', typeof suspendUser === 'function');
            console.log('✅ Resend Invite function:', typeof resendInvite === 'function');
            console.log('✅ Cancel Invite function:', typeof cancelInvite === 'function');
            console.log('✅ Sample Users available:', Object.keys(sampleUsers).length, 'users');
            console.log('✅ Lucide library loaded:', typeof lucide !== 'undefined');
            console.log('🎯 Action buttons now use addEventListener() - they should work!');
            
            // Test with first user
            if (Object.keys(sampleUsers).length > 0) {
                const firstUserId = Object.keys(sampleUsers)[0];
                console.log(`💡 Try clicking action buttons for user ${firstUserId} (${sampleUsers[firstUserId].name})`);
            }
        }
        
        // Make functions globally accessible for debugging
        window.testActionIcons = testActionIcons;
        window.editUser = editUser;
        window.viewUser = viewUser;
        window.suspendUser = suspendUser;
        window.resendInvite = resendInvite;
        window.cancelInvite = cancelInvite;
        
        // Try to initialize on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }

        // Global app state
        let currentIdea = null;
        let ideas = [
            {
                id: 1,
                name: "Family Catering Service",
                description: "Start a local catering business specializing in family recipes and home-style cooking for events and corporate functions.",
                submitter: "Sarah Johnson",
                date: "2024-01-15",
                status: "New Ideas",
                category: "Food & Beverage",
                priority: "High",
                estimatedBudget: 15000,
                votes: {
                    upvotes: 12,
                    downvotes: 2,
                    userVotes: { "Sarah Johnson": "up", "Mike Johnson": "up", "Emma Johnson": "down" }
                },
                comments: [
                    { id: 1, author: "Mike Johnson", text: "Love this idea! We have great family recipes.", date: "2024-01-16", likes: 3 },
                    { id: 2, author: "Emma Johnson", text: "What about startup costs and licensing?", date: "2024-01-17", likes: 1 }
                ],
                tags: ["food", "catering", "family-recipes", "events"],
                feasibilityScore: 8.5,
                marketPotential: "High",
                contributors: ["Sarah Johnson", "Mike Johnson"]
            },
            {
                id: 2,
                name: "Online Tutoring Platform",
                description: "Create an online platform connecting family members who are teachers with local students needing academic support.",
                submitter: "Mike Johnson",
                date: "2024-01-18",
                status: "Researching",
                category: "Technology",
                priority: "Medium",
                estimatedBudget: 25000,
                votes: {
                    upvotes: 8,
                    downvotes: 1,
                    userVotes: { "Mike Johnson": "up", "Emma Johnson": "up", "Jane Johnson": "up" }
                },
                comments: [
                    { id: 3, author: "Emma Johnson", text: "Great idea! I can help with the teaching content.", date: "2024-01-19", likes: 2 },
                    { id: 4, author: "Sarah Johnson", text: "We need to research the competition thoroughly.", date: "2024-01-20", likes: 1 }
                ],
                tags: ["education", "technology", "online", "tutoring"],
                feasibilityScore: 7.2,
                marketPotential: "Medium",
                contributors: ["Mike Johnson", "Emma Johnson"]
            },
            {
                id: 3,
                name: "Handmade Crafts Shop",
                description: "Sell handmade crafts and artwork created by family members through an online store and local markets.",
                submitter: "Emma Johnson",
                date: "2024-01-20",
                status: "Planning",
                category: "Retail",
                priority: "Medium",
                estimatedBudget: 8000,
                votes: {
                    upvotes: 15,
                    downvotes: 0,
                    userVotes: { "Emma Johnson": "up", "Sarah Johnson": "up", "Mike Johnson": "up", "Jane Johnson": "up" }
                },
                comments: [
                    { id: 5, author: "Jane Johnson", text: "I can help with the online store setup!", date: "2024-01-21", likes: 4 },
                    { id: 6, author: "Sarah Johnson", text: "Let's start with a local market test first.", date: "2024-01-22", likes: 2 }
                ],
                tags: ["crafts", "handmade", "retail", "online-store"],
                feasibilityScore: 9.1,
                marketPotential: "High",
                contributors: ["Emma Johnson", "Jane Johnson", "Sarah Johnson"]
            },
            {
                id: 4,
                name: "Johnson Farm-to-Table",
                description: "Operating a local farm to provide fresh organic produce to restaurants and markets.",
                submitter: "Jane Johnson",
                date: "2024-01-10",
                status: "Approved",
                category: "Agriculture",
                priority: "High",
                estimatedBudget: 50000,
                votes: {
                    upvotes: 20,
                    downvotes: 3,
                    userVotes: { "Jane Johnson": "up", "Sarah Johnson": "up", "Mike Johnson": "up", "Emma Johnson": "up" }
                },
                comments: [
                    { id: 7, author: "Sarah Johnson", text: "This aligns perfectly with our family values!", date: "2024-01-11", likes: 5 },
                    { id: 8, author: "Mike Johnson", text: "Need to consider seasonal variations and storage.", date: "2024-01-12", likes: 3 }
                ],
                tags: ["agriculture", "organic", "farm-to-table", "sustainability"],
                feasibilityScore: 7.8,
                marketPotential: "High",
                contributors: ["Jane Johnson", "Sarah Johnson", "Mike Johnson"]
            },
            {
                id: 5,
                name: "Family Business Consulting",
                description: "Leverage our collective experience to provide consulting services to other family businesses.",
                submitter: "Mike Johnson",
                date: "2024-01-25",
                status: "New Ideas",
                category: "Service",
                priority: "Low",
                estimatedBudget: 5000,
                votes: {
                    upvotes: 6,
                    downvotes: 4,
                    userVotes: { "Mike Johnson": "up", "Sarah Johnson": "down", "Emma Johnson": "up" }
                },
                comments: [
                    { id: 9, author: "Emma Johnson", text: "We have decades of combined experience to share.", date: "2024-01-26", likes: 2 },
                    { id: 10, author: "Sarah Johnson", text: "Might conflict with our other ventures.", date: "2024-01-27", likes: 1 }
                ],
                tags: ["consulting", "family-business", "service", "experience"],
                feasibilityScore: 6.5,
                marketPotential: "Medium",
                contributors: ["Mike Johnson", "Emma Johnson"]
            }
        ];

        let setupCosts = [];
        let familyFunding = [];

        // Navigation functionality
        function navigateToPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-gray-700');
            });
            
            document.querySelector(`[data-page="${pageId}"]`)?.classList.add('bg-gray-700');
            
            // Special handling for admin page
            if (pageId === 'admin') {
                console.log('🔧 Navigating to admin panel');
                setTimeout(() => {
                    // Initialize all admin functionality
                    addAdminTabListeners();
                    showAdminTab('overview'); // Show overview tab by default
                    initializeAdminControls(); // Add toggle and form functionality
                    startLiveMetrics(); // Start real-time metrics
                    startAutoRefresh(); // Start auto-refresh for stats
                    console.log('✅ Admin panel fully initialized with all features!');
                }, 100);
            }
            
            // Update URL hash
            window.location.hash = pageId;
            
            // Update page-specific content
            if (pageId === 'ideas') {
                renderIdeasList();
            } else if (pageId === 'user-management') {
                // Initialize pagination when navigating to user management page
                setTimeout(() => {
                    updatePagination();
                    console.log('👥 User Management page loaded - Action icons ready!');
                    console.log('💡 Type testActionIcons() in console to verify functionality');
                }, 100);
            } else if (pageId === 'planner') {
                populatePlannerSelect();
            }
        }

        // Legal tab switching functionality
        function switchLegalTab(tabId) {
            // Hide all legal tab content
            document.querySelectorAll('.legal-tab-content').forEach(content => {
                content.classList.remove('active');
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.legal-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedContent = document.getElementById(tabId + '-content');
            if (selectedContent) {
                selectedContent.classList.add('active');
                selectedContent.classList.remove('hidden');
            }
            
            // Activate selected tab button
            const selectedTab = document.getElementById(tabId + '-tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }

        // Initialize legal tabs on page load
        function initializeLegalTabs() {
            // Default to business advice tab
            switchLegalTab('business-advice');
        }

        // Navigate to legal page and specific tab
        function navigateToLegal(tabId) {
            // First navigate to the legal page
            navigateToPage('legal');
            
            // Then switch to the specific tab
            setTimeout(() => {
                switchLegalTab(tabId);
            }, 100); // Small delay to ensure page is loaded
        }

        // Handle navigation clicks
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.getAttribute('data-page');
                navigateToPage(pageId);
            });
        });

        // Handle browser back/forward
        window.addEventListener('hashchange', () => {
            const pageId = window.location.hash.substring(1) || 'dashboard';
            navigateToPage(pageId);
        });

        // Initialize page based on URL
        window.addEventListener('load', () => {
            try {
                // Initialize icons first
                initializeLucide();
                
                // Then set up the page
                const pageId = window.location.hash.substring(1) || 'dashboard';
                navigateToPage(pageId);
                renderKanbanBoard();
                
                // Initialize legal tabs
                initializeLegalTabs();
                
                // Set up event listeners
                setupEventListeners();
            
            // Initialize pagination - display first page of users when on user management page
            if (window.location.hash === '#user-management' || document.getElementById('user-management').style.display !== 'none') {
                updatePagination();
            }
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });

        // Kanban board functionality
        function renderKanbanBoard() {
            const columns = {
                'New Ideas': document.getElementById('new-ideas-column'),
                'Researching': document.getElementById('researching-column'),
                'Planning': document.getElementById('planning-column'),
                'Approved': document.getElementById('approved-column')
            };

            // Clear columns
            Object.values(columns).forEach(column => {
                if (column) column.innerHTML = '';
            });

            // Add ideas to columns
            ideas.forEach(idea => {
                const ideaCard = createIdeaCard(idea);
                if (columns[idea.status]) {
                    columns[idea.status].appendChild(ideaCard);
                }
            });
            
            // Update dashboard stats and donut chart
            updateDashboardStats();
        }

        function createIdeaCard(idea) {
            const card = document.createElement('div');
            card.className = 'bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition-colors border border-gray-600 hover:border-teal-500';
            
            const netVotes = idea.votes ? (idea.votes.upvotes - idea.votes.downvotes) : 0;
            const userVote = idea.votes ? idea.votes.userVotes[currentUser] : null;
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-semibold text-white cursor-pointer" onclick="openIdeaDashboard(${idea.id})">${idea.name}</h4>
                    ${idea.votes ? `<div class="flex items-center space-x-1">
                        <button onclick="event.stopPropagation(); voteOnIdea(${idea.id}, 'up')" class="p-1 rounded hover:bg-gray-600 transition-colors ${userVote === 'up' ? 'text-green-400' : 'text-gray-400'}" title="Upvote">
                            <i data-lucide="chevron-up" class="w-3 h-3"></i>
                        </button>
                        <span class="text-${netVotes > 0 ? 'green' : netVotes < 0 ? 'red' : 'gray'}-400 font-medium min-w-[1.5rem] text-center">${netVotes}</span>
                        <button onclick="event.stopPropagation(); voteOnIdea(${idea.id}, 'down')" class="p-1 rounded hover:bg-gray-600 transition-colors ${userVote === 'down' ? 'text-red-400' : 'text-gray-400'}" title="Downvote">
                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                        </button>
                    </div>` : ''}
                </div>
                <p class="text-gray-400 text-sm mb-3 cursor-pointer" onclick="openIdeaDashboard(${idea.id})">${idea.description.substring(0, 80)}...</p>
                <div class="flex items-center justify-between text-xs text-gray-500">
                    <div class="flex items-center">
                        <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                        ${idea.submitter}
                    </div>
                    ${idea.priority ? `<span class="px-2 py-1 rounded text-xs ${idea.priority === 'High' ? 'bg-red-600/20 text-red-300' : idea.priority === 'Medium' ? 'bg-yellow-600/20 text-yellow-300' : 'bg-gray-600/20 text-gray-300'}">${idea.priority}</span>` : ''}
                </div>
                ${idea.category ? `<div class="mt-2">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-teal-600/20 text-teal-300">
                        <i data-lucide="tag" class="w-3 h-3 mr-1"></i>
                        ${idea.category}
                    </span>
                </div>` : ''}
            `;
            
            return card;
        }



        // Enhanced Ideas list functionality with voting and advanced features
        let currentUser = "Sarah Johnson"; // Current logged-in user
        let ideasViewMode = 'grid'; // 'grid' or 'list'
        
        function renderIdeasList() {
            const gridContainer = document.getElementById('ideas-grid-container');
            const listContainer = document.getElementById('ideas-list-container');
            
            if (!gridContainer || !listContainer) return;
            
            // Get filter values
            const statusFilter = document.getElementById('ideas-status-filter')?.value || 'all';
            const categoryFilter = document.getElementById('ideas-category-filter')?.value || 'all';
            const sortBy = document.getElementById('ideas-sort')?.value || 'votes';
            const searchTerm = document.getElementById('ideas-search')?.value.toLowerCase() || '';
            
            // Filter ideas
            let filteredIdeas = ideas.filter(idea => {
                const matchesStatus = statusFilter === 'all' || idea.status === statusFilter;
                const matchesCategory = categoryFilter === 'all' || idea.category === categoryFilter;
                const matchesSearch = searchTerm === '' || 
                    idea.name.toLowerCase().includes(searchTerm) ||
                    idea.description.toLowerCase().includes(searchTerm) ||
                    idea.submitter.toLowerCase().includes(searchTerm) ||
                    idea.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                return matchesStatus && matchesCategory && matchesSearch;
            });
            
            // Sort ideas
            filteredIdeas.sort((a, b) => {
                switch(sortBy) {
                    case 'votes':
                        return (b.votes.upvotes - b.votes.downvotes) - (a.votes.upvotes - a.votes.downvotes);
                    case 'recent':
                        return new Date(b.date) - new Date(a.date);
                    case 'comments':
                        return b.comments.length - a.comments.length;
                    case 'priority':
                        const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    default:
                        return 0;
                }
            });
            
            if (ideasViewMode === 'grid') {
                gridContainer.innerHTML = '';
                listContainer.classList.add('hidden');
                gridContainer.classList.remove('hidden');
                
                filteredIdeas.forEach(idea => {
                    const ideaCard = createEnhancedIdeaCard(idea);
                    gridContainer.appendChild(ideaCard);
                });
            } else {
                listContainer.innerHTML = '';
                gridContainer.classList.add('hidden');
                listContainer.classList.remove('hidden');
                
                filteredIdeas.forEach(idea => {
                    const ideaItem = createEnhancedIdeaListItem(idea);
                    listContainer.appendChild(ideaItem);
                });
            }
            
            // Reinitialize icons for new content
            initializeLucide();
        }
        
        function createEnhancedIdeaCard(idea) {
            const card = document.createElement('div');
            card.className = 'bg-gray-800 border border-gray-700 rounded-xl p-6 hover:transform hover:-translate-y-1 transition-all duration-200 cursor-pointer';
            
            const userVote = idea.votes.userVotes[currentUser];
            const netVotes = idea.votes.upvotes - idea.votes.downvotes;
            
            const priorityColors = {
                'High': 'bg-red-600/20 text-red-300 border-red-500/20',
                'Medium': 'bg-yellow-600/20 text-yellow-300 border-yellow-500/20',
                'Low': 'bg-gray-600/20 text-gray-300 border-gray-500/20'
            };
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center space-x-2">
                        <h3 class="text-lg font-semibold text-white">${idea.name}</h3>
                        <span class="px-2 py-1 text-xs rounded-full border ${priorityColors[idea.priority]}">${idea.priority}</span>
                    </div>
                    <span class="px-3 py-1 text-xs rounded-full bg-teal-500 text-white">${idea.status}</span>
                </div>
                
                <p class="text-gray-400 text-sm mb-4 line-clamp-3">${idea.description}</p>
                
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-1">
                            <i data-lucide="tag" class="w-3 h-3 text-gray-500"></i>
                            <span class="text-xs text-gray-500">${idea.category}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="dollar-sign" class="w-3 h-3 text-gray-500"></i>
                            <span class="text-xs text-gray-500">$${idea.estimatedBudget.toLocaleString()}</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1">
                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                        <span class="text-xs text-gray-500">${idea.feasibilityScore}/10</span>
                    </div>
                </div>
                
                <!-- Voting Section -->
                <div class="flex items-center justify-between border-t border-gray-700 pt-4">
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-1">
                            <button onclick="voteOnIdea(${idea.id}, 'up')" class="p-1 rounded hover:bg-gray-700 transition-colors ${userVote === 'up' ? 'text-green-400' : 'text-gray-500'}">
                                <i data-lucide="chevron-up" class="w-4 h-4"></i>
                            </button>
                            <span class="text-sm font-medium ${netVotes > 0 ? 'text-green-400' : netVotes < 0 ? 'text-red-400' : 'text-gray-400'}">${netVotes}</span>
                            <button onclick="voteOnIdea(${idea.id}, 'down')" class="p-1 rounded hover:bg-gray-700 transition-colors ${userVote === 'down' ? 'text-red-400' : 'text-gray-500'}">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="message-circle" class="w-4 h-4 text-gray-500"></i>
                            <span class="text-sm text-gray-500">${idea.comments.length}</span>
                        </div>
                    </div>
                    <button onclick="openIdeaDashboard(${idea.id})" class="bg-teal-500 hover:bg-teal-600 text-white px-3 py-1 rounded text-sm transition-colors">
                        View Details
                    </button>
                </div>
                
                <!-- Tags -->
                <div class="mt-3 flex flex-wrap gap-1">
                    ${idea.tags.slice(0, 3).map(tag => `<span class="px-2 py-1 bg-gray-700 text-gray-300 text-xs rounded">#${tag}</span>`).join('')}
                    ${idea.tags.length > 3 ? `<span class="text-xs text-gray-500">+${idea.tags.length - 3} more</span>` : ''}
                </div>
            `;
            
            return card;
        }
        
        function createEnhancedIdeaListItem(idea) {
            const item = document.createElement('div');
            item.className = 'bg-gray-800 border border-gray-700 rounded-lg p-6 hover:bg-gray-750 transition-colors';
            
            const userVote = idea.votes.userVotes[currentUser];
            const netVotes = idea.votes.upvotes - idea.votes.downvotes;
            
            item.innerHTML = `
                <div class="flex items-start space-x-6">
                    <!-- Voting Column -->
                    <div class="flex flex-col items-center space-y-1">
                        <button onclick="voteOnIdea(${idea.id}, 'up')" class="p-1 rounded hover:bg-gray-700 transition-colors ${userVote === 'up' ? 'text-green-400' : 'text-gray-500'}">
                            <i data-lucide="chevron-up" class="w-5 h-5"></i>
                        </button>
                        <span class="text-lg font-bold ${netVotes > 0 ? 'text-green-400' : netVotes < 0 ? 'text-red-400' : 'text-gray-400'}">${netVotes}</span>
                        <button onclick="voteOnIdea(${idea.id}, 'down')" class="p-1 rounded hover:bg-gray-700 transition-colors ${userVote === 'down' ? 'text-red-400' : 'text-gray-500'}">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <!-- Content Column -->
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-semibold text-white hover:text-teal-300 cursor-pointer" onclick="openIdeaDashboard(${idea.id})">${idea.name}</h3>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs rounded-full bg-${idea.priority === 'High' ? 'red' : idea.priority === 'Medium' ? 'yellow' : 'gray'}-600/20 text-${idea.priority === 'High' ? 'red' : idea.priority === 'Medium' ? 'yellow' : 'gray'}-300">${idea.priority}</span>
                                <span class="px-3 py-1 text-xs rounded-full bg-teal-500 text-white">${idea.status}</span>
                            </div>
                        </div>
                        
                        <p class="text-gray-400 mb-3">${idea.description}</p>
                        
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="user" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-gray-500">${idea.submitter}</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="calendar" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-gray-500">${new Date(idea.date).toLocaleDateString()}</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="message-circle" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-gray-500">${idea.comments.length} comments</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-gray-500">Budget: $${idea.estimatedBudget.toLocaleString()}</span>
                                <span class="text-gray-500">Score: ${idea.feasibilityScore}/10</span>
                            </div>
                        </div>
                        
                        <!-- Tags -->
                        <div class="mt-3 flex flex-wrap gap-1">
                            ${idea.tags.map(tag => `<span class="px-2 py-1 bg-gray-700 text-gray-300 text-xs rounded">#${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            return item;
        }

        // Business planner functionality
        function populatePlannerSelect() {
            const select = document.getElementById('planner-idea-select');
            if (select) {
                select.innerHTML = '<option value="">-- Select a Business Idea --</option>';
                
                const businessIdeas = [
                    { id: 'family-catering-service', name: 'Family Catering Service', description: 'Start a local catering business specializing in family recipes and home-style cooking.' },
                    { id: 'online-tutoring-platform', name: 'Online Tutoring Platform', description: 'Create an online platform connecting family members who are teachers with local students.' },
                    { id: 'handmade-crafts-shop', name: 'Handmade Crafts Shop', description: 'Sell handmade crafts and artwork created by family members through an online shop.' },
                    { id: 'farm-to-table', name: 'Johnson Farm-to-Table', description: 'Operating a local farm to provide fresh organic produce to restaurants and markets.' }
                ];
                
                businessIdeas.forEach(idea => {
                    const option = document.createElement('option');
                    option.value = idea.id;
                    option.textContent = idea.name;
                    option.setAttribute('data-description', idea.description);
                    select.appendChild(option);
                });
                
                // Add event listener for selection
                select.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const infoDiv = document.getElementById('selected-idea-info');
                    const nameDisplay = document.getElementById('idea-name-display');
                    const descDisplay = document.getElementById('idea-description-display');
                    
                    if (selectedOption.value && selectedOption.value !== 'custom') {
                        nameDisplay.textContent = selectedOption.textContent;
                        descDisplay.textContent = selectedOption.getAttribute('data-description');
                        infoDiv.classList.remove('hidden');
                    } else {
                        infoDiv.classList.add('hidden');
                    }
                });
            }
        }

        // Business Plan Builder functions
        function addCustomIdea() {
            const ideaName = prompt('Enter your custom business idea name:');
            const ideaDescription = prompt('Enter a brief description:');
            
            if (ideaName && ideaDescription) {
                const select = document.getElementById('planner-idea-select');
                const option = document.createElement('option');
                option.value = ideaName.toLowerCase().replace(/\s+/g, '-');
                option.textContent = ideaName;
                option.setAttribute('data-description', ideaDescription);
                option.selected = true;
                
                // Insert before the "Add Custom" option
                select.insertBefore(option, select.lastElementChild);
                
                // Show the info
                document.getElementById('idea-name-display').textContent = ideaName;
                document.getElementById('idea-description-display').textContent = ideaDescription;
                document.getElementById('selected-idea-info').classList.remove('hidden');
            }
        }

        function toggleSection(sectionName) {
            const content = document.getElementById(sectionName + '-content');
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.remove('lucide-chevron-down');
                icon.classList.add('lucide-chevron-up');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('lucide-chevron-up');
                icon.classList.add('lucide-chevron-down');
            }
            
            // Reinitialize icons
            initializeLucide();
        }

        function generateSuggestion(sectionType) {
            const suggestionDiv = document.getElementById(sectionType + '-suggestions');
            suggestionDiv.classList.remove('hidden');
            
            let suggestions = '';
            
            switch(sectionType) {
                case 'executive':
                    suggestions = `
                        <ul class="space-y-2">
                            <li>• Focus on your unique value proposition and what differentiates your business</li>
                            <li>• Quantify your market opportunity with specific numbers and data</li>
                            <li>• Include key financial milestones and funding requirements</li>
                            <li>• Highlight the experience and expertise of your family team</li>
                        </ul>
                    `;
                    break;
                case 'market':
                    suggestions = `
                        <ul class="space-y-2">
                            <li>• Research industry reports and market size data from credible sources</li>
                            <li>• Create detailed customer personas with demographics and behaviors</li>
                            <li>• Analyze 3-5 direct and indirect competitors thoroughly</li>
                            <li>• Identify market trends that support your business opportunity</li>
                        </ul>
                    `;
                    break;
                case 'marketing':
                    suggestions = `
                        <ul class="space-y-2">
                            <li>• Define your pricing strategy based on value and competition</li>
                            <li>• Choose marketing channels where your customers are most active</li>
                            <li>• Develop a customer acquisition and retention strategy</li>
                            <li>• Set measurable marketing goals and KPIs</li>
                        </ul>
                    `;
                    break;
                case 'operations':
                    suggestions = `
                        <ul class="space-y-2">
                            <li>• Map out your key business processes and workflows</li>
                            <li>• Identify technology and equipment needs</li>
                            <li>• Plan your organizational structure and key hires</li>
                            <li>• Consider quality control and customer service processes</li>
                        </ul>
                    `;
                    break;
                case 'financial':
                    suggestions = `
                        <ul class="space-y-2">
                            <li>• Create realistic revenue projections based on market research</li>
                            <li>• Include all startup costs and ongoing expenses</li>
                            <li>• Plan for seasonal variations and economic factors</li>
                            <li>• Include break-even analysis and cash flow projections</li>
                        </ul>
                    `;
                    break;
                case 'team':
                    suggestions = `
                        <ul class="space-y-2">
                            <li>• Define clear roles and responsibilities for each family member</li>
                            <li>• Consider skills, experience, and interests when assigning roles</li>
                            <li>• Plan for future hiring needs as the business grows</li>
                            <li>• Establish decision-making hierarchy and communication processes</li>
                            <li>• Include compensation structure and equity distribution</li>
                            <li>• Consider succession planning for key positions</li>
                        </ul>
                    `;
                    break;
            }
            
            suggestionDiv.querySelector('.text-blue-200').innerHTML = suggestions;
        }

        // SWOT Analysis AI suggestions
        function generateSWOTSuggestion(swotType) {
            const suggestionDiv = document.getElementById(swotType + '-suggestions');
            suggestionDiv.classList.remove('hidden');
            
            let suggestions = '';
            
            switch(swotType) {
                case 'strengths':
                    suggestions = `
                        <ul class="space-y-1 text-sm">
                            <li>• Strong family brand and reputation in the community</li>
                            <li>• Established customer relationships and trust</li>
                            <li>• Flexible decision-making with family ownership</li>
                            <li>• Diverse skill sets across family members</li>
                            <li>• Long-term vision and commitment to quality</li>
                            <li>• Local market knowledge and connections</li>
                        </ul>
                    `;
                    break;
                case 'weaknesses':
                    suggestions = `
                        <ul class="space-y-1 text-sm">
                            <li>• Limited access to capital compared to larger competitors</li>
                            <li>• Potential for family conflicts affecting business decisions</li>
                            <li>• May lack specialized expertise in certain areas</li>
                            <li>• Smaller marketing budget and reach</li>
                            <li>• Technology adoption may be slower</li>
                            <li>• Succession planning challenges</li>
                        </ul>
                    `;
                    break;
                case 'opportunities':
                    suggestions = `
                        <ul class="space-y-1 text-sm">
                            <li>• Growing demand for personalized, local services</li>
                            <li>• Digital transformation creating new market channels</li>
                            <li>• Partnerships with other local businesses</li>
                            <li>• Expansion into adjacent markets or services</li>
                            <li>• Government support programs for small businesses</li>
                            <li>• Sustainability trends favoring local businesses</li>
                        </ul>
                    `;
                    break;
                case 'threats':
                    suggestions = `
                        <ul class="space-y-1 text-sm">
                            <li>• Competition from large corporations and chains</li>
                            <li>• Economic downturns affecting customer spending</li>
                            <li>• Regulatory changes and compliance costs</li>
                            <li>• Rising operational costs and inflation</li>
                            <li>• Technology disruption changing customer expectations</li>
                            <li>• Talent acquisition challenges in competitive market</li>
                        </ul>
                    `;
                    break;
            }
            
            suggestionDiv.querySelector('div').innerHTML = suggestions;
            initializeLucide(); // Reinitialize icons
        }

        function savePlan() {
            showAlert('Business plan saved successfully!');
        }

        function exportPlan() {
            showAlert('Business plan exported to PDF! (Feature coming soon)');
        }

        function sharePlan() {
            showAlert('Business plan shared with family members!');
        }

        // Goal Management System
        let goalCounter = 0;
        
        function addGoal() {
            goalCounter++;
            const goalsContainer = document.getElementById('goals-container');
            
            const goalDiv = document.createElement('div');
            goalDiv.className = 'bg-gray-700 rounded-lg p-4 border border-gray-600';
            goalDiv.id = `goal-${goalCounter}`;
            
            goalDiv.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <h5 class="text-white font-semibold">Goal ${goalCounter}</h5>
                    <button onclick="removeGoal('goal-${goalCounter}')" class="text-red-400 hover:text-red-300">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Goal Title</label>
                        <input type="text" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="e.g., Achieve $100K revenue in Year 1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Description</label>
                        <textarea rows="2" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none resize-none" placeholder="Describe how you plan to achieve this goal..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Timeline</label>
                            <select class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                <option>Short-term (3-6 months)</option>
                                <option>Medium-term (6-12 months)</option>
                                <option>Long-term (1-3 years)</option>
                                <option>Strategic (3+ years)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Priority</label>
                            <select class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                <option>High</option>
                                <option>Medium</option>
                                <option>Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            
            goalsContainer.appendChild(goalDiv);
            initializeLucide(); // Reinitialize icons for the new trash button
        }
        
        function removeGoal(goalId) {
            const goalElement = document.getElementById(goalId);
            if (goalElement) {
                goalElement.remove();
            }
        }

        // Team Management System
        let teamCounter = 0;
        
        function addTeamMember() {
            teamCounter++;
            const teamContainer = document.getElementById('team-container');
            
            const teamDiv = document.createElement('div');
            teamDiv.className = 'bg-gray-700 rounded-lg p-4 border border-gray-600';
            teamDiv.id = `team-${teamCounter}`;
            
            teamDiv.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <h5 class="text-white font-semibold">Team Member ${teamCounter}</h5>
                    <button onclick="removeTeamMember('team-${teamCounter}')" class="text-red-400 hover:text-red-300">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Full Name</label>
                            <input type="text" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="Enter full name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Role/Position</label>
                            <input type="text" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="e.g., CEO, Marketing Manager">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Responsibilities</label>
                        <textarea rows="2" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none resize-none" placeholder="List key responsibilities and duties..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Family Relation</label>
                            <select class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                <option>Founder</option>
                                <option>Spouse</option>
                                <option>Child</option>
                                <option>Sibling</option>
                                <option>Parent</option>
                                <option>Extended Family</option>
                                <option>Non-Family</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Experience Level</label>
                            <select class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                <option>Beginner (0-2 years)</option>
                                <option>Intermediate (3-5 years)</option>
                                <option>Advanced (6-10 years)</option>
                                <option>Expert (10+ years)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Employment Status</label>
                            <select class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none">
                                <option>Full-time</option>
                                <option>Part-time</option>
                                <option>Consultant</option>
                                <option>Advisor</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Skills & Expertise</label>
                        <input type="text" class="w-full bg-gray-600 text-white px-3 py-2 rounded border border-gray-500 focus:border-teal-500 focus:outline-none" placeholder="e.g., Marketing, Finance, Operations, Technology">
                    </div>
                </div>
            `;
            
            teamContainer.appendChild(teamDiv);
            initializeLucide(); // Reinitialize icons for the new trash button
        }
        
        function removeTeamMember(teamId) {
            const teamElement = document.getElementById(teamId);
            if (teamElement) {
                teamElement.remove();
            }
        }

        // Marketing Checklist Management
        let marketingTaskCounter = 0;
        
        function addMarketingTask() {
            const taskTitle = prompt('Enter marketing task title:');
            const taskDescription = prompt('Enter task description (optional):');
            
            if (taskTitle) {
                marketingTaskCounter++;
                const checklistContainer = document.getElementById('marketing-checklist');
                
                const taskDiv = document.createElement('div');
                taskDiv.className = 'flex items-center bg-gray-700 rounded-lg p-3';
                taskDiv.id = `marketing-task-${marketingTaskCounter}`;
                
                taskDiv.innerHTML = `
                    <input type="checkbox" class="mr-3 h-4 w-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                    <div class="flex-1">
                        <span class="text-white font-medium">${taskTitle}</span>
                        ${taskDescription ? `<p class="text-gray-400 text-sm">${taskDescription}</p>` : ''}
                    </div>
                    <div class="flex items-center space-x-2">
                        <select class="text-xs bg-gray-600 text-gray-300 px-2 py-1 rounded border-gray-500 focus:border-teal-500">
                            <option>High Priority</option>
                            <option>Medium Priority</option>
                            <option>Low Priority</option>
                        </select>
                        <button onclick="removeMarketingTask('marketing-task-${marketingTaskCounter}')" class="text-red-400 hover:text-red-300 ml-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                
                checklistContainer.appendChild(taskDiv);
                initializeLucide(); // Reinitialize icons for the new trash button
            }
        }
        
        function removeMarketingTask(taskId) {
            const taskElement = document.getElementById(taskId);
            if (taskElement) {
                taskElement.remove();
            }
        }

        // Research Hub Tab Management
        function switchResearchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.research-tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
                content.classList.add('hidden');
            });
            
            // Remove active state from all tab buttons
            const tabButtons = document.querySelectorAll('.research-tab-btn');
            tabButtons.forEach(button => {
                button.classList.remove('active', 'text-white', 'border-teal-500');
                button.classList.add('text-gray-400', 'border-transparent');
            });
            
            // Show selected tab content
            const activeContent = document.getElementById(tabName === 'market' ? 'market-intelligence-content' : 
                                                      tabName === 'competitor' ? 'competitor-analysis-content' :
                                                      tabName === 'family' ? 'family-succession-content' :
                                                      'instructions-workflow-content');
            if (activeContent) {
                activeContent.classList.add('active');
                activeContent.classList.remove('hidden');
            }
            
            // Activate clicked tab button
            event.target.closest('button').classList.add('active', 'text-white', 'border-teal-500');
            event.target.closest('button').classList.remove('text-gray-400', 'border-transparent');
            
            // Reinitialize icons
            initializeLucide();
        }

        // Advanced Smart Search functionality
        function performSmartSearch() {
            const searchInput = document.getElementById('smart-search');
            const query = searchInput.value.trim();
            
            if (!query) {
                showAlert('Please enter a research question.');
                return;
            }
            
            const resultsDiv = document.getElementById('smart-search-results');
            const contentDiv = document.getElementById('search-analysis-content');
            
            // Show results container
            resultsDiv.classList.remove('hidden');
            
            // Show loading state
            contentDiv.innerHTML = `
                <div class="flex items-center space-x-3 mb-4">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-teal-500"></div>
                    <span class="text-gray-300">Leo is analyzing your question...</span>
                </div>
            `;
            
            // Simulate AI analysis after 2 seconds
            setTimeout(() => {
                const analysisResult = generateSmartSearchAnalysis(query);
                contentDiv.innerHTML = analysisResult;
                initializeLucide();
            }, 2000);
        }

        function generateSmartSearchAnalysis(query) {
            // Simulate intelligent analysis based on query keywords
            const analysisTemplates = {
                market: `
                    <div class="space-y-4">
                        <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                            <h5 class="font-semibold text-blue-300 mb-2">Market Opportunity Analysis</h5>
                            <p class="text-gray-300 text-sm mb-3">Based on your query "${query}", here's what Leo found:</p>
                            <ul class="space-y-2 text-gray-300 text-sm">
                                <li>• Market size is estimated at $2.1B with 12% annual growth</li>
                                <li>• Target demographic shows strong purchasing power</li>
                                <li>• 3 main market gaps identified for entry opportunity</li>
                                <li>• Seasonal trends favor Q2 and Q4 performance</li>
                            </ul>
                        </div>
                        <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                            <h5 class="font-semibold text-green-300 mb-2">Key Recommendations</h5>
                            <ul class="space-y-1 text-gray-300 text-sm">
                                <li>• Focus on premium service differentiation</li>
                                <li>• Target early adopters in urban areas</li>
                                <li>• Consider partnership strategies for rapid growth</li>
                            </ul>
                        </div>
                    </div>
                `,
                competitor: `
                    <div class="space-y-4">
                        <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                            <h5 class="font-semibold text-purple-300 mb-2">Competitive Landscape</h5>
                            <p class="text-gray-300 text-sm mb-3">Analysis for "${query}":</p>
                            <ul class="space-y-2 text-gray-300 text-sm">
                                <li>• 5 direct competitors identified in your target market</li>
                                <li>• Market leader has 35% market share but weak in customer service</li>
                                <li>• Price point gap exists in the $50-$100 range</li>
                                <li>• Technology adoption is low among traditional players</li>
                            </ul>
                        </div>
                        <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                            <h5 class="font-semibold text-yellow-300 mb-2">Differentiation Opportunities</h5>
                            <ul class="space-y-1 text-gray-300 text-sm">
                                <li>• Superior customer experience focus</li>
                                <li>• Mobile-first approach</li>
                                <li>• Family-oriented service model</li>
                            </ul>
                        </div>
                    </div>
                `,
                financial: `
                    <div class="space-y-4">
                        <div class="bg-teal-900/20 border border-teal-500/30 rounded-lg p-4">
                            <h5 class="font-semibold text-teal-300 mb-2">Financial Projections</h5>
                            <p class="text-gray-300 text-sm mb-3">Financial analysis for "${query}":</p>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-400">Startup Costs:</p>
                                    <p class="text-white font-semibold">$75,000 - $125,000</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Break-even:</p>
                                    <p class="text-white font-semibold">18-24 months</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">ROI (Year 3):</p>
                                    <p class="text-white font-semibold">35-45%</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Cash Flow Positive:</p>
                                    <p class="text-white font-semibold">Month 14-16</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            };
            
            // Determine analysis type based on query keywords
            const query_lower = query.toLowerCase();
            if (query_lower.includes('market') || query_lower.includes('size') || query_lower.includes('opportunity')) {
                return analysisTemplates.market;
            } else if (query_lower.includes('competitor') || query_lower.includes('competition') || query_lower.includes('rival')) {
                return analysisTemplates.competitor;
            } else if (query_lower.includes('financial') || query_lower.includes('revenue') || query_lower.includes('profit') || query_lower.includes('cost')) {
                return analysisTemplates.financial;
            } else {
                // General analysis
                return `
                    <div class="space-y-4">
                        <div class="bg-gray-700/50 rounded-lg p-4">
                            <h5 class="font-semibold text-white mb-2">General Business Analysis</h5>
                            <p class="text-gray-300 text-sm mb-3">Based on your query "${query}", here are Leo's insights:</p>
                            <ul class="space-y-2 text-gray-300 text-sm">
                                <li>• Market research suggests strong potential in this area</li>
                                <li>• Consider conducting primary research with target customers</li>
                                <li>• Develop minimum viable product (MVP) to test assumptions</li>
                                <li>• Build strategic partnerships early in the process</li>
                            </ul>
                        </div>
                        <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                            <h5 class="font-semibold text-blue-300 mb-2">Next Steps</h5>
                            <ul class="space-y-1 text-gray-300 text-sm">
                                <li>• Conduct detailed market validation</li>
                                <li>• Create financial projections</li>
                                <li>• Develop go-to-market strategy</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }

        function openMarketAnalysis() {
            const searchInput = document.getElementById('smart-search');
            searchInput.value = 'Analyze the market opportunity for my business idea including target demographics, market size, growth trends, and competitive landscape.';
            performSmartSearch();
        }

        function openCompetitorIntel() {
            const searchInput = document.getElementById('smart-search');
            searchInput.value = 'Perform competitive analysis including direct and indirect competitors, their strengths, weaknesses, market positioning, and pricing strategies.';
            performSmartSearch();
        }

        function openRiskAssessment() {
            const searchInput = document.getElementById('smart-search');
            searchInput.value = 'Identify potential business risks, challenges, and mitigation strategies including market, financial, operational, and regulatory risks.';
            performSmartSearch();
        }

        function pinToBusinessPlan() {
            showAlert('Analysis insights have been pinned to your Business Plan!');
            // In a real application, this would save the insights to the business plan
        }

        // Financial functionality
        function addCostItem() {
            const itemInput = document.getElementById('cost-item');
            const amountInput = document.getElementById('cost-amount');
            
            if (itemInput.value.trim() && amountInput.value && parseFloat(amountInput.value) > 0) {
                setupCosts.push({
                    item: itemInput.value.trim(),
                    amount: parseFloat(amountInput.value)
                });
                
                updateCostList();
                updateFinancialTotals();
                
                itemInput.value = '';
                amountInput.value = '';
                itemInput.focus();
            } else {
                alert('Please enter both a cost item and a positive amount.');
            }
        }

        function addFundingItem() {
            const memberInput = document.getElementById('funding-member');
            const amountInput = document.getElementById('funding-amount');
            
            if (memberInput.value.trim() && amountInput.value && parseFloat(amountInput.value) > 0) {
                familyFunding.push({
                    member: memberInput.value.trim(),
                    amount: parseFloat(amountInput.value)
                });
                
                updateFundingList();
                updateFinancialTotals();
                
                memberInput.value = '';
                amountInput.value = '';
                memberInput.focus();
            } else {
                alert('Please enter both a family member name and a positive amount.');
            }
        }

        function updateCostList() {
            const list = document.getElementById('cost-list');
            list.innerHTML = '';
            
            setupCosts.forEach((cost, index) => {
                const item = document.createElement('li');
                item.className = 'flex justify-between items-center text-gray-300 bg-gray-700 px-3 py-2 rounded mb-2';
                item.innerHTML = `
                    <span>${cost.item}</span>
                    <div class="flex items-center">
                        <span class="mr-2">$${cost.amount.toFixed(2)}</span>
                        <button onclick="removeCostItem(${index})" class="text-red-400 hover:text-red-300 ml-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                list.appendChild(item);
            });
            
            initializeLucide();
        }

        function updateFundingList() {
            const list = document.getElementById('funding-list');
            list.innerHTML = '';
            
            familyFunding.forEach((funding, index) => {
                const item = document.createElement('li');
                item.className = 'flex justify-between items-center text-gray-300 bg-gray-700 px-3 py-2 rounded mb-2';
                item.innerHTML = `
                    <span>${funding.member}</span>
                    <div class="flex items-center">
                        <span class="mr-2">$${funding.amount.toFixed(2)}</span>
                        <button onclick="removeFundingItem(${index})" class="text-red-400 hover:text-red-300 ml-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                list.appendChild(item);
            });
            
            initializeLucide();
        }

        function removeCostItem(index) {
            setupCosts.splice(index, 1);
            updateCostList();
            updateFinancialTotals();
        }

        function removeFundingItem(index) {
            familyFunding.splice(index, 1);
            updateFundingList();
            updateFinancialTotals();
        }

        function updateFinancialTotals() {
            const totalCost = setupCosts.reduce((sum, cost) => sum + cost.amount, 0);
            const totalFunding = familyFunding.reduce((sum, funding) => sum + funding.amount, 0);
            
            document.getElementById('total-cost').textContent = totalCost.toFixed(2);
            document.getElementById('total-funding').textContent = totalFunding.toFixed(2);
            document.getElementById('total-investment').value = totalCost.toFixed(2);
            
            calculateROI();
        }

        function calculateROI() {
            const investment = parseFloat(document.getElementById('total-investment').value) || 0;
            const profit = parseFloat(document.getElementById('projected-profit').value) || 0;
            
            let roi = 0;
            if (investment > 0) {
                roi = (profit / investment) * 100;
            }
            
            document.getElementById('roi-percentage').textContent = roi.toFixed(1);
        }

        // Modal functionality
        function openNewIdeaModal() {
            document.getElementById('new-idea-modal').classList.add('active');
        }

        function closeNewIdeaModal() {
            document.getElementById('new-idea-modal').classList.remove('active');
            document.getElementById('new-idea-name').value = '';
            document.getElementById('new-idea-description').value = '';
            document.getElementById('new-idea-submitter').value = '';
        }

        function submitNewIdea(event) {
            event.preventDefault();
            
            const name = document.getElementById('new-idea-name').value;
            const description = document.getElementById('new-idea-description').value;
            const submitter = document.getElementById('new-idea-submitter').value;
            const category = document.getElementById('new-idea-category').value;
            const priority = document.getElementById('new-idea-priority').value;
            const estimatedBudget = parseInt(document.getElementById('new-idea-budget').value) || 0;
            const tags = document.getElementById('new-idea-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            
            const newIdea = {
                id: Date.now(), // Use timestamp for unique ID
                name,
                description,
                submitter,
                category,
                priority,
                estimatedBudget,
                tags,
                date: new Date().toISOString().split('T')[0],
                status: 'New Ideas',
                votes: {
                    upvotes: 0,
                    downvotes: 0,
                    userVotes: {}
                },
                comments: [],
                feasibilityScore: 5.0,
                marketPotential: "Medium",
                contributors: [submitter]
            };
            
            ideas.push(newIdea);
            renderKanbanBoard();
            renderIdeasList(); // Update ideas page if visible
            closeNewIdeaModal();
            showAlert('Idea submitted successfully!');
            
            // Clear form
            document.getElementById('new-idea-form').reset();
        }

        function showAlert(message) {
            document.getElementById('alert-message').textContent = message;
            document.getElementById('alert-modal').classList.add('active');
        }

        function closeAlert() {
            document.getElementById('alert-modal').classList.remove('active');
        }

        // AI Research functionality
        function generateResearch() {
            const query = document.getElementById('research-query').value;
            if (!query) return;
            
            const resultsDiv = document.getElementById('research-results');
            const loader = document.getElementById('research-loader');
            const content = document.getElementById('research-content');
            
            resultsDiv.classList.remove('hidden');
            loader.classList.remove('hidden');
            content.classList.add('hidden');
            
            // Simulate AI response after 2 seconds
            setTimeout(() => {
                loader.classList.add('hidden');
                content.classList.remove('hidden');
                
                content.innerHTML = `
                    <h3 class="text-xl font-semibold text-white mb-4">Research Results for: "${query}"</h3>
                    <div class="space-y-4">
                        <div class="border-l-4 border-teal-500 pl-4">
                            <h4 class="font-semibold text-white mb-2">Market Analysis</h4>
                            <p class="text-gray-300">Based on current market trends, this business concept shows strong potential for growth. The target demographic is expanding, and there's increasing demand for similar services.</p>
                        </div>
                        <div class="border-l-4 border-teal-500 pl-4">
                            <h4 class="font-semibold text-white mb-2">Competition Overview</h4>
                            <p class="text-gray-300">Several competitors exist in this space, but there are opportunities for differentiation through unique value propositions and specialized service offerings.</p>
                        </div>
                        <div class="border-l-4 border-teal-500 pl-4">
                            <h4 class="font-semibold text-white mb-2">Recommended Next Steps</h4>
                            <ul class="text-gray-300 list-disc ml-4">
                                <li>Conduct detailed market survey</li>
                                <li>Develop MVP or prototype</li>
                                <li>Create financial projections</li>
                                <li>Identify key partnerships</li>
                            </ul>
                        </div>
                    </div>
                `;
            }, 2000);
        }

        // Advanced AI Research functionality
        function generateAdvancedResearch() {
            const query = document.getElementById('research-query-advanced').value;
            const researchType = document.getElementById('research-type').value;
            const includeSources = document.getElementById('include-sources').checked;
            const detailedAnalysis = document.getElementById('detailed-analysis').checked;
            
            if (!query) {
                showAlert('Please enter a research question.');
                return;
            }
            
            const resultsDiv = document.getElementById('research-results');
            const loader = document.getElementById('research-loader');
            const content = document.getElementById('research-content');
            
            resultsDiv.classList.remove('hidden');
            loader.classList.remove('hidden');
            content.classList.add('hidden');
            
            // Simulate advanced AI response
            setTimeout(() => {
                loader.classList.add('hidden');
                content.classList.remove('hidden');
                
                let analysisContent = `
                    <div class="bg-gray-700 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Advanced ${researchType.charAt(0).toUpperCase() + researchType.slice(1)} Research</h3>
                        <p class="text-gray-300">${query}</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="font-semibold text-white mb-3 flex items-center">
                                <i data-lucide="bar-chart" class="w-5 h-5 mr-2 text-teal-400"></i>
                                Key Insights
                            </h4>
                            <ul class="space-y-2 text-gray-300">
                                <li>• Market size estimated at $2.3B with 15% annual growth</li>
                                <li>• 3 main competitors dominate 60% of market share</li>
                                <li>• High demand in suburban demographics</li>
                                <li>• Seasonal variations impact Q4 performance</li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="font-semibold text-white mb-3 flex items-center">
                                <i data-lucide="target" class="w-5 h-5 mr-2 text-green-400"></i>
                                Opportunities
                            </h4>
                            <ul class="space-y-2 text-gray-300">
                                <li>• Underserved premium segment</li>
                                <li>• Technology integration gaps</li>
                                <li>• Regional expansion potential</li>
                                <li>• Partnership opportunities with local businesses</li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="font-semibold text-white mb-3 flex items-center">
                                <i data-lucide="alert-triangle" class="w-5 h-5 mr-2 text-yellow-400"></i>
                                Risk Factors
                            </h4>
                            <ul class="space-y-2 text-gray-300">
                                <li>• Regulatory compliance requirements</li>
                                <li>• High customer acquisition costs</li>
                                <li>• Supply chain dependencies</li>
                                <li>• Market saturation in urban areas</li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="font-semibold text-white mb-3 flex items-center">
                                <i data-lucide="lightbulb" class="w-5 h-5 mr-2 text-purple-400"></i>
                                Recommendations
                            </h4>
                            <ul class="space-y-2 text-gray-300">
                                <li>• Focus on premium service differentiation</li>
                                <li>• Develop mobile-first customer experience</li>
                                <li>• Start with local market validation</li>
                                <li>• Build strategic partnerships early</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                if (includeSources) {
                    analysisContent += `
                        <div class="mt-6 bg-gray-700 rounded-lg p-6">
                            <h4 class="font-semibold text-white mb-3 flex items-center">
                                <i data-lucide="link" class="w-5 h-5 mr-2 text-blue-400"></i>
                                Source References
                            </h4>
                            <div class="space-y-2 text-sm">
                                <p class="text-gray-300">• Industry Report 2024 - Market Research Institute</p>
                                <p class="text-gray-300">• Competitive Analysis - Business Intelligence Weekly</p>
                                <p class="text-gray-300">• Consumer Trends Study - Demographics Today</p>
                                <p class="text-gray-300">• Financial Forecasting - Economic Analysis Bureau</p>
                            </div>
                        </div>
                    `;
                }
                
                content.innerHTML = analysisContent;
                initializeLucide(); // Reinitialize icons
            }, 3000);
        }

        // Research tool functions
        function openMarketAnalysis() {
            document.getElementById('research-type').value = 'market';
            document.getElementById('research-query-advanced').value = 'Analyze the market opportunity for my business idea including target demographics, market size, growth trends, and competitive landscape.';
            document.getElementById('research-query-advanced').focus();
        }

        function openFinancialProjections() {
            document.getElementById('research-type').value = 'financial';
            document.getElementById('research-query-advanced').value = 'Generate 5-year financial projections including revenue forecasts, expense estimates, cash flow analysis, and break-even calculations.';
            document.getElementById('research-query-advanced').focus();
        }

        function openRiskAssessment() {
            document.getElementById('research-type').value = 'general';
            document.getElementById('research-query-advanced').value = 'Identify potential business risks, challenges, and mitigation strategies for my business concept including market, financial, operational, and regulatory risks.';
            document.getElementById('research-query-advanced').focus();
        }

        // Legal advice functionality
        function getLegalAdvice(type) {
            const description = document.getElementById('business-description').value;
            if (!description) {
                showAlert('Please enter a business description first.');
                return;
            }
            
            const adviceDiv = document.getElementById('legal-advice');
            const loader = document.getElementById('legal-loader');
            const content = document.getElementById('legal-content');
            
            adviceDiv.classList.remove('hidden');
            loader.classList.remove('hidden');
            content.classList.add('hidden');
            
            // Simulate AI response
            setTimeout(() => {
                loader.classList.add('hidden');
                content.classList.remove('hidden');
                
                let adviceContent = '';
                
                switch(type) {
                    case 'structure':
                        adviceContent = `
                            <h3 class="text-xl font-semibold text-white mb-4">Business Structure Recommendations</h3>
                            <div class="space-y-4">
                                <div class="bg-gray-700 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">LLC (Recommended)</h4>
                                    <p class="text-gray-300 mb-2">Best for most family businesses. Provides liability protection while maintaining flexibility.</p>
                                    <a href="#" class="text-teal-400 hover:text-teal-300">Learn more about LLC formation →</a>
                                </div>
                                <div class="bg-gray-700 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">Partnership</h4>
                                    <p class="text-gray-300 mb-2">Good for family businesses with multiple active owners.</p>
                                    <a href="#" class="text-teal-400 hover:text-teal-300">Partnership agreement templates →</a>
                                </div>
                            </div>
                        `;
                        break;
                    case 'tax':
                        adviceContent = `
                            <h3 class="text-xl font-semibold text-white mb-4">Tax Guidance</h3>
                            <div class="space-y-4">
                                <div class="bg-gray-700 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">Federal Tax Considerations</h4>
                                    <p class="text-gray-300 mb-2">Your business structure affects how you'll be taxed. Consider quarterly payments and business deductions.</p>
                                    <a href="#" class="text-teal-400 hover:text-teal-300">IRS small business guide →</a>
                                </div>
                                <div class="bg-gray-700 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">State and Local Taxes</h4>
                                    <p class="text-gray-300 mb-2">Don't forget about state sales tax, local business taxes, and employment taxes.</p>
                                    <a href="#" class="text-teal-400 hover:text-teal-300">Find your state requirements →</a>
                                </div>
                            </div>
                        `;
                        break;
                    case 'licensing':
                        adviceContent = `
                            <h3 class="text-xl font-semibold text-white mb-4">Required Licenses & Permits</h3>
                            <div class="space-y-4">
                                <div class="bg-gray-700 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">Business License</h4>
                                    <p class="text-gray-300 mb-2">Most businesses need a general business license from their city or county.</p>
                                    <a href="#" class="text-teal-400 hover:text-teal-300">Find local licensing requirements →</a>
                                </div>
                                <div class="bg-gray-700 rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">Industry-Specific Permits</h4>
                                    <p class="text-gray-300 mb-2">Depending on your business type, you may need specialized permits or certifications.</p>
                                    <a href="#" class="text-teal-400 hover:text-teal-300">Industry permit lookup →</a>
                                </div>
                            </div>
                        `;
                        break;
                }
                
                content.innerHTML = adviceContent;
            }, 1500);
        }

        // Modern Chat App functionality
        let currentChat = 'family-business';
        let uploadQueue = [];
        let replyingToMessage = null;
        let isRecording = false;
        let recordingStartTime = null;
        let recordingInterval = null;
        let isDarkMode = false;
        
        let chatData = {
            'family-business': {
                type: 'group',
                name: 'Family Business',
                members: ['John', 'Sarah', 'Mike', 'Emma', 'You'],
                messages: []
            },
            'john-private': {
                type: 'private',
                name: 'John',
                messages: []
            },
            'sarah-private': {
                type: 'private', 
                name: 'Sarah',
                messages: []
            }
        };

        // Modern message sending
        function sendModernMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message || uploadQueue.length > 0) {
                const messagesContainer = document.getElementById('chat-messages');
                const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Create outgoing message
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-end justify-end mb-4';
                
                let attachmentsHtml = '';
                if (uploadQueue.length > 0) {
                    attachmentsHtml = uploadQueue.map(file => {
                        if (file.type.startsWith('image/')) {
                            return `
                                <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600 mt-2">
                                    <img src="${URL.createObjectURL(file)}" alt="${file.name}" class="w-full h-auto max-h-64 object-cover">
                                </div>
                            `;
                        } else if (file.type.startsWith('video/')) {
                            return `
                                <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600 mt-2">
                                    <video controls class="w-full h-auto max-h-64">
                                        <source src="${URL.createObjectURL(file)}" type="${file.type}">
                                    </video>
                                </div>
                            `;
                        } else {
                            return `
                                <div class="flex items-center p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 mt-2">
                                    <i data-lucide="file" class="w-5 h-5 text-gray-500 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">${file.name}</p>
                                        <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(1)} MB</p>
                                    </div>
                                </div>
                            `;
                        }
                    }).join('');
                }
                
                messageDiv.innerHTML = `
                    <div class="flex-1 max-w-xs text-right">
                        <div class="bg-teal-500 rounded-2xl rounded-tr-sm p-3 shadow-sm">
                            ${message ? `<p class="text-white text-sm">${message}</p>` : ''}
                            ${attachmentsHtml}
                            </div>
                        <div class="flex items-center justify-end mt-1 mr-2">
                            <i data-lucide="check-check" class="w-3 h-3 text-blue-500 mr-1"></i>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${timestamp}</span>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Clear input and reset state
                input.value = '';
                uploadQueue = [];
                clearFilePreview();
                hideEmojiPicker();
                
                // Auto-resize textarea
                input.style.height = 'auto';
                
                initializeLucide();
                
                // Simulate message delivery
                setTimeout(() => {
                    const checkIcons = messageDiv.querySelectorAll('[data-lucide="check-check"]');
                    checkIcons.forEach(icon => {
                        icon.classList.remove('text-blue-500');
                        icon.classList.add('text-blue-600');
                    });
                }, 1000);
            }
        }

        // Modern file handling
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            uploadQueue.push(...files);
            displayModernFilePreview();
            hideAttachmentMenu();
            event.target.value = '';
        }

        function displayModernFilePreview() {
            const previewContainer = document.getElementById('file-preview');
            const previewList = document.getElementById('file-preview-list');
            
            if (uploadQueue.length > 0) {
                previewContainer.classList.remove('hidden');
                previewList.innerHTML = uploadQueue.map((file, index) => {
                    const isImage = file.type.startsWith('image/');
                    const isVideo = file.type.startsWith('video/');
                    const iconName = isImage ? 'image' : isVideo ? 'video' : 'file';
                    const iconColor = isImage ? 'text-blue-500' : isVideo ? 'text-purple-500' : 'text-gray-500';
                    
                    return `
                        <div class="file-preview-item flex items-center">
                            <i data-lucide="${iconName}" class="w-5 h-5 ${iconColor} mr-3"></i>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">${file.name}</p>
                                <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(1)} MB</p>
                            </div>
                            <button onclick="removeFromUploadQueue(${index})" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 ml-2">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                }).join('');
                initializeLucide();
            } else {
                previewContainer.classList.add('hidden');
            }
        }

        function clearFilePreview() {
            uploadQueue = [];
            document.getElementById('file-preview').classList.add('hidden');
        }

        function removeFromUploadQueue(index) {
            uploadQueue.splice(index, 1);
            displayModernFilePreview();
        }

        // Attachment menu functions
        function toggleAttachmentMenu() {
            const menu = document.getElementById('attachment-menu');
            menu.classList.toggle('hidden');
        }

        function hideAttachmentMenu() {
            document.getElementById('attachment-menu').classList.add('hidden');
        }

        function selectFiles(type) {
            const fileInput = document.getElementById('file-input');
            
            switch(type) {
                case 'image':
                    fileInput.accept = 'image/*,video/*';
                    break;
                case 'file':
                    fileInput.accept = '.pdf,.doc,.docx,.txt,.xlsx,.ppt,.pptx';
                    break;
                case 'audio':
                    fileInput.accept = 'audio/*';
                    break;
                default:
                    fileInput.accept = '*/*';
            }
            
            fileInput.click();
            hideAttachmentMenu();
        }

        // Modern chat input handling
        function handleChatKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendModernMessage();
            }
        }

        function handleChatInput(event) {
            const textarea = event.target;
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            
            // Show typing indicator for other users (simulated)
            showTypingIndicator();
        }

        function showTypingIndicator() {
            // In real implementation, this would notify other users
            clearTimeout(window.typingTimeout);
            window.typingTimeout = setTimeout(() => {
                // Hide typing indicator
            }, 2000);
        }

        // Chat management
        function openChat(chatId) {
            currentChat = chatId;
            
            // Update active chat in sidebar
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[onclick="openChat('${chatId}')"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // Update chat header
            const chat = chatData[chatId];
            if (chat) {
                document.getElementById('current-chat-name').textContent = chat.name;
                if (chat.type === 'group') {
                    document.getElementById('current-chat-status').textContent = `${chat.members.length} members`;
                } else {
                    document.getElementById('current-chat-status').textContent = 'Online';
                }
            }
            
            // Clear unread badges
            const unreadBadge = activeItem?.querySelector('.w-2.h-2.bg-teal-500');
            if (unreadBadge) {
                unreadBadge.style.display = 'none';
            }
        }

        function backToChatList() {
            // For mobile responsiveness
            const chatDetail = document.getElementById('chat-detail-container');
            const chatList = chatDetail.previousElementSibling;
            
            chatDetail.classList.add('hidden');
            chatList.classList.remove('hidden');
        }

        function filterChats(filter) {
            // Update active filter tab
            document.querySelectorAll('.chat-filter-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.remove('text-teal-600', 'dark:text-teal-400', 'border-teal-600', 'dark:border-teal-400');
                tab.classList.add('text-gray-600', 'dark:text-gray-400');
            });
            
            const activeTab = document.querySelector(`[onclick="filterChats('${filter}')"]`);
            if (activeTab) {
                activeTab.classList.add('active', 'text-teal-600', 'dark:text-teal-400', 'border-b-2', 'border-teal-600', 'dark:border-teal-400');
                activeTab.classList.remove('text-gray-600', 'dark:text-gray-400');
            }
            
            // Filter chat items based on criteria
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(item => {
                const hasUnread = item.querySelector('.w-2.h-2.bg-teal-500');
                const isGroup = item.querySelector('[data-lucide="users"]');
                
                let shouldShow = true;
                
                switch(filter) {
                    case 'unread':
                        shouldShow = hasUnread !== null;
                        break;
                    case 'groups':
                        shouldShow = isGroup !== null;
                        break;
                    case 'all':
                    default:
                        shouldShow = true;
                        break;
                }
                
                item.style.display = shouldShow ? 'block' : 'none';
            });
        }

        function startNewChat() {
            // Create new chat modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'new-chat-modal';
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Start New Chat</h3>
                        <button onclick="closeNewChat()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                            <input type="text" placeholder="Search contacts..." class="w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-700 border-0 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    
                    <div class="space-y-2 max-h-64 overflow-y-auto">
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="createNewChat('john', 'John')">
                            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">J</span>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900 dark:text-white">John</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Online</p>
                            </div>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        </div>
                        
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="createNewChat('sarah', 'Sarah')">
                            <div class="w-10 h-10 bg-pink-500 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">S</span>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900 dark:text-white">Sarah</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Online</p>
                            </div>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        </div>
                        
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="createNewChat('mike', 'Mike')">
                            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">M</span>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900 dark:text-white">Mike</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Away</p>
                            </div>
                            <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                        </div>
                        
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="createNewChat('emma', 'Emma')">
                            <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">E</span>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900 dark:text-white">Emma</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Last seen 2 hours ago</p>
                            </div>
                            <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
                        <button onclick="createGroupChat()" class="w-full flex items-center justify-center p-3 bg-teal-500 hover:bg-teal-600 text-white rounded-lg transition-colors">
                            <i data-lucide="users" class="w-5 h-5 mr-2"></i>
                            Create Group Chat
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
        }

        function closeNewChat() {
            const modal = document.getElementById('new-chat-modal');
            if (modal) modal.remove();
        }

        function createNewChat(userId, userName) {
            showAlert(`💬 Started new chat with ${userName}!`);
            closeNewChat();
            
            // In a real app, this would create a new chat and switch to it
            // For now, we'll just show a success message
        }

        function createGroupChat() {
            showAlert('👥 Group chat creation: Select multiple contacts to create a group chat.');
            closeNewChat();
        }

        // Message reactions and interactions
        function addReaction(button, emoji) {
            const messageGroup = button.closest('.message-group');
            let reactionsContainer = messageGroup.querySelector('.flex.items-center.mt-2');
            
            if (!reactionsContainer) {
                reactionsContainer = document.createElement('div');
                reactionsContainer.className = 'flex items-center mt-2 space-x-1';
                messageGroup.querySelector('.flex-1').appendChild(reactionsContainer);
            }
            
            const reactionSpan = document.createElement('span');
            reactionSpan.className = 'bg-gray-600 text-white text-xs px-2 py-1 rounded-full flex items-center';
            reactionSpan.innerHTML = `${emoji} 1`;
            reactionsContainer.appendChild(reactionSpan);
        }

        function replyToMessage(button) {
            const messageGroup = button.closest('.message-group');
            const authorName = messageGroup.querySelector('.font-semibold').textContent;
            const messageText = messageGroup.querySelector('.text-gray-300').textContent;
            
            const replyPreview = document.getElementById('reply-preview');
            replyPreview.classList.remove('hidden');
            replyPreview.querySelector('.font-semibold').textContent = authorName;
            replyPreview.querySelector('.truncate').textContent = messageText;
            
            document.getElementById('chat-input').focus();
        }

        function cancelReply() {
            document.getElementById('reply-preview').classList.add('hidden');
        }

        function editMessage(button) {
            showAlert('Message editing functionality available in full version.');
        }

        // Modern emoji functions
        function toggleEmojiPicker() {
            const picker = document.getElementById('emoji-picker');
            picker.classList.toggle('hidden');
            hideAttachmentMenu(); // Hide attachment menu if open
        }

        function hideEmojiPicker() {
            document.getElementById('emoji-picker').classList.add('hidden');
        }

        function insertEmoji(emoji) {
            const input = document.getElementById('chat-input');
            const currentValue = input.value;
            const cursorPos = input.selectionStart || 0;
            
            const newValue = currentValue.slice(0, cursorPos) + emoji + currentValue.slice(cursorPos);
            input.value = newValue;
            
            const newCursorPos = cursorPos + emoji.length;
            input.setSelectionRange(newCursorPos, newCursorPos);
            
            hideEmojiPicker();
            input.focus();
            
            // Trigger input event to resize textarea if needed
            input.dispatchEvent(new Event('input'));
        }

        // Voice message functions
        function startVoiceRecording() {
            if (isRecording) return;
            
            isRecording = true;
            recordingStartTime = Date.now();
            
            document.getElementById('voice-recording').classList.remove('hidden');
            document.getElementById('voice-btn').innerHTML = '<i data-lucide="square" class="w-4 h-4 text-red-500"></i>';
            
            // Start recording timer
            recordingInterval = setInterval(updateRecordingTime, 100);
            
            // In real implementation, start actual audio recording here
            navigator.mediaDevices?.getUserMedia({ audio: true })
                .then(stream => {
                    // Handle audio stream
                    console.log('Recording started');
                })
                .catch(err => {
                    console.log('Microphone access denied');
                    cancelVoiceRecording();
                });
        }

        function stopVoiceRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            clearInterval(recordingInterval);
            
            const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
            
            if (duration < 1) {
                cancelVoiceRecording();
                return;
            }
            
            // Create voice message
            sendVoiceMessage(duration);
            
            document.getElementById('voice-recording').classList.add('hidden');
            document.getElementById('voice-btn').innerHTML = '<i data-lucide="mic" class="w-4 h-4"></i>';
        }

        function cancelVoiceRecording() {
            isRecording = false;
            clearInterval(recordingInterval);
            
            document.getElementById('voice-recording').classList.add('hidden');
            document.getElementById('voice-btn').innerHTML = '<i data-lucide="mic" class="w-4 h-4"></i>';
        }

        function updateRecordingTime() {
            if (!isRecording) return;
            
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('recording-time').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function sendVoiceMessage(duration) {
            const messagesContainer = document.getElementById('chat-messages');
            const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-end justify-end mb-4';
            
            messageDiv.innerHTML = `
                <div class="flex-1 max-w-xs text-right">
                    <div class="bg-teal-500 rounded-2xl rounded-tr-sm p-3 shadow-sm">
                        <div class="flex items-center space-x-3">
                            <button class="flex-shrink-0 w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i data-lucide="play" class="w-4 h-4 text-white"></i>
                            </button>
                            <div class="flex-1">
                                <div class="flex items-center space-x-1 mb-1">
                                    <div class="flex space-x-0.5">
                                        ${Array.from({length: 20}, (_, i) => {
                                            const height = Math.floor(Math.random() * 12) + 4;
                                            return `<div class="w-0.5 bg-white bg-opacity-60 rounded-full" style="height: ${height}px;"></div>`;
                                        }).join('')}
                                    </div>
                                </div>
                                <span class="text-xs text-white text-opacity-80">${Math.floor(duration / 60)}:${(duration % 60).toString().padStart(2, '0')}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center justify-end mt-1 mr-2">
                        <i data-lucide="check-check" class="w-3 h-3 text-blue-500 mr-1"></i>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${timestamp}</span>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            initializeLucide();
        }

        // Enhanced Story functions
        function openStoryCamera() {
            // Create story camera modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.id = 'story-camera-modal';
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Create Story</h3>
                        <button onclick="closeStoryCamera()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <button onclick="capturePhoto()" class="w-full flex items-center justify-center p-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors">
                            <i data-lucide="camera" class="w-5 h-5 mr-2"></i>
                            Take Photo
                        </button>
                        
                        <button onclick="captureVideo()" class="w-full flex items-center justify-center p-4 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                            <i data-lucide="video" class="w-5 h-5 mr-2"></i>
                            Record Video
                        </button>
                        
                        <input type="file" id="story-file-input" accept="image/*,video/*" class="hidden" onchange="handleStoryUpload(event)">
                        <button onclick="document.getElementById('story-file-input').click()" class="w-full flex items-center justify-center p-4 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
                            <i data-lucide="upload" class="w-5 h-5 mr-2"></i>
                            Upload from Gallery
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
        }

        function closeStoryCamera() {
            const modal = document.getElementById('story-camera-modal');
            if (modal) modal.remove();
        }

        function capturePhoto() {
            showAlert('📸 Photo capture will access your camera to take a picture for your story.');
            closeStoryCamera();
        }

        function captureVideo() {
            showAlert('🎥 Video recording will access your camera to record a video story.');
            closeStoryCamera();
        }

        function handleStoryUpload(event) {
            const file = event.target.files[0];
            if (file) {
                showAlert(`📁 Uploaded ${file.name} to your story! Stories will be visible to family members for 24 hours.`);
                closeStoryCamera();
            }
        }

        function viewStory(userId) {
            // Create story viewer modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black flex items-center justify-center z-50';
            modal.id = 'story-viewer-modal';
            
            modal.innerHTML = `
                <div class="relative w-full max-w-sm mx-4">
                    <button onclick="closeStoryViewer()" class="absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    
                    <div class="bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg overflow-hidden">
                        <div class="p-4 text-white">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                    <span class="font-bold">${userId.charAt(0).toUpperCase()}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold">${userId.charAt(0).toUpperCase() + userId.slice(1)}'s Story</h3>
                                    <p class="text-sm opacity-75">2 hours ago</p>
                                </div>
                            </div>
                            
                            <div class="bg-white bg-opacity-10 rounded-lg p-6 text-center min-h-[300px] flex items-center justify-center">
                                <div>
                                    <i data-lucide="image" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                                    <p class="text-lg mb-2">Family Business Update!</p>
                                    <p class="text-sm opacity-75">Working on our catering menu designs today. Exciting progress!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
        }

        function closeStoryViewer() {
            const modal = document.getElementById('story-viewer-modal');
            if (modal) modal.remove();
        }

        // Enhanced Call functions
        function startVideoCall() {
            // Create video call interface
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black flex items-center justify-center z-50';
            modal.id = 'video-call-modal';
            
            modal.innerHTML = `
                <div class="relative w-full h-full max-w-4xl mx-4 bg-gray-900 rounded-lg overflow-hidden">
                    <div class="absolute top-4 left-4 z-10 text-white">
                        <h3 class="text-lg font-semibold">Video Call - ${document.getElementById('current-chat-name').textContent}</h3>
                        <p class="text-sm opacity-75" id="call-timer">Connecting...</p>
                    </div>
                    
                    <div class="absolute top-4 right-4 z-10">
                        <button onclick="endVideoCall()" class="bg-red-500 hover:bg-red-600 text-white p-3 rounded-full transition-colors">
                            <i data-lucide="phone-off" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="h-full flex items-center justify-center bg-gradient-to-br from-blue-900 to-purple-900">
                        <div class="text-center text-white">
                            <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="video" class="w-16 h-16"></i>
                            </div>
                            <p class="text-xl mb-2">Connecting to video call...</p>
                            <p class="opacity-75">This would integrate with WebRTC for real video calls</p>
                        </div>
                    </div>
                    
                    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-4">
                        <button onclick="toggleMute()" class="bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full transition-colors">
                            <i data-lucide="mic" class="w-5 h-5"></i>
                        </button>
                        <button onclick="toggleCamera()" class="bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full transition-colors">
                            <i data-lucide="video" class="w-5 h-5"></i>
                        </button>
                        <button onclick="shareScreen()" class="bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full transition-colors">
                            <i data-lucide="screen-share" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
            
            // Simulate call timer
            let seconds = 0;
            const timer = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const timerElement = document.getElementById('call-timer');
                if (timerElement) {
                    timerElement.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                } else {
                    clearInterval(timer);
                }
            }, 1000);
        }

        function endVideoCall() {
            const modal = document.getElementById('video-call-modal');
            if (modal) modal.remove();
        }

        function toggleMute() {
            showAlert('🎤 Microphone toggled');
        }

        function toggleCamera() {
            showAlert('📹 Camera toggled');
        }

        function shareScreen() {
            showAlert('🖥️ Screen sharing toggled');
        }

        function startVoiceCall() {
            // Create voice call interface
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50';
            modal.id = 'voice-call-modal';
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-8 max-w-sm w-full mx-4 text-center">
                    <div class="w-24 h-24 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl font-bold text-white">${document.getElementById('current-chat-name').textContent.charAt(0)}</span>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">${document.getElementById('current-chat-name').textContent}</h3>
                    <p class="text-gray-500 dark:text-gray-400 mb-6" id="voice-call-status">Calling...</p>
                    
                    <div class="flex items-center justify-center space-x-6">
                        <button onclick="toggleVoiceMute()" class="bg-gray-500 hover:bg-gray-600 text-white p-4 rounded-full transition-colors">
                            <i data-lucide="mic" class="w-6 h-6"></i>
                        </button>
                        
                        <button onclick="endVoiceCall()" class="bg-red-500 hover:bg-red-600 text-white p-4 rounded-full transition-colors">
                            <i data-lucide="phone-off" class="w-6 h-6"></i>
                        </button>
                        
                        <button onclick="toggleSpeaker()" class="bg-gray-500 hover:bg-gray-600 text-white p-4 rounded-full transition-colors">
                            <i data-lucide="volume-2" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
            
            // Simulate call progression
            setTimeout(() => {
                const status = document.getElementById('voice-call-status');
                if (status) status.textContent = 'Connected';
            }, 2000);
        }

        function endVoiceCall() {
            const modal = document.getElementById('voice-call-modal');
            if (modal) modal.remove();
        }

        function toggleVoiceMute() {
            showAlert('🎤 Voice muted/unmuted');
        }

        function toggleSpeaker() {
            showAlert('🔊 Speaker toggled');
        }

        // Enhanced Contact and info functions
        function openContactPicker() {
            // Create contact picker modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'contact-picker-modal';
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Select Contact</h3>
                        <button onclick="closeContactPicker()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="shareContact('john')">
                            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">J</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">John</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">+1 (555) 123-4567</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="shareContact('sarah')">
                            <div class="w-10 h-10 bg-pink-500 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">S</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">Sarah</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">+1 (555) 234-5678</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="shareContact('mike')">
                            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-semibold">M</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">Mike</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">+1 (555) 345-6789</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
        }

        function closeContactPicker() {
            const modal = document.getElementById('contact-picker-modal');
            if (modal) modal.remove();
        }

        function shareContact(contactName) {
            showAlert(`📞 Shared ${contactName.charAt(0).toUpperCase() + contactName.slice(1)}'s contact information!`);
            closeContactPicker();
        }

        function openChatInfo() {
            // Create chat info modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'chat-info-modal';
            
            const chatName = document.getElementById('current-chat-name').textContent;
            const isGroup = chatName === 'Family Business';
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Chat Info</h3>
                        <button onclick="closeChatInfo()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-gradient-to-br from-teal-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i data-lucide="${isGroup ? 'users' : 'user'}" class="w-10 h-10 text-white"></i>
                        </div>
                        <h4 class="text-xl font-semibold text-gray-900 dark:text-white">${chatName}</h4>
                        <p class="text-gray-500 dark:text-gray-400">${isGroup ? '5 members' : 'Online'}</p>
                    </div>
                    
                    ${isGroup ? `
                    <div class="mb-6">
                        <h5 class="font-medium text-gray-900 dark:text-white mb-3">Members</h5>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-semibold">J</span>
                                    </div>
                                    <span class="text-gray-900 dark:text-white">John</span>
                                </div>
                                <span class="text-xs text-green-500">Online</span>
                            </div>
                            <div class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-semibold">S</span>
                                    </div>
                                    <span class="text-gray-900 dark:text-white">Sarah</span>
                                </div>
                                <span class="text-xs text-green-500">Online</span>
                            </div>
                            <div class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-semibold">M</span>
                                    </div>
                                    <span class="text-gray-900 dark:text-white">Mike</span>
                                </div>
                                <span class="text-xs text-orange-500">Away</span>
                            </div>
                            <div class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-semibold">E</span>
                                    </div>
                                    <span class="text-gray-900 dark:text-white">Emma</span>
                                </div>
                                <span class="text-xs text-gray-500">Offline</span>
                            </div>
                            <div class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-teal-500 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-white text-sm font-semibold">Y</span>
                                    </div>
                                    <span class="text-gray-900 dark:text-white">You</span>
                                </div>
                                <span class="text-xs text-green-500">Online</span>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="space-y-3">
                        <button class="w-full flex items-center p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            <i data-lucide="image" class="w-5 h-5 mr-3 text-blue-500"></i>
                            Shared Media
                            <span class="ml-auto text-sm text-gray-500">23</span>
                        </button>
                        
                        <button class="w-full flex items-center p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            <i data-lucide="file" class="w-5 h-5 mr-3 text-green-500"></i>
                            Shared Documents
                            <span class="ml-auto text-sm text-gray-500">8</span>
                        </button>
                        
                        <button class="w-full flex items-center p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            <i data-lucide="pin" class="w-5 h-5 mr-3 text-purple-500"></i>
                            Pinned Messages
                            <span class="ml-auto text-sm text-gray-500">2</span>
                        </button>
                        
                        <button class="w-full flex items-center p-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            <i data-lucide="bell" class="w-5 h-5 mr-3 text-orange-500"></i>
                            Notifications
                            <span class="ml-auto text-sm text-gray-500">On</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
        }

        function closeChatInfo() {
            const modal = document.getElementById('chat-info-modal');
            if (modal) modal.remove();
        }

        function openChatMenu() {
            // Create chat menu dropdown
            const existingMenu = document.getElementById('chat-options-menu');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }
            
            const menu = document.createElement('div');
            menu.className = 'fixed top-16 right-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-2 w-48 z-50';
            menu.id = 'chat-options-menu';
            
            menu.innerHTML = `
                <button onclick="muteChat()" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i data-lucide="volume-x" class="w-4 h-4 mr-3 text-orange-500"></i>
                    Mute Chat
                </button>
                
                <button onclick="pinChat()" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i data-lucide="pin" class="w-4 h-4 mr-3 text-blue-500"></i>
                    Pin Chat
                </button>
                
                <button onclick="archiveChat()" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i data-lucide="archive" class="w-4 h-4 mr-3 text-green-500"></i>
                    Archive Chat
                </button>
                
                <button onclick="exportChat()" class="w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i data-lucide="download" class="w-4 h-4 mr-3 text-purple-500"></i>
                    Export Chat
                </button>
                
                <hr class="my-2 border-gray-200 dark:border-gray-600">
                
                <button onclick="clearChat()" class="w-full flex items-center p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg">
                    <i data-lucide="trash-2" class="w-4 h-4 mr-3"></i>
                    Clear Chat
                </button>
                
                <button onclick="deleteChat()" class="w-full flex items-center p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg">
                    <i data-lucide="user-x" class="w-4 h-4 mr-3"></i>
                    Delete Chat
                </button>
            `;
            
            document.body.appendChild(menu);
            initializeLucide();
            
            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);
        }

        function muteChat() {
            showAlert('🔇 Chat muted for 8 hours');
            document.getElementById('chat-options-menu')?.remove();
        }

        function pinChat() {
            showAlert('📌 Chat pinned to top');
            document.getElementById('chat-options-menu')?.remove();
        }

        function archiveChat() {
            showAlert('📦 Chat archived');
            document.getElementById('chat-options-menu')?.remove();
        }

        function exportChat() {
            showAlert('📄 Chat exported as PDF');
            document.getElementById('chat-options-menu')?.remove();
        }

        function clearChat() {
            if (confirm('Are you sure you want to clear all messages in this chat?')) {
                showAlert('🗑️ Chat messages cleared');
            }
            document.getElementById('chat-options-menu')?.remove();
        }

        function deleteChat() {
            if (confirm('Are you sure you want to delete this chat? This action cannot be undone.')) {
                showAlert('❌ Chat deleted');
            }
            document.getElementById('chat-options-menu')?.remove();
        }

        function cancelUpload() {
            uploadQueue = [];
            document.getElementById('upload-progress').classList.add('hidden');
            clearFilePreview();
        }

        // Search functionality
        function searchChats() {
            const searchTerm = document.getElementById('chat-search').value.toLowerCase();
            const chatItems = document.querySelectorAll('.chat-item');
            
            chatItems.forEach(item => {
                const chatName = item.querySelector('h3').textContent.toLowerCase();
                const lastMessage = item.querySelector('p').textContent.toLowerCase();
                
                const matches = chatName.includes(searchTerm) || lastMessage.includes(searchTerm);
                item.style.display = matches ? 'block' : 'none';
            });
        }

        // Theme toggle
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark', isDarkMode);
            
            // Save preference
            localStorage.setItem('darkMode', isDarkMode);
        }

        // Hide menus when clicking outside
        document.addEventListener('click', function(event) {
            const emojiPicker = document.getElementById('emoji-picker');
            const emojiButton = event.target.closest('button[onclick="toggleEmojiPicker()"]');
            const attachmentMenu = document.getElementById('attachment-menu');
            const attachmentButton = event.target.closest('button[onclick="toggleAttachmentMenu()"]');
            
            if (!emojiButton && !emojiPicker?.contains(event.target)) {
                hideEmojiPicker();
            }
            
            if (!attachmentButton && !attachmentMenu?.contains(event.target)) {
                hideAttachmentMenu();
            }
        });

        // Initialize chat on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load dark mode preference
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                toggleDarkMode();
            }
            
            // Set up search listener
            const searchInput = document.getElementById('chat-search');
            if (searchInput) {
                searchInput.addEventListener('input', searchChats);
            }
            
            // Initialize with family business chat
            openChat('family-business');
        });

        // Milestone functionality
        function addMilestone() {
            const title = prompt('Enter milestone title:');
            const description = prompt('Enter milestone description:');
            
            if (title && description) {
                const container = document.getElementById('milestones-list');
                const milestoneDiv = document.createElement('div');
                milestoneDiv.className = 'flex items-center p-4 bg-gray-700 rounded-lg';
                
                milestoneDiv.innerHTML = `
                    <input type="checkbox" class="mr-4 h-5 w-5 text-teal-500 bg-gray-600 border-gray-500 rounded">
                    <div class="flex-1">
                        <h4 class="font-semibold text-white">${title}</h4>
                        <p class="text-gray-400 text-sm">${description}</p>
                    </div>
                    <span class="text-sm text-gray-400">Due: TBD</span>
                `;
                
                container.appendChild(milestoneDiv);
            }
        }

        // Data Update Center functionality
        function sendUpdateReminders() {
            showAlert('Update reminders sent to all family members!');
        }

        // Advanced Data Update Center with full feature set
        let dataUpdateItems = [
            {
                id: 'alpha-revenue',
                title: 'Alpha Division Revenue',
                category: 'financial',
                description: 'Total revenue figures and growth rates',
                lastUpdated: '2025-01-12',
                updateFrequency: 30,
                value: '$650,200',
                status: 'up-to-date',
                hasQuarterly: true,
                quarterlyData: {
                    '2025': { Q1: null, Q2: null, Q3: { revenue: '650200', growth: '5.2', netprofit: '250200' }, Q4: null },
                    '2026': { Q1: null, Q2: null, Q3: null, Q4: null }
                },
                fields: [
                    { name: 'Revenue', value: '650200', type: 'currency' },
                    { name: 'Growth Rate', value: '5.2', type: 'percentage' },
                    { name: 'Net Profit', value: '250200', type: 'currency' }
                ]
            },
            {
                id: 'bravo-operations',
                title: 'Bravo Operations Report',
                category: 'business',
                description: 'Operational metrics and performance indicators',
                lastUpdated: '2025-01-08',
                updateFrequency: 14,
                value: '$90,190 profit',
                status: 'due-soon',
                hasQuarterly: true,
                quarterlyData: {
                    '2025': { Q1: null, Q2: null, Q3: { revenue: '400300', expenses: '310110', profit: '90190' }, Q4: null }
                },
                businessMetrics: {
                    employeeHeadcount: { fulltime: 18, parttime: 4, contractors: 2 },
                    inventoryLevels: { value: 125000, items: 2847, turnover: 4.2 },
                    legalCompliance: { license: 'Active', tax: 'Current', insurance: 'Needs Renewal' }
                },
                fields: [
                    { name: 'Revenue', value: '400300', type: 'currency' },
                    { name: 'Expenses', value: '310110', type: 'currency' },
                    { name: 'Net Profit', value: '90190', type: 'currency' }
                ]
            },
            {
                id: 'compliance-status',
                title: 'Legal Compliance Status',
                category: 'legal',
                description: 'Regulatory compliance and legal documentation',
                lastUpdated: '2024-11-15',
                updateFrequency: 90,
                value: 'Requires Review',
                status: 'overdue',
                fields: [
                    { name: 'Business License Status', value: 'Active', type: 'text' },
                    { name: 'Tax Compliance', value: 'Current', type: 'text' },
                    { name: 'Insurance Policy', value: 'Needs Renewal', type: 'text' }
                ]
            },
            {
                id: 'employee-count',
                title: 'Employee Headcount',
                category: 'operational',
                description: 'Staff numbers and organizational structure',
                lastUpdated: '2025-01-01',
                updateFrequency: 7,
                value: '24 employees',
                status: 'up-to-date',
                fields: [
                    { name: 'Full-time Employees', value: '18', type: 'number' },
                    { name: 'Part-time Employees', value: '4', type: 'number' },
                    { name: 'Contractors', value: '2', type: 'number' }
                ]
            }
        ];

        let currentUpdateItem = null;
        let activeYear = '2025';
        let activeQuarter = 'Q3';

        // Enhanced Data Update Center Functions
        function toggleReminderSettings() {
            const modal = document.getElementById('reminder-settings-modal');
            modal.classList.toggle('hidden');
            initializeLucide();
        }

        function calculateDataStatuses() {
            const today = new Date();
            
            dataUpdateItems.forEach(item => {
                const lastUpdate = new Date(item.lastUpdated);
                const daysSinceUpdate = Math.floor((today - lastUpdate) / (1000 * 60 * 60 * 24));
                
                if (daysSinceUpdate > item.updateFrequency) {
                    item.status = 'overdue';
                } else if (daysSinceUpdate > item.updateFrequency - 7) {
                    item.status = 'due-soon';
                } else {
                    item.status = 'up-to-date';
                }
            });

            // Update statistics
            const upToDate = dataUpdateItems.filter(item => item.status === 'up-to-date').length;
            const dueSoon = dataUpdateItems.filter(item => item.status === 'due-soon').length;
            const overdue = dataUpdateItems.filter(item => item.status === 'overdue').length;

            const totalItemsEl = document.getElementById('total-items');
            const upToDateEl = document.getElementById('up-to-date-count');
            const dueSoonEl = document.getElementById('due-soon-count');
            const overdueEl = document.getElementById('overdue-count');

            if (totalItemsEl) totalItemsEl.textContent = dataUpdateItems.length;
            if (upToDateEl) upToDateEl.textContent = upToDate;
            if (dueSoonEl) dueSoonEl.textContent = dueSoon;
            if (overdueEl) overdueEl.textContent = overdue;
        }

        function renderDataUpdateItems() {
            const container = document.getElementById('data-items-container');
            if (!container) return;

            const searchTerm = document.getElementById('data-search')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('status-filter')?.value || 'all';
            const categoryFilter = document.getElementById('category-filter')?.value || 'all';

            let filteredItems = dataUpdateItems.filter(item => {
                const matchesSearch = item.title.toLowerCase().includes(searchTerm) || 
                                    item.description.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || item.status === statusFilter;
                const matchesCategory = categoryFilter === 'all' || item.category === categoryFilter;
                
                return matchesSearch && matchesStatus && matchesCategory;
            });

            container.innerHTML = filteredItems.map(item => {
                const statusClass = item.status === 'overdue' ? 'border-red-500' : 
                                   item.status === 'due-soon' ? 'border-yellow-500' : 'border-green-500';
                const statusBadgeClass = item.status === 'overdue' ? 'bg-red-600/20 text-red-300' : 
                                        item.status === 'due-soon' ? 'bg-yellow-600/20 text-yellow-300' : 'bg-green-600/20 text-green-300';
                const daysSince = Math.floor((new Date() - new Date(item.lastUpdated)) / (1000 * 60 * 60 * 24));
                const categoryBadge = {
                    'financial': 'bg-green-600/20 text-green-300',
                    'business': 'bg-blue-600/20 text-blue-300',
                    'legal': 'bg-red-600/20 text-red-300',
                    'operational': 'bg-purple-600/20 text-purple-300'
                };
                
                return `
                    <div class="bg-gray-700 rounded-lg p-4 border-l-4 ${statusClass} data-card ${item.status === 'overdue' ? 'reminder-badge' : ''}" data-status="${item.status}" data-category="${item.category}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-semibold text-white">${item.title}</h4>
                                    <span class="text-xs ${categoryBadge[item.category] || 'bg-gray-600/20 text-gray-300'} px-2 py-1 rounded-full">${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</span>
                                </div>
                                <p class="text-gray-400 text-sm">${item.description}</p>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-400">Current Value:</p>
                                    <p class="text-lg font-bold text-white">${item.value}</p>
                                </div>
                                <div class="flex items-center mt-2 text-xs">
                                    <span class="text-gray-400 mr-4">Last updated: ${daysSince} days ago</span>
                                    <span class="text-gray-500">Update every ${item.updateFrequency} days</span>
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="openAdvancedUpdateModal('${item.id}')" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    <i data-lucide="edit" class="w-4 h-4 mr-2 inline"></i>
                                    Update Data
                                </button>
                                <button onclick="markAsUpdated('${item.id}')" title="Mark as updated" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            initializeLucide();
        }

        function openAdvancedUpdateModal(itemId) {
            currentUpdateItem = dataUpdateItems.find(item => item.id === itemId);
            if (!currentUpdateItem) return;

            document.getElementById('update-modal-title').textContent = `Update ${currentUpdateItem.title}`;
            
            // Generate year tabs
            generateYearTabs();
            
            // Show/hide quarter tabs based on item type
            const quarterContainer = document.getElementById('quarter-tabs-container');
            if (currentUpdateItem.hasQuarterly) {
                quarterContainer.classList.remove('hidden');
                setActiveQuarter('Q3'); // Default to current quarter
            } else {
                quarterContainer.classList.add('hidden');
            }
            
            // Show/hide business metrics section
            const metricsSection = document.getElementById('business-metrics-section');
            if (currentUpdateItem.category === 'business' && currentUpdateItem.businessMetrics) {
                metricsSection.classList.remove('hidden');
                populateBusinessMetrics();
            } else {
                metricsSection.classList.add('hidden');
            }
            
            generateAdvancedFormContent();
            document.getElementById('update-data-modal').classList.remove('hidden');
        }

        function generateYearTabs() {
            const currentYear = new Date().getFullYear();
            const yearTabs = document.getElementById('year-tabs');
            yearTabs.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const year = currentYear + i;
                const tab = document.createElement('button');
                tab.className = `year-tab px-4 py-2 text-sm font-medium rounded-lg transition-colors ${year === currentYear ? 'bg-teal-500 text-white' : 'bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600'}`;
                tab.textContent = year;
                tab.onclick = () => setActiveYear(year.toString());
                tab.setAttribute('data-year', year);
                yearTabs.appendChild(tab);
            }
            
            activeYear = currentYear.toString();
        }

        function setActiveYear(year) {
            activeYear = year;
            
            // Update tab appearances
            document.querySelectorAll('.year-tab').forEach(tab => {
                if (tab.getAttribute('data-year') === year) {
                    tab.className = 'year-tab px-4 py-2 text-sm font-medium rounded-lg bg-teal-500 text-white transition-colors';
                } else {
                    tab.className = 'year-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600 transition-colors';
                }
            });
            
            generateAdvancedFormContent();
        }

        function setActiveQuarter(quarter) {
            activeQuarter = quarter;
            
            // Update tab appearances
            document.querySelectorAll('.quarter-tab').forEach(tab => {
                if (tab.getAttribute('data-quarter') === quarter) {
                    tab.className = 'quarter-tab px-4 py-2 text-sm font-medium rounded-lg bg-teal-500 text-white transition-colors';
                } else {
                    tab.className = 'quarter-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600 transition-colors';
                }
            });
            
            generateAdvancedFormContent();
        }

        function generateAdvancedFormContent() {
            const formContent = document.getElementById('update-form-content');
            
            let formData = {};
            if (currentUpdateItem.hasQuarterly && currentUpdateItem.quarterlyData[activeYear] && currentUpdateItem.quarterlyData[activeYear][activeQuarter]) {
                formData = currentUpdateItem.quarterlyData[activeYear][activeQuarter];
            }
            
            formContent.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                        <p class="text-gray-400 text-sm">${currentUpdateItem.description}</p>
                        ${currentUpdateItem.hasQuarterly ? `<p class="text-teal-400 text-sm mt-1">Editing data for ${activeQuarter} ${activeYear}</p>` : ''}
                    </div>
                    ${currentUpdateItem.fields.map((field, index) => {
                        const fieldKey = field.name.toLowerCase().replace(/\s+/g, '').replace(/[^\w]/g, '');
                        const currentValue = formData[fieldKey] || field.value || '';
                        
                        return `
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">${field.name}</label>
                            <input type="${field.type === 'currency' ? 'number' : field.type === 'percentage' ? 'number' : 'text'}" 
                                   id="field-${index}" 
                                   value="${currentValue}" 
                                   ${field.type === 'percentage' ? 'step="0.1"' : field.type === 'currency' ? 'step="0.01"' : ''}
                                   class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none">
                            ${field.type === 'currency' ? '<span class="text-xs text-gray-500 mt-1 block">Enter amount without currency symbol</span>' : ''}
                            ${field.type === 'percentage' ? '<span class="text-xs text-gray-500 mt-1 block">Enter percentage as number (e.g., 5.2 for 5.2%)</span>' : ''}
                        </div>
                    `}).join('')}
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Update Notes</label>
                        <textarea id="update-notes" rows="3" 
                                  placeholder="Add any notes about this update..."
                                  class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-teal-500 focus:outline-none resize-none"></textarea>
                    </div>
                </div>
            `;
        }

        function populateBusinessMetrics() {
            if (!currentUpdateItem.businessMetrics) return;
            
            const metrics = currentUpdateItem.businessMetrics;
            
            // Employee Headcount
            if (metrics.employeeHeadcount) {
                const fulltimeEl = document.getElementById('fulltime-employees');
                const parttimeEl = document.getElementById('parttime-employees');
                const contractorsEl = document.getElementById('contractors');
                
                if (fulltimeEl) fulltimeEl.value = metrics.employeeHeadcount.fulltime || 0;
                if (parttimeEl) parttimeEl.value = metrics.employeeHeadcount.parttime || 0;
                if (contractorsEl) contractorsEl.value = metrics.employeeHeadcount.contractors || 0;
            }
            
            // Inventory Levels
            if (metrics.inventoryLevels) {
                const inventoryValueEl = document.getElementById('inventory-value');
                const itemsStockEl = document.getElementById('items-stock');
                const turnoverRateEl = document.getElementById('turnover-rate');
                
                if (inventoryValueEl) inventoryValueEl.value = metrics.inventoryLevels.value || 0;
                if (itemsStockEl) itemsStockEl.value = metrics.inventoryLevels.items || 0;
                if (turnoverRateEl) turnoverRateEl.value = metrics.inventoryLevels.turnover || 0;
            }
            
            // Legal Compliance
            if (metrics.legalCompliance) {
                const licenseEl = document.getElementById('license-status');
                const taxEl = document.getElementById('tax-compliance');
                const insuranceEl = document.getElementById('insurance-status');
                
                if (licenseEl) licenseEl.value = metrics.legalCompliance.license || 'Active';
                if (taxEl) taxEl.value = metrics.legalCompliance.tax || 'Current';
                if (insuranceEl) insuranceEl.value = metrics.legalCompliance.insurance || 'Active';
            }
        }

        function saveAdvancedDataUpdate() {
            if (!currentUpdateItem) return;

            // Update quarterly data if applicable
            if (currentUpdateItem.hasQuarterly) {
                if (!currentUpdateItem.quarterlyData[activeYear]) {
                    currentUpdateItem.quarterlyData[activeYear] = { Q1: null, Q2: null, Q3: null, Q4: null };
                }
                
                const quarterData = {};
                currentUpdateItem.fields.forEach((field, index) => {
                    const input = document.getElementById(`field-${index}`);
                    if (input) {
                        const fieldKey = field.name.toLowerCase().replace(/\s+/g, '').replace(/[^\w]/g, '');
                        quarterData[fieldKey] = input.value;
                        field.value = input.value; // Also update the main field value
                    }
                });
                
                currentUpdateItem.quarterlyData[activeYear][activeQuarter] = quarterData;
            } else {
                // Update regular fields
                currentUpdateItem.fields.forEach((field, index) => {
                    const input = document.getElementById(`field-${index}`);
                    if (input) {
                        field.value = input.value;
                    }
                });
            }

            // Update business metrics if applicable
            if (currentUpdateItem.category === 'business' && currentUpdateItem.businessMetrics) {
                const fulltimeEl = document.getElementById('fulltime-employees');
                const parttimeEl = document.getElementById('parttime-employees');
                const contractorsEl = document.getElementById('contractors');
                const inventoryValueEl = document.getElementById('inventory-value');
                const itemsStockEl = document.getElementById('items-stock');
                const turnoverRateEl = document.getElementById('turnover-rate');
                const licenseEl = document.getElementById('license-status');
                const taxEl = document.getElementById('tax-compliance');
                const insuranceEl = document.getElementById('insurance-status');

                if (fulltimeEl) {
                    currentUpdateItem.businessMetrics.employeeHeadcount = {
                        fulltime: parseInt(fulltimeEl.value) || 0,
                        parttime: parseInt(parttimeEl.value) || 0,
                        contractors: parseInt(contractorsEl.value) || 0
                    };
                }
                
                if (inventoryValueEl) {
                    currentUpdateItem.businessMetrics.inventoryLevels = {
                        value: parseFloat(inventoryValueEl.value) || 0,
                        items: parseInt(itemsStockEl.value) || 0,
                        turnover: parseFloat(turnoverRateEl.value) || 0
                    };
                }
                
                if (licenseEl) {
                    currentUpdateItem.businessMetrics.legalCompliance = {
                        license: licenseEl.value,
                        tax: taxEl.value,
                        insurance: insuranceEl.value
                    };
                }
            }

            // Update last updated date
            currentUpdateItem.lastUpdated = new Date().toISOString().split('T')[0];

            // Recalculate statuses and re-render
            calculateDataStatuses();
            renderDataUpdateItems();
            closeUpdateModal();

            // Show success message
            showAlert(`Data updated successfully for ${currentUpdateItem.hasQuarterly ? activeQuarter + ' ' + activeYear : 'current period'}!`);
        }

        function markAsUpdated(itemId) {
            const item = dataUpdateItems.find(item => item.id === itemId);
            if (item) {
                item.lastUpdated = new Date().toISOString().split('T')[0];
                calculateDataStatuses();
                renderDataUpdateItems();
                showAlert('Marked as updated!');
            }
        }

        function closeUpdateModal() {
            const modal = document.getElementById('update-data-modal');
            modal.classList.add('hidden');
            currentUpdateItem = null;
        }

        function saveReminderSettings() {
            showAlert('Reminder settings saved successfully!');
            toggleReminderSettings();
        }

        function addFamilyMember() {
            const name = prompt('Enter family member name:');
            const email = prompt('Enter email address:');
            const role = prompt('Enter role/position:');
            
            if (name && email && role) {
                const familyList = document.getElementById('family-members-list');
                const memberDiv = document.createElement('div');
                memberDiv.className = 'flex items-center justify-between bg-gray-700 rounded-lg p-3';
                memberDiv.innerHTML = `
                    <div>
                        <p class="text-white font-medium">${name}</p>
                        <p class="text-gray-400 text-sm">${email} - ${role}</p>
                    </div>
                    <input type="checkbox" checked class="w-4 h-4 text-teal-600 bg-gray-600 border-gray-500 rounded focus:ring-teal-500">
                `;
                familyList.appendChild(memberDiv);
                showAlert(`${name} added to family member list!`);
            }
        }

        function addNewDataItem() {
            const name = prompt('Enter data item name:');
            const description = prompt('Enter description:');
            const category = prompt('Enter category (financial, operational, legal, business):');
            
            if (name && description && category) {
                showAlert(`New data item "${name}" added successfully!`);
                // In a real application, this would add the item to the list
            }
        }

        // Search and filter functionality for data items
        function setupDataCenterFilters() {
            const searchInput = document.getElementById('data-search');
            const statusFilter = document.getElementById('status-filter');
            const categoryFilter = document.getElementById('category-filter');
            
            if (searchInput) {
                searchInput.addEventListener('input', renderDataUpdateItems);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', renderDataUpdateItems);
            }
            if (categoryFilter) {
                categoryFilter.addEventListener('change', renderDataUpdateItems);
            }
        }

        // Financial Dashboard view toggle functionality
        function toggleFinancialView(viewType) {
            const gridViewBtn = document.getElementById('financial-grid-view-btn');
            const listViewBtn = document.getElementById('financial-list-view-btn');
            const gridView = document.getElementById('financial-grid-view');
            const listView = document.getElementById('financial-list-view');

            if (viewType === 'grid') {
                // Show grid, hide list
                gridView.classList.remove('hidden');
                listView.classList.add('hidden');

                // Update button active state
                gridViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
            } else if (viewType === 'list') {
                // Show list, hide grid
                listView.classList.remove('hidden');
                gridView.classList.add('hidden');

                // Update button active state
                listViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
            }
        }

        // Ideas page voting and interaction functionality
        function voteOnIdea(ideaId, voteType) {
            const idea = ideas.find(i => i.id === ideaId);
            if (!idea) return;

            const currentVote = idea.votes.userVotes[currentUser];
            
            // Remove previous vote if exists
            if (currentVote === 'up') {
                idea.votes.upvotes--;
            } else if (currentVote === 'down') {
                idea.votes.downvotes--;
            }
            
            // Add new vote if different from current
            if (currentVote !== voteType) {
                idea.votes.userVotes[currentUser] = voteType;
                if (voteType === 'up') {
                    idea.votes.upvotes++;
                } else if (voteType === 'down') {
                    idea.votes.downvotes++;
                }
            } else {
                // Remove vote if clicking same button
                delete idea.votes.userVotes[currentUser];
            }
            
            // Re-render both ideas list and kanban board to show updated votes
            renderIdeasList();
            renderKanbanBoard();
            updateDashboardStats();
        }

        // Dashboard statistics and donut chart functionality
        function updateDashboardStats() {
            // Count ideas by status for completion rate
            const statusCounts = {
                'New Ideas': 0,
                'Researching': 0,
                'Planning': 0,
                'Approved': 0
            };
            
            let totalVotes = 0;
            let totalComments = 0;
            const ideaVotes = [];
            
            ideas.forEach(idea => {
                statusCounts[idea.status]++;
                if (idea.votes) {
                    const netVotes = idea.votes.upvotes - idea.votes.downvotes;
                    totalVotes += idea.votes.upvotes + idea.votes.downvotes;
                    ideaVotes.push({
                        name: idea.name,
                        netVotes: Math.max(netVotes, 1), // Ensure minimum of 1 for chart display
                        upvotes: idea.votes.upvotes,
                        downvotes: idea.votes.downvotes
                    });
                }
                if (idea.comments) {
                    totalComments += idea.comments.length;
                }
            });
            
            // Update top stats
            document.getElementById('total-ideas-count').textContent = ideas.length;
            document.getElementById('total-votes-count').textContent = totalVotes;
            document.getElementById('active-discussions-count').textContent = totalComments;
            document.getElementById('completion-rate').textContent = Math.round((statusCounts['Approved'] / ideas.length) * 100) + '%';
            
            // Update donut chart center
            document.getElementById('chart-center-number').textContent = totalVotes;
            
            // Create donut chart with idea votes
            createDonutChart(ideaVotes);
        }
        
        function createDonutChart(ideaVotes) {
            const chartSvg = document.getElementById('donut-chart');
            const legendContainer = document.getElementById('ideas-legend');
            chartSvg.innerHTML = '';
            legendContainer.innerHTML = '';
            
            if (ideaVotes.length === 0) return;
            
            // Calculate total votes for percentages
            const totalVotes = ideaVotes.reduce((sum, idea) => sum + idea.netVotes, 0);
            
            // Color palette for ideas
            const colors = [
                '#3b82f6', // blue
                '#10b981', // green
                '#f59e0b', // yellow
                '#ef4444', // red
                '#8b5cf6', // purple
                '#06b6d4', // cyan
                '#f97316', // orange
                '#84cc16', // lime
                '#ec4899', // pink
                '#6366f1'  // indigo
            ];
            
            const centerX = 100;
            const centerY = 100;
            const radius = 70;
            const strokeWidth = 20;
            
            let currentAngle = -90; // Start from top
            
            // Create chart segments
            ideaVotes.forEach((idea, index) => {
                const percentage = idea.netVotes / totalVotes;
                const angle = percentage * 360;
                
                const startAngleRad = (currentAngle * Math.PI) / 180;
                const endAngleRad = ((currentAngle + angle) * Math.PI) / 180;
                
                const x1 = centerX + radius * Math.cos(startAngleRad);
                const y1 = centerY + radius * Math.sin(startAngleRad);
                const x2 = centerX + radius * Math.cos(endAngleRad);
                const y2 = centerY + radius * Math.sin(endAngleRad);
                
                const largeArcFlag = angle > 180 ? 1 : 0;
                
                const pathData = [
                    'M', centerX, centerY,
                    'L', x1, y1,
                    'A', radius, radius, 0, largeArcFlag, 1, x2, y2,
                    'Z'
                ].join(' ');
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index % colors.length]);
                path.setAttribute('opacity', '0.8');
                path.setAttribute('stroke', '#1f2937');
                path.setAttribute('stroke-width', '1');
                chartSvg.appendChild(path);
                
                currentAngle += angle;
                
                // Create legend item
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center justify-between py-1';
                legendItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${colors[index % colors.length]}"></div>
                        <span class="text-sm text-gray-300 truncate" title="${idea.name}">${idea.name.length > 20 ? idea.name.substring(0, 20) + '...' : idea.name}</span>
                    </div>
                    <div class="flex items-center space-x-1 text-xs">
                        <span class="text-green-400">+${idea.upvotes}</span>
                        <span class="text-red-400">-${idea.downvotes}</span>
                        <span class="text-white font-medium">(${idea.netVotes > 0 ? '+' : ''}${idea.upvotes - idea.downvotes})</span>
                    </div>
                `;
                legendContainer.appendChild(legendItem);
            });
            
            // Add inner circle to create donut effect
            const innerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            innerCircle.setAttribute('cx', centerX);
            innerCircle.setAttribute('cy', centerY);
            innerCircle.setAttribute('r', radius - strokeWidth);
            innerCircle.setAttribute('fill', '#1f2937'); // gray-800
            chartSvg.appendChild(innerCircle);
        }

        function toggleIdeasView(viewType) {
            ideasViewMode = viewType;
            
            const gridBtn = document.getElementById('ideas-grid-view');
            const listBtn = document.getElementById('ideas-list-view');
            
            if (viewType === 'grid') {
                gridBtn.classList.add('active', 'text-teal-400');
                listBtn.classList.remove('active', 'text-teal-400');
            } else {
                listBtn.classList.add('active', 'text-teal-400');
                gridBtn.classList.remove('active', 'text-teal-400');
            }
            
            renderIdeasList();
        }

        function setupIdeasFilters() {
            const statusFilter = document.getElementById('ideas-status-filter');
            const categoryFilter = document.getElementById('ideas-category-filter');
            const sortSelect = document.getElementById('ideas-sort');
            const searchInput = document.getElementById('ideas-search');
            
            if (statusFilter) {
                statusFilter.addEventListener('change', renderIdeasList);
            }
            if (categoryFilter) {
                categoryFilter.addEventListener('change', renderIdeasList);
            }
            if (sortSelect) {
                sortSelect.addEventListener('change', renderIdeasList);
            }
            if (searchInput) {
                searchInput.addEventListener('input', renderIdeasList);
                searchInput.addEventListener('keyup', renderIdeasList);
            }
        }

        // Enhanced idea dashboard opening with ID
        function openIdeaDashboard(ideaId) {
            const idea = ideas.find(i => i.id === ideaId);
            if (!idea) return;
            
            currentIdea = idea;
            document.getElementById('idea-title').textContent = idea.name;
            document.getElementById('idea-description').textContent = idea.description;
            document.getElementById('idea-status').textContent = idea.status;
            document.getElementById('idea-submitter').textContent = idea.submitter;
            document.getElementById('idea-date').textContent = new Date(idea.date).toLocaleDateString();
            
            // Update new fields
            document.getElementById('idea-priority').textContent = idea.priority || 'Medium';
            document.getElementById('idea-category').textContent = idea.category || 'General';
            document.getElementById('idea-budget').textContent = idea.estimatedBudget ? `$${idea.estimatedBudget.toLocaleString()}` : '$0';
            
            // Update voting section
            updateIdeaDashboardVoting();
            
            // Reset financial data for this idea
            setupCosts = [];
            familyFunding = [];
            updateFinancialTotals();
            
            navigateToPage('idea-dashboard');
        }

        // Voting functionality for individual idea dashboard
        function voteOnCurrentIdea(voteType) {
            if (!currentIdea) return;
            
            voteOnIdea(currentIdea.id, voteType);
            updateIdeaDashboardVoting();
        }

        function updateIdeaDashboardVoting() {
            if (!currentIdea || !currentIdea.votes) return;
            
            const votes = currentIdea.votes;
            const netVotes = votes.upvotes - votes.downvotes;
            const totalVotes = votes.upvotes + votes.downvotes;
            const userVote = votes.userVotes[currentUser];
            
            // Update vote counts
            document.getElementById('idea-upvotes-count').textContent = votes.upvotes;
            document.getElementById('idea-downvotes-count').textContent = votes.downvotes;
            document.getElementById('idea-upvotes-display').textContent = votes.upvotes;
            document.getElementById('idea-downvotes-display').textContent = votes.downvotes;
            document.getElementById('idea-total-votes').textContent = totalVotes;
            document.getElementById('idea-net-votes').textContent = netVotes > 0 ? `+${netVotes}` : netVotes.toString();
            
            // Update button states
            const upBtn = document.getElementById('idea-upvote-btn');
            const downBtn = document.getElementById('idea-downvote-btn');
            
            // Reset button states
            upBtn.className = "flex items-center space-x-2 bg-green-600/20 hover:bg-green-600/30 text-green-400 px-4 py-2 rounded-l-lg border border-green-500/30 transition-colors";
            downBtn.className = "flex items-center space-x-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 px-4 py-2 rounded-r-lg border border-red-500/30 transition-colors";
            
            // Highlight active vote
            if (userVote === 'up') {
                upBtn.className = "flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-l-lg border border-green-500 transition-colors";
            } else if (userVote === 'down') {
                downBtn.className = "flex items-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-r-lg border border-red-500 transition-colors";
            }
            
            // Create donut chart
            createIdeaDonutChart(votes.upvotes, votes.downvotes);
        }

        function createIdeaDonutChart(upvotes, downvotes) {
            const chartSvg = document.getElementById('idea-donut-chart');
            chartSvg.innerHTML = '';
            
            const total = upvotes + downvotes;
            if (total === 0) {
                // Show empty chart
                const emptyCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                emptyCircle.setAttribute('cx', '60');
                emptyCircle.setAttribute('cy', '60');
                emptyCircle.setAttribute('r', '35');
                emptyCircle.setAttribute('fill', 'none');
                emptyCircle.setAttribute('stroke', '#374151');
                emptyCircle.setAttribute('stroke-width', '8');
                chartSvg.appendChild(emptyCircle);
                return;
            }
            
            const centerX = 60;
            const centerY = 60;
            const radius = 35;
            const strokeWidth = 8;
            
            // Calculate angles
            const upvotePercentage = upvotes / total;
            const upvoteAngle = upvotePercentage * 360;
            
            let currentAngle = -90; // Start from top
            
            // Create upvotes segment
            if (upvotes > 0) {
                const startAngleRad = (currentAngle * Math.PI) / 180;
                const endAngleRad = ((currentAngle + upvoteAngle) * Math.PI) / 180;
                
                const x1 = centerX + radius * Math.cos(startAngleRad);
                const y1 = centerY + radius * Math.sin(startAngleRad);
                const x2 = centerX + radius * Math.cos(endAngleRad);
                const y2 = centerY + radius * Math.sin(endAngleRad);
                
                const largeArcFlag = upvoteAngle > 180 ? 1 : 0;
                
                const pathData = [
                    'M', centerX, centerY,
                    'L', x1, y1,
                    'A', radius, radius, 0, largeArcFlag, 1, x2, y2,
                    'Z'
                ].join(' ');
                
                const upvotePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                upvotePath.setAttribute('d', pathData);
                upvotePath.setAttribute('fill', '#22c55e');
                upvotePath.setAttribute('opacity', '0.8');
                chartSvg.appendChild(upvotePath);
                
                currentAngle += upvoteAngle;
            }
            
            // Create downvotes segment
            if (downvotes > 0) {
                const downvoteAngle = (downvotes / total) * 360;
                const startAngleRad = (currentAngle * Math.PI) / 180;
                const endAngleRad = ((currentAngle + downvoteAngle) * Math.PI) / 180;
                
                const x1 = centerX + radius * Math.cos(startAngleRad);
                const y1 = centerY + radius * Math.sin(startAngleRad);
                const x2 = centerX + radius * Math.cos(endAngleRad);
                const y2 = centerY + radius * Math.sin(endAngleRad);
                
                const largeArcFlag = downvoteAngle > 180 ? 1 : 0;
                
                const pathData = [
                    'M', centerX, centerY,
                    'L', x1, y1,
                    'A', radius, radius, 0, largeArcFlag, 1, x2, y2,
                    'Z'
                ].join(' ');
                
                const downvotePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                downvotePath.setAttribute('d', pathData);
                downvotePath.setAttribute('fill', '#ef4444');
                downvotePath.setAttribute('opacity', '0.8');
                chartSvg.appendChild(downvotePath);
            }
            
            // Add inner circle for donut effect
            const innerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            innerCircle.setAttribute('cx', centerX);
            innerCircle.setAttribute('cy', centerY);
            innerCircle.setAttribute('r', radius - strokeWidth);
            innerCircle.setAttribute('fill', '#1f2937');
            chartSvg.appendChild(innerCircle);
        }

        // Task Management functionality
        function addNewTask() {
            const title = prompt('Enter task title:');
            const description = prompt('Enter task description:');
            
            if (title && description) {
                showAlert('Task "' + title + '" added successfully!');
                // In a real app, this would add to the task list
            }
        }

        // Initialize icons after DOM changes (with throttling to prevent infinite loops)
        let iconUpdateTimeout;
        const observer = new MutationObserver(() => {
            clearTimeout(iconUpdateTimeout);
            iconUpdateTimeout = setTimeout(() => {
                initializeLucide();
            }, 100);
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Set up event listeners
        function setupEventListeners() {
            try {
                // Handle Enter key in cost and funding inputs
                const costItem = document.getElementById('cost-item');
                const costAmount = document.getElementById('cost-amount');
                const fundingMember = document.getElementById('funding-member');
                const fundingAmount = document.getElementById('funding-amount');
                const researchQuery = document.getElementById('research-query');
                const smartSearch = document.getElementById('smart-search');
                
                if (costItem) {
                    costItem.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            costAmount.focus();
                        }
                    });
                }
                
                if (costAmount) {
                    costAmount.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCostItem();
                        }
                    });
                }
                
                if (fundingMember) {
                    fundingMember.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            fundingAmount.focus();
                        }
                    });
                }
                
                if (fundingAmount) {
                    fundingAmount.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addFundingItem();
                        }
                    });
                }
                
                if (researchQuery) {
                    researchQuery.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') generateResearch();
                    });
                }

                if (smartSearch) {
                    smartSearch.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') performSmartSearch();
                    });
                }
                
                // Setup data center filters
                setupDataCenterFilters();
                calculateDataStatuses();
                renderDataUpdateItems();
                
                // Setup ideas filters
                setupIdeasFilters();
                
                // Setup user management filters
                setupUserManagementFilters();
                
            } catch (error) {
                console.error('Event listener setup error:', error);
            }
        }

        // Profile Management Functions
        function editProfile() {
            showAlert('Edit profile functionality coming soon!');
        }

        function changeProfilePhoto() {
            showAlert('Profile photo upload functionality coming soon!');
        }

        function editPersonalInfo() {
            showAlert('Edit personal information functionality coming soon!');
        }

        function editBusinessInfo() {
            showAlert('Edit business information functionality coming soon!');
        }

        // User Management Functions
        function inviteUser() {
            document.getElementById('invite-user-modal').classList.add('active');
            // Clear form fields
            document.getElementById('invite-user-form').reset();
        }

        function closeInviteUserModal() {
            document.getElementById('invite-user-modal').classList.remove('active');
        }

        async function submitInviteUser(event) {
            event.preventDefault();
            
            const name = document.getElementById('invite-user-name').value;
            const email = document.getElementById('invite-user-email').value;
            const role = document.getElementById('invite-user-role').value;
            const message = document.getElementById('invite-user-message').value;
            const sendNotification = document.getElementById('invite-user-notify').checked;
            
            // Show loading state
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i data-lucide="loader" class="w-4 h-4 mr-2 animate-spin"></i>Sending...';
            submitButton.disabled = true;
            
            try {
                // Create user object
                const newUser = {
                    id: generateUserId(),
                    name: name,
                    email: email,
                    role: role,
                    status: 'pending',
                    lastActive: 'Never',
                    ideas: 0,
                    inviteDate: new Date().toLocaleDateString(),
                    welcomeMessage: message
                };
                
                // Send email if notification is enabled
                if (sendNotification) {
                    await sendInvitationEmail(newUser);
                }
                
                // Add user to pending list
                addUserToTable(newUser);
                
                // Update stats
                updateUserStats();
                
                // Close modal
                closeInviteUserModal();
                
                // Show success message
                if (sendNotification) {
                    if (EMAILJS_CONFIG.demoMode || EMAILJS_CONFIG.publicKey === 'YOUR_PUBLIC_KEY') {
                        showAlert(`📧 Demo Mode: Invitation email simulated for ${name} (${email}). Check console for email preview.`);
                    } else {
                        showAlert(`✅ Invitation sent to ${name} (${email}) successfully! They will receive an email with login instructions.`);
                    }
                } else {
                    showAlert(`✅ ${name} has been added to the pending users list. You can send the invitation later.`);
                }
                
            } catch (error) {
                console.error('Error sending invitation:', error);
                showAlert(`❌ Failed to send invitation to ${email}. Please check the email address and try again.`);
            } finally {
                // Restore button state
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
                lucide.createIcons(); // Recreate icons after innerHTML change
            }
        }

        async function sendInvitationEmail(user) {
            // Check if we're in demo mode or if EmailJS is configured
            if (EMAILJS_CONFIG.demoMode || EMAILJS_CONFIG.publicKey === 'YOUR_PUBLIC_KEY') {
                // Demo mode - simulate email sending
                console.log('📧 Demo Mode: Simulating email send to:', user.email);
                
                // Simulate email content
                const emailContent = {
                    to: user.email,
                    subject: 'Invitation to Family Business Hub',
                    body: `Hi ${user.name},

You've been invited to join our Family Business Hub as a ${user.role}!

${user.welcomeMessage || 'Welcome to our Family Business Hub!'}

Role: ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}
Role Description: ${getRoleDescription(user.role)}

Login URL: ${window.location.origin}/login.html
Invitation Date: ${new Date().toLocaleDateString()}

Best regards,
Family Business Hub Team`
                };
                
                console.log('📧 Email Content Preview:', emailContent);
                
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                return { status: 'demo-success', message: 'Email simulated successfully' };
            }

            // Real EmailJS implementation
            try {
                // Prepare email template parameters
                const templateParams = {
                    to_name: user.name,
                    to_email: user.email,
                    from_name: 'Family Business Hub',
                    reply_to: 'noreply@familybusinesshub.com',
                    user_role: user.role,
                    welcome_message: user.welcomeMessage || 'Welcome to our Family Business Hub!',
                    login_url: window.location.origin + '/login.html',
                    invitation_date: new Date().toLocaleDateString(),
                    role_description: getRoleDescription(user.role)
                };

                // Send email using EmailJS
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.templateId,
                    templateParams
                );

                console.log('Email sent successfully:', response);
                return response;
            } catch (error) {
                console.error('EmailJS Error:', error);
                throw new Error('Failed to send email via EmailJS: ' + error.message);
            }
        }

        function getRoleDescription(role) {
            switch(role) {
                case 'admin':
                    return 'You have been granted Admin access with full permissions to manage all aspects of the Family Business Hub.';
                case 'member':
                    return 'You have been granted Member access to collaborate on ideas, planning, and participate in discussions.';
                case 'viewer':
                    return 'You have been granted Viewer access to see shared content and follow family business progress.';
                default:
                    return 'You have been invited to join our Family Business Hub.';
            }
        }

        function generateUserId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function addUserToTable(user) {
            const tableBody = document.querySelector('#user-management tbody');
            const newRow = document.createElement('tr');
            newRow.className = 'hover:bg-gray-700/50';
            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                            ${user.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                        </div>
                        <div>
                            <div class="text-white font-medium">${user.name}</div>
                            <div class="text-gray-400 text-sm">${user.email}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs font-medium ${getRoleBadgeClass(user.role)} rounded-full">${capitalizeFirst(user.role)}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs font-medium bg-yellow-600/20 text-yellow-300 rounded-full">Pending</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-white">${user.lastActive}</td>
                <td class="px-6 py-4 whitespace-nowrap text-white">${user.ideas}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex space-x-2">
                        <button onclick="resendInvite('${user.id}')" class="text-blue-400 hover:text-blue-300" title="Resend Invitation">
                            <i data-lucide="mail" class="w-4 h-4"></i>
                        </button>
                        <button onclick="cancelInvite('${user.id}')" class="text-red-400 hover:text-red-300" title="Cancel Invitation">
                            <i data-lucide="x-circle" class="w-4 h-4"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(newRow);
        }

        function getRoleBadgeClass(role) {
            switch(role) {
                case 'admin': return 'bg-purple-600/20 text-purple-300';
                case 'member': return 'bg-blue-600/20 text-blue-300';
                case 'viewer': return 'bg-gray-600/20 text-gray-300';
                default: return 'bg-gray-600/20 text-gray-300';
            }
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function updateUserStats() {
            // Update pending invites count
            const pendingElement = document.querySelector('[data-stat="pending"]');
            if (pendingElement) {
                const currentCount = parseInt(pendingElement.textContent);
                pendingElement.textContent = currentCount + 1;
            }
        }

        async function resendInvite(userId) {
            console.log(`📧 Resend invite button clicked for user ${userId}`);
            try {
                const user = sampleUsers[userId];
                if (!user) {
                    throw new Error(`User ${userId} not found in sampleUsers`);
                }
                
                console.log(`✅ Resending invitation to ${user.name} (${user.email})`);
                
                const userData = {
                    id: userId,
                    name: user.name,
                    email: user.email,
                    role: user.role,
                    welcomeMessage: 'Thank you for joining our Family Business Hub! This is a resent invitation.'
                };
                
                // Show loading state
                const button = document.querySelector(`button[onclick="resendInvite(${userId})"]`);
                const originalIcon = button.innerHTML;
                button.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i>';
                button.disabled = true;
                
                // Send email
                await sendInvitationEmail(userData);
                
                // Restore button state
                button.innerHTML = originalIcon;
                button.disabled = false;
                lucide.createIcons();
                
                // Show appropriate success message based on mode
                if (EMAILJS_CONFIG.demoMode || EMAILJS_CONFIG.publicKey === 'YOUR_PUBLIC_KEY') {
                    showAlert(`📧 Demo Mode: Invitation email simulated for ${userData.name} (${userData.email}). Check console for email preview.`);
                } else {
                    showAlert(`✅ Invitation resent to ${userData.name} (${userData.email}) successfully!`);
                }
                
            } catch (error) {
                console.error('Error resending invitation:', error);
                showAlert(`❌ Failed to resend invitation. Please try again later.`);
                
                // Restore button state on error
                const button = document.querySelector(`button[onclick="resendInvite(${userId})"]`);
                if (button) {
                    button.innerHTML = '<i data-lucide="send" class="w-4 h-4"></i>';
                    button.disabled = false;
                    lucide.createIcons();
                }
            }
        }

        function cancelInvite(userId) {
            console.log(`❌ Cancel invite button clicked for user ${userId}`);
            const user = sampleUsers[userId];
            if (!user) {
                showAlert('❌ User not found!');
                console.error(`User ${userId} not found in sampleUsers`);
                return;
            }

            console.log(`🗑️ Attempting to cancel invitation for ${user.name}`);
            const confirmCancel = confirm(`Are you sure you want to cancel the invitation for ${user.name}?`);
            
            if (confirmCancel) {
                // Remove user from sample data
                delete sampleUsers[userId];
                console.log(`✅ User ${user.name} removed from system`);
                
                // Update pending count
                const pendingElement = document.querySelector('[data-stat="pending"]');
                if (pendingElement) {
                    const currentCount = parseInt(pendingElement.textContent);
                    pendingElement.textContent = Math.max(0, currentCount - 1);
                }
                
                // Refresh pagination to show updated data
                updatePagination();
                
                showAlert(`✅ Invitation for ${user.name} has been cancelled.`);
            } else {
                console.log(`❌ User cancelled invitation removal`);
            }
        }

        function exportUsers() {
            // Simulate data export
            const data = "Name,Email,Role,Status\nSarah Johnson,sarah@johnsonfamily.com,Admin,Active\nMike Johnson,mike@johnsonfamily.com,Member,Active\nEmma Johnson,emma@johnsonfamily.com,Member,Active\nJane Johnson,jane@johnsonfamily.com,Viewer,Pending";
            const blob = new Blob([data], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'family_hub_users.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            showAlert('User data exported successfully!');
        }

        // Sample user data (in a real app, this would come from a database)
        const sampleUsers = {
            1: { name: 'Sarah Johnson', email: 'sarah@johnsonfamily.com', role: 'admin', status: 'active', ideas: 15, lastActive: '2 hours ago', memberSince: 'January 15, 2024' },
            2: { name: 'Mike Johnson', email: 'mike@johnsonfamily.com', role: 'member', status: 'active', ideas: 8, lastActive: '1 day ago', memberSince: 'February 3, 2024' },
            3: { name: 'Emma Johnson', email: 'emma@johnsonfamily.com', role: 'member', status: 'active', ideas: 12, lastActive: '3 hours ago', memberSince: 'March 10, 2024' },
            4: { name: 'Jane Johnson', email: 'jane@johnsonfamily.com', role: 'viewer', status: 'pending', ideas: 0, lastActive: 'Never', memberSince: 'December 20, 2024' },
            5: { name: 'David Wilson', email: 'david@wilsonfamily.com', role: 'member', status: 'active', ideas: 7, lastActive: '5 hours ago', memberSince: 'March 22, 2024' },
            6: { name: 'Lisa Chen', email: 'lisa@chenfamily.com', role: 'admin', status: 'active', ideas: 18, lastActive: '1 hour ago', memberSince: 'January 8, 2024' },
            7: { name: 'Robert Brown', email: 'robert@brownfamily.com', role: 'member', status: 'inactive', ideas: 3, lastActive: '2 weeks ago', memberSince: 'May 15, 2024' },
            8: { name: 'Maria Garcia', email: 'maria@garciafamily.com', role: 'viewer', status: 'pending', ideas: 0, lastActive: 'Never', memberSince: 'December 25, 2024' },
            9: { name: 'James Miller', email: 'james@millerfamily.com', role: 'member', status: 'active', ideas: 11, lastActive: '6 hours ago', memberSince: 'April 5, 2024' },
            10: { name: 'Jennifer Davis', email: 'jennifer@davisfamily.com', role: 'member', status: 'active', ideas: 9, lastActive: '4 hours ago', memberSince: 'February 18, 2024' },
            11: { name: 'Kevin Thompson', email: 'kevin@thompsonfamily.com', role: 'viewer', status: 'active', ideas: 2, lastActive: '1 day ago', memberSince: 'June 12, 2024' },
            12: { name: 'Anna Rodriguez', email: 'anna@rodriguezfamily.com', role: 'admin', status: 'pending', ideas: 0, lastActive: 'Never', memberSince: 'December 30, 2024' }
        };

        function editUser(userId) {
            console.log(`🔧 Edit button clicked for user ${userId}`);
            const user = sampleUsers[userId];
            if (!user) {
                showAlert('❌ User not found!');
                console.error(`User ${userId} not found in sampleUsers`);
                return;
            }

            console.log(`✅ Opening edit modal for ${user.name}`);

            // Populate the edit form
            document.getElementById('edit-user-name').value = user.name;
            document.getElementById('edit-user-email').value = user.email;
            document.getElementById('edit-user-role').value = user.role;
            document.getElementById('edit-user-status').value = user.status;
            document.getElementById('edit-user-id').value = userId;

            // Open the modal
            document.getElementById('edit-user-modal').classList.add('active');
            
            // Reinitialize icons
            setTimeout(() => lucide.createIcons(), 100);
        }

        function closeEditUserModal() {
            document.getElementById('edit-user-modal').classList.remove('active');
        }

        function submitEditUser(event) {
            event.preventDefault();
            
            const userId = document.getElementById('edit-user-id').value;
            const name = document.getElementById('edit-user-name').value.trim();
            const email = document.getElementById('edit-user-email').value.trim();
            const role = document.getElementById('edit-user-role').value;
            const status = document.getElementById('edit-user-status').value;

            // Validation
            if (!name || !email) {
                showAlert('❌ Name and email are required!');
                return;
            }

            // Update sample data (in a real app, this would update the database)
            if (sampleUsers[userId]) {
                sampleUsers[userId] = { ...sampleUsers[userId], name, email, role, status };
                
                // Refresh pagination to show updated data
                updatePagination();
                
                closeEditUserModal();
                showAlert(`✅ User ${name} has been updated successfully!`);
            } else {
                showAlert('❌ User not found!');
            }
        }

        function updateUserTableRow(userId, userData) {
            const userRow = document.querySelector(`button[onclick="editUser(${userId})"]`).closest('tr');
            if (userRow) {
                // Update name and email
                const nameCell = userRow.querySelector('.text-white.font-medium');
                const emailCell = userRow.querySelector('.text-gray-400.text-sm');
                if (nameCell) nameCell.textContent = userData.name;
                if (emailCell) emailCell.textContent = userData.email;

                // Update role badge
                const roleCell = userRow.querySelector('.rounded-full');
                if (roleCell) {
                    roleCell.textContent = capitalizeFirst(userData.role);
                    roleCell.className = `px-2 py-1 text-xs font-medium ${getRoleBadgeClass(userData.role)} rounded-full`;
                }

                // Update status badge
                const statusCell = userRow.querySelectorAll('.rounded-full')[1];
                if (statusCell) {
                    statusCell.textContent = capitalizeFirst(userData.status);
                    statusCell.className = `px-2 py-1 text-xs font-medium ${getStatusBadgeClass(userData.status)} rounded-full`;
                }

                // Update avatar initials
                const avatar = userRow.querySelector('.rounded-full[class*="bg-gradient"]');
                if (avatar) {
                    avatar.textContent = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                }
            }
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'active': return 'bg-green-600/20 text-green-300';
                case 'inactive': return 'bg-red-600/20 text-red-300';
                case 'pending': return 'bg-yellow-600/20 text-yellow-300';
                default: return 'bg-gray-600/20 text-gray-300';
            }
        }

        function viewUser(userId) {
            console.log(`👁️ View button clicked for user ${userId}`);
            const user = sampleUsers[userId];
            if (!user) {
                showAlert('❌ User not found!');
                console.error(`User ${userId} not found in sampleUsers`);
                return;
            }

            console.log(`✅ Opening view modal for ${user.name}`);

            // Populate the view modal
            document.getElementById('view-user-name').textContent = user.name;
            document.getElementById('view-user-email').textContent = user.email;
            document.getElementById('view-user-ideas').textContent = user.ideas;
            document.getElementById('view-user-role').textContent = capitalizeFirst(user.role);
            document.getElementById('view-user-last-active').textContent = user.lastActive;
            document.getElementById('view-user-member-since').textContent = user.memberSince;

            // Update avatar
            const avatar = document.getElementById('view-user-avatar');
            avatar.textContent = user.name.split(' ').map(n => n[0]).join('').toUpperCase();

            // Update status badge
            const statusBadge = document.getElementById('view-user-status');
            statusBadge.textContent = capitalizeFirst(user.status);
            statusBadge.className = `px-2 py-1 text-xs font-medium ${getStatusBadgeClass(user.status)} rounded-full`;

            // Update permissions description
            const permissionsText = document.getElementById('view-user-permissions');
            permissionsText.textContent = getRoleDescription(user.role);

            // Store user ID for potential edit action
            currentViewingUserId = userId;

            // Open the modal
            document.getElementById('view-user-modal').classList.add('active');
            
            // Reinitialize icons
            setTimeout(() => lucide.createIcons(), 100);
        }

        let currentViewingUserId = null;

        function closeViewUserModal() {
            document.getElementById('view-user-modal').classList.remove('active');
        }

        function editUserFromView() {
            closeViewUserModal();
            editUser(currentViewingUserId);
        }

        function suspendUser(userId) {
            console.log(`⏸️ Suspend/Activate button clicked for user ${userId}`);
            const user = sampleUsers[userId];
            if (!user) {
                showAlert('❌ User not found!');
                console.error(`User ${userId} not found in sampleUsers`);
                return;
            }

            const action = user.status === 'active' ? 'suspend' : 'activate';
            console.log(`🔄 Attempting to ${action} ${user.name}`);
            const confirmAction = confirm(`Are you sure you want to ${action} ${user.name}?`);
            
            if (confirmAction) {
                // Toggle status
                const newStatus = user.status === 'active' ? 'inactive' : 'active';
                sampleUsers[userId].status = newStatus;
                
                console.log(`✅ User status changed to: ${newStatus}`);
                
                // Refresh pagination to show updated data
                updatePagination();
                
                const actionPast = newStatus === 'active' ? 'activated' : 'suspended';
                showAlert(`✅ ${user.name} has been ${actionPast}.`);
            } else {
                console.log(`❌ User cancelled ${action} operation`);
            }
        }

        // Pagination functionality
        let currentPage = 1;
        const usersPerPage = 4;
        
        function getTotalUsers() {
            return Object.keys(sampleUsers).length;
        }
        
        function getTotalPages() {
            return Math.ceil(getTotalUsers() / usersPerPage);
        }

        function changePage(direction) {
            const totalPages = getTotalPages();
            if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            } else if (direction === 'next' && currentPage < totalPages) {
                currentPage++;
            }
            updatePagination();
        }

        function goToPage(page) {
            const totalPages = getTotalPages();
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updatePagination();
            }
        }

        function displayUsersForPage(page) {
            const tableBody = document.querySelector('#user-management tbody');
            if (!tableBody) {
                console.error('❌ User management table body not found');
                return;
            }

            // Clear existing rows
            tableBody.innerHTML = '';

            // Get all user IDs and sort them
            const userIds = Object.keys(sampleUsers).map(id => parseInt(id)).sort((a, b) => a - b);
            const totalUsers = userIds.length;

            // Calculate which users to show for this page
            const startIndex = (page - 1) * usersPerPage;
            const endIndex = Math.min(startIndex + usersPerPage, totalUsers);
            const usersForPage = userIds.slice(startIndex, endIndex);

            console.log(`📊 Displaying ${usersForPage.length} users for page ${page}`);

            // Create each user row
            usersForPage.forEach(userId => {
                const user = sampleUsers[userId];
                if (!user) return;

                // Create the main row
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700/50';

                // User info cell
                const userInfoCell = document.createElement('td');
                userInfoCell.className = 'px-6 py-4 whitespace-nowrap';
                userInfoCell.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-br from-${getAvatarColor(userId)} rounded-full flex items-center justify-center text-white font-semibold mr-3">
                            ${user.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                        </div>
                        <div>
                            <div class="text-white font-medium">${user.name}</div>
                            <div class="text-gray-400 text-sm">${user.email}</div>
                        </div>
                    </div>
                `;

                // Role cell
                const roleCell = document.createElement('td');
                roleCell.className = 'px-6 py-4 whitespace-nowrap';
                roleCell.innerHTML = `<span class="px-2 py-1 text-xs font-medium ${getRoleBadgeClass(user.role)} rounded-full">${capitalizeFirst(user.role)}</span>`;

                // Status cell
                const statusCell = document.createElement('td');
                statusCell.className = 'px-6 py-4 whitespace-nowrap';
                statusCell.innerHTML = `<span class="px-2 py-1 text-xs font-medium ${getStatusBadgeClass(user.status)} rounded-full">${capitalizeFirst(user.status)}</span>`;

                // Last active cell
                const lastActiveCell = document.createElement('td');
                lastActiveCell.className = 'px-6 py-4 whitespace-nowrap text-white';
                lastActiveCell.textContent = user.lastActive;

                // Ideas cell
                const ideasCell = document.createElement('td');
                ideasCell.className = 'px-6 py-4 whitespace-nowrap text-white';
                ideasCell.textContent = user.ideas;

                // Actions cell with proper event listeners
                const actionsCell = document.createElement('td');
                actionsCell.className = 'px-6 py-4 whitespace-nowrap';
                
                const actionsContainer = document.createElement('div');
                actionsContainer.className = 'flex space-x-2';

                if (user.status === 'pending') {
                    // Edit button for pending users
                    const editBtn = document.createElement('button');
                    editBtn.className = 'text-blue-400 hover:text-blue-300 transition-colors';
                    editBtn.title = 'Edit User';
                    editBtn.innerHTML = '<i data-lucide="edit" class="w-4 h-4"></i>';
                    editBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`🔧 Edit clicked for user ${userId}`);
                        editUser(userId);
                    });
                    
                    // Resend invite button
                    const resendBtn = document.createElement('button');
                    resendBtn.className = 'text-teal-400 hover:text-teal-300 ml-2 transition-colors';
                    resendBtn.title = 'Resend Invitation';
                    resendBtn.innerHTML = '<i data-lucide="send" class="w-4 h-4"></i>';
                    resendBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`📧 Resend clicked for user ${userId}`);
                        resendInvite(userId);
                    });
                    
                    // Cancel invite button
                    const cancelBtn = document.createElement('button');
                    cancelBtn.className = 'text-red-400 hover:text-red-300 ml-2 transition-colors';
                    cancelBtn.title = 'Cancel Invitation';
                    cancelBtn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i>';
                    cancelBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`❌ Cancel clicked for user ${userId}`);
                        cancelInvite(userId);
                    });
                    
                    actionsContainer.appendChild(editBtn);
                    actionsContainer.appendChild(resendBtn);
                    actionsContainer.appendChild(cancelBtn);
                } else {
                    // Edit button for active/inactive users
                    const editBtn = document.createElement('button');
                    editBtn.className = 'text-blue-400 hover:text-blue-300 transition-colors';
                    editBtn.title = 'Edit User';
                    editBtn.innerHTML = '<i data-lucide="edit" class="w-4 h-4"></i>';
                    editBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`🔧 Edit clicked for user ${userId}`);
                        editUser(userId);
                    });
                    
                    // View button
                    const viewBtn = document.createElement('button');
                    viewBtn.className = 'text-green-400 hover:text-green-300 ml-2 transition-colors';
                    viewBtn.title = 'View Details';
                    viewBtn.innerHTML = '<i data-lucide="eye" class="w-4 h-4"></i>';
                    viewBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`👁️ View clicked for user ${userId}`);
                        viewUser(userId);
                    });
                    
                    // Suspend/Activate button
                    const suspendBtn = document.createElement('button');
                    suspendBtn.className = 'text-yellow-400 hover:text-yellow-300 ml-2 transition-colors';
                    suspendBtn.title = user.status === 'active' ? 'Suspend User' : 'Activate User';
                    const iconName = user.status === 'active' ? 'pause' : 'play';
                    suspendBtn.innerHTML = `<i data-lucide="${iconName}" class="w-4 h-4"></i>`;
                    suspendBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`⏸️ Suspend/Activate clicked for user ${userId}`);
                        suspendUser(userId);
                    });
                    
                    actionsContainer.appendChild(editBtn);
                    actionsContainer.appendChild(viewBtn);
                    actionsContainer.appendChild(suspendBtn);
                }
                
                actionsCell.appendChild(actionsContainer);

                // Append all cells to row
                row.appendChild(userInfoCell);
                row.appendChild(roleCell);
                row.appendChild(statusCell);
                row.appendChild(lastActiveCell);
                row.appendChild(ideasCell);
                row.appendChild(actionsCell);

                // Add row to table
                tableBody.appendChild(row);

                console.log(`✅ Added user ${user.name} to table with working action buttons`);
            });

            // Reinitialize Lucide icons after DOM is ready
            setTimeout(() => {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                    console.log('🎨 Lucide icons initialized for action buttons');
                } else {
                    console.warn('⚠️ Lucide not available');
                }
            }, 100);
        }

        function getAvatarColor(userId) {
            const colors = ['teal-500 to-teal-700', 'blue-500 to-blue-700', 'green-500 to-green-700', 
                           'purple-500 to-purple-700', 'pink-500 to-pink-700', 'orange-500 to-orange-700'];
            return colors[(userId - 1) % colors.length];
        }

        function updatePagination() {
            const totalUsers = getTotalUsers();
            const totalPages = getTotalPages();
            
            // Ensure current page is valid
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            } else if (currentPage < 1) {
                currentPage = 1;
            }

            // Update pagination info
            const startUser = totalUsers > 0 ? (currentPage - 1) * usersPerPage + 1 : 0;
            const endUser = Math.min(currentPage * usersPerPage, totalUsers);
            const paginationInfo = document.getElementById('pagination-info');
            if (paginationInfo) {
                paginationInfo.textContent = `Showing ${startUser} to ${endUser} of ${totalUsers} users`;
            }

            // Update Previous button
            const prevButton = document.getElementById('prev-page');
            if (prevButton) {
                prevButton.disabled = currentPage === 1 || totalPages === 0;
                prevButton.className = `px-3 py-1 ${currentPage === 1 || totalPages === 0 ? 'bg-gray-700 text-gray-400' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} rounded-lg disabled:opacity-50`;
            }

            // Update Next button
            const nextButton = document.getElementById('next-page');
            if (nextButton) {
                nextButton.disabled = currentPage === totalPages || totalPages === 0;
                nextButton.className = `px-3 py-1 ${currentPage === totalPages || totalPages === 0 ? 'bg-gray-700 text-gray-400' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} rounded-lg disabled:opacity-50`;
            }

            // Update page number buttons
            const pageButtons = document.querySelectorAll('.pagination-btn');
            pageButtons.forEach(button => {
                const page = parseInt(button.getAttribute('data-page'));
                if (page === currentPage && page <= totalPages) {
                    button.className = 'pagination-btn px-3 py-1 bg-teal-500 text-white rounded-lg';
                    button.style.display = 'block';
                } else if (page <= totalPages) {
                    button.className = 'pagination-btn px-3 py-1 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600';
                    button.style.display = 'block';
                } else {
                    button.style.display = 'none';
                }
            });

            // Actually display the users for this page
            displayUsersForPage(currentPage);
            
            console.log(`📊 Displaying page ${currentPage} of ${totalPages} (${totalUsers} total users)`);
            
            // Show success message for page navigation
            if (currentPage > 1) {
                showAlert(`📄 Switched to page ${currentPage}`);
            }
        }

        // Search and filter functionality for user management
        function setupUserManagementFilters() {
            const searchInput = document.getElementById('user-search');
            const roleFilter = document.getElementById('role-filter');
            const statusFilter = document.getElementById('status-filter');

            if (searchInput) {
                searchInput.addEventListener('input', filterUsers);
            }
            if (roleFilter) {
                roleFilter.addEventListener('change', filterUsers);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', filterUsers);
            }
        }

        function filterUsers() {
            // Placeholder for user filtering logic
            console.log('Filtering users...');
        }

        // 🔒 ENTERPRISE SECURITY SYSTEM - END-TO-END ENCRYPTION
        // ========================================================
        
        class FamilyHubSecurity {
            constructor() {
                this.sodium = null;
                this.userKeys = {};
                this.securitySettings = {
                    e2eEnabled: true,
                    readReceipts: true,
                    lastSeenPrivacy: 'everyone',
                    profilePhotoPrivacy: 'family',
                    autoBackup: true,
                    disappearingMessages: false,
                    disappearingMessageTimer: 86400000, // 24 hours
                    twoFactorAuth: false,
                    biometricLock: false,
                    securityNotifications: true
                };
                this.securityLevel = 'high';
                this.trustedDevices = new Set();
                this.secureChannels = new Map();
                this.keyFingerprints = new Map();
                this.init();
            }

            async init() {
                try {
                    // Initialize libsodium
                    await sodium.ready;
                    this.sodium = sodium;
                    console.log('🔒 Security system initialized with libsodium');
                    
                    // Load or generate user keys
                    await this.initializeUserKeys();
                    
                    // Set up security UI
                    this.setupSecurityUI();
                    
                    // Initialize secure sessions
                    this.initializeSecureSessions();
                    
                    console.log('✅ End-to-end encryption ready');
                } catch (error) {
                    console.error('❌ Security initialization failed:', error);
                    this.showSecurityAlert('Security system initialization failed. Using fallback mode.');
                }
            }

            async initializeUserKeys() {
                // Check if keys exist in secure storage
                const storedKeys = this.getSecureStorage('userKeys');
                
                if (storedKeys) {
                    this.userKeys = JSON.parse(storedKeys);
                    console.log('🔑 Loaded existing user keys');
                } else {
                    // Generate new keys
                    await this.generateUserKeys();
                    console.log('🆕 Generated new user keys');
                }
                
                // Generate key fingerprint for verification
                this.generateKeyFingerprint();
            }

            async generateUserKeys() {
                if (!this.sodium) {
                    throw new Error('Sodium not initialized');
                }

                // Generate identity keys (long-term)
                const identityKeyPair = this.sodium.crypto_box_keypair();
                
                // Generate signing keys
                const signingKeyPair = this.sodium.crypto_sign_keypair();
                
                // Generate pre-keys for forward secrecy
                const preKeys = [];
                for (let i = 0; i < 10; i++) {
                    preKeys.push({
                        id: i,
                        keyPair: this.sodium.crypto_box_keypair()
                    });
                }

                this.userKeys = {
                    identity: {
                        publicKey: this.sodium.to_hex(identityKeyPair.publicKey),
                        privateKey: this.sodium.to_hex(identityKeyPair.privateKey)
                    },
                    signing: {
                        publicKey: this.sodium.to_hex(signingKeyPair.publicKey),
                        privateKey: this.sodium.to_hex(signingKeyPair.privateKey)
                    },
                    preKeys: preKeys.map(pk => ({
                        id: pk.id,
                        publicKey: this.sodium.to_hex(pk.keyPair.publicKey),
                        privateKey: this.sodium.to_hex(pk.keyPair.privateKey)
                    })),
                    timestamp: Date.now()
                };

                // Store keys securely
                this.setSecureStorage('userKeys', JSON.stringify(this.userKeys));
                
                // Upload public keys to server (simulation)
                await this.uploadPublicKeys();
            }

            generateKeyFingerprint() {
                if (!this.userKeys.identity) return;
                
                const publicKeyHex = this.userKeys.identity.publicKey;
                const fingerprint = this.sodium.crypto_generichash(32, this.sodium.from_hex(publicKeyHex));
                const fingerprintHex = this.sodium.to_hex(fingerprint);
                
                // Format as readable fingerprint
                const formattedFingerprint = fingerprintHex.match(/.{4}/g).join(' ').toUpperCase();
                this.keyFingerprints.set('self', formattedFingerprint);
                
                console.log('🔍 Key fingerprint:', formattedFingerprint);
            }

            async uploadPublicKeys() {
                // In real implementation, this would upload to your server
                const publicKeysBundle = {
                    userId: 'current-user',
                    identityKey: this.userKeys.identity.publicKey,
                    signingKey: this.userKeys.signing.publicKey,
                    preKeys: this.userKeys.preKeys.map(pk => ({
                        id: pk.id,
                        publicKey: pk.publicKey
                    })),
                    timestamp: Date.now()
                };
                
                console.log('📤 Public keys uploaded to server');
                // localStorage simulation of server storage
                localStorage.setItem('publicKeys_current-user', JSON.stringify(publicKeysBundle));
            }

            async encryptMessage(message, recipientUserId) {
                if (!this.securitySettings.e2eEnabled) {
                    return { encrypted: false, content: message };
                }

                try {
                    // Get recipient's public key
                    const recipientKeys = await this.getRecipientKeys(recipientUserId);
                    if (!recipientKeys) {
                        throw new Error('Recipient keys not found');
                    }

                    // Generate ephemeral key for this message
                    const ephemeralKeyPair = this.sodium.crypto_box_keypair();
                    
                    // Create shared secret
                    const sharedSecret = this.sodium.crypto_box_beforenm(
                        this.sodium.from_hex(recipientKeys.identityKey),
                        this.sodium.from_hex(this.userKeys.identity.privateKey)
                    );

                    // Encrypt message
                    const nonce = this.sodium.randombytes_buf(this.sodium.crypto_box_NONCEBYTES);
                    const messageBytes = this.sodium.from_string(message);
                    const ciphertext = this.sodium.crypto_box_easy_afternm(messageBytes, nonce, sharedSecret);

                    // Create encrypted message bundle
                    const encryptedBundle = {
                        encrypted: true,
                        ciphertext: this.sodium.to_hex(ciphertext),
                        nonce: this.sodium.to_hex(nonce),
                        ephemeralPublicKey: this.sodium.to_hex(ephemeralKeyPair.publicKey),
                        senderId: 'current-user',
                        recipientId: recipientUserId,
                        timestamp: Date.now(),
                        version: '1.0'
                    };

                    console.log('🔒 Message encrypted for', recipientUserId);
                    return encryptedBundle;

                } catch (error) {
                    console.error('❌ Encryption failed:', error);
                    this.showSecurityAlert('Message encryption failed. Sending in plaintext.');
                    return { encrypted: false, content: message };
                }
            }

            async decryptMessage(encryptedBundle) {
                if (!encryptedBundle.encrypted) {
                    return encryptedBundle.content;
                }

                try {
                    // Create shared secret
                    const sharedSecret = this.sodium.crypto_box_beforenm(
                        this.sodium.from_hex(encryptedBundle.ephemeralPublicKey),
                        this.sodium.from_hex(this.userKeys.identity.privateKey)
                    );

                    // Decrypt message
                    const ciphertext = this.sodium.from_hex(encryptedBundle.ciphertext);
                    const nonce = this.sodium.from_hex(encryptedBundle.nonce);
                    const decryptedBytes = this.sodium.crypto_box_open_easy_afternm(ciphertext, nonce, sharedSecret);
                    const decryptedMessage = this.sodium.to_string(decryptedBytes);

                    console.log('🔓 Message decrypted from', encryptedBundle.senderId);
                    return decryptedMessage;

                } catch (error) {
                    console.error('❌ Decryption failed:', error);
                    return '[🔒 Failed to decrypt message]';
                }
            }

            async getRecipientKeys(userId) {
                // In real implementation, fetch from server
                const storedKeys = localStorage.getItem(`publicKeys_${userId}`);
                if (storedKeys) {
                    return JSON.parse(storedKeys);
                }
                
                // Generate mock keys for demo
                const mockKeys = {
                    userId: userId,
                    identityKey: this.sodium.to_hex(this.sodium.crypto_box_keypair().publicKey),
                    signingKey: this.sodium.to_hex(this.sodium.crypto_sign_keypair().publicKey),
                    timestamp: Date.now()
                };
                
                localStorage.setItem(`publicKeys_${userId}`, JSON.stringify(mockKeys));
                return mockKeys;
            }

            setupSecurityUI() {
                // Add security indicators to chat interface
                this.addSecurityIndicators();
                
                // Add security settings to menu
                this.addSecuritySettings();
                
                // Add verification UI
                this.setupKeyVerification();
            }

            addSecurityIndicators() {
                // Add encryption status to chat header
                const chatHeader = document.querySelector('#chat-detail-container .border-b');
                if (chatHeader) {
                    const securityIndicator = document.createElement('div');
                    securityIndicator.className = 'flex items-center text-xs text-green-500 mt-1';
                    securityIndicator.innerHTML = `
                        <i data-lucide="shield-check" class="w-3 h-3 mr-1"></i>
                        <span>End-to-end encrypted</span>
                    `;
                    
                    const statusElement = chatHeader.querySelector('#current-chat-status');
                    if (statusElement) {
                        statusElement.appendChild(securityIndicator);
                    }
                }
            }

            addSecuritySettings() {
                // Add to the existing chat menu
                const originalOpenChatMenu = window.openChatMenu;
                window.openChatMenu = () => {
                    originalOpenChatMenu();
                    
                    // Add security options to the menu
                    setTimeout(() => {
                        const menu = document.getElementById('chat-options-menu');
                        if (menu) {
                            const securityButton = document.createElement('button');
                            securityButton.className = 'w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg';
                            securityButton.innerHTML = `
                                <i data-lucide="shield" class="w-4 h-4 mr-3 text-blue-500"></i>
                                Security Settings
                            `;
                            securityButton.onclick = () => this.openSecuritySettings();
                            
                            const verifyButton = document.createElement('button');
                            verifyButton.className = 'w-full flex items-center p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg';
                            verifyButton.innerHTML = `
                                <i data-lucide="key" class="w-4 h-4 mr-3 text-purple-500"></i>
                                Verify Encryption
                            `;
                            verifyButton.onclick = () => this.openKeyVerification();
                            
                            // Insert security options before the divider
                            const divider = menu.querySelector('hr');
                            if (divider) {
                                menu.insertBefore(securityButton, divider);
                                menu.insertBefore(verifyButton, divider);
                            }
                            
                            initializeLucide();
                        }
                    }, 50);
                };
            }

            openSecuritySettings() {
                document.getElementById('chat-options-menu')?.remove();
                
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'security-settings-modal';
                
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i data-lucide="shield" class="w-5 h-5 mr-2 text-blue-500"></i>
                                Security Settings
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- End-to-End Encryption -->
                            <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="shield-check" class="w-5 h-5 text-green-500 mr-3"></i>
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white">End-to-End Encryption</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Messages are secured with military-grade encryption</p>
                                    </div>
                                </div>
                                <div class="text-green-500 font-semibold text-sm">ACTIVE</div>
                            </div>
                            
                            <!-- Two-Factor Authentication -->
                            <div class="flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="smartphone" class="w-5 h-5 text-blue-500 mr-3"></i>
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white">Two-Factor Authentication</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Extra security for your account</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" ${this.securitySettings.twoFactorAuth ? 'checked' : ''} class="sr-only peer" onchange="familyHubSecurity.toggleTwoFactor(this.checked)">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <!-- Disappearing Messages -->
                            <div class="p-3 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center">
                                        <i data-lucide="timer" class="w-5 h-5 text-orange-500 mr-3"></i>
                                        <div>
                                            <p class="font-medium text-gray-900 dark:text-white">Disappearing Messages</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400">Messages automatically delete after set time</p>
                                        </div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" ${this.securitySettings.disappearingMessages ? 'checked' : ''} class="sr-only peer" onchange="familyHubSecurity.toggleDisappearingMessages(this.checked)">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 dark:peer-focus:ring-orange-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-orange-600"></div>
                                    </label>
                                </div>
                                ${this.securitySettings.disappearingMessages ? `
                                <select class="w-full mt-2 p-2 bg-gray-100 dark:bg-gray-700 rounded border-0 text-gray-900 dark:text-white" onchange="familyHubSecurity.setDisappearingTimer(this.value)">
                                    <option value="3600000">1 hour</option>
                                    <option value="86400000" selected>24 hours</option>
                                    <option value="604800000">7 days</option>
                                </select>
                                ` : ''}
                            </div>
                            
                            <!-- Privacy Settings -->
                            <div class="p-3 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                    <i data-lucide="eye" class="w-4 h-4 mr-2 text-purple-500"></i>
                                    Privacy Controls
                                </h4>
                                
                                <div class="space-y-3">
                                    <div>
                                        <label class="text-sm text-gray-700 dark:text-gray-300">Read Receipts</label>
                                        <select class="w-full mt-1 p-2 bg-gray-100 dark:bg-gray-700 rounded border-0 text-gray-900 dark:text-white text-sm">
                                            <option>Everyone</option>
                                            <option>Family Only</option>
                                            <option>Nobody</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="text-sm text-gray-700 dark:text-gray-300">Last Seen</label>
                                        <select class="w-full mt-1 p-2 bg-gray-100 dark:bg-gray-700 rounded border-0 text-gray-900 dark:text-white text-sm">
                                            <option>Everyone</option>
                                            <option>Family Only</option>
                                            <option>Nobody</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Security Level -->
                            <div class="p-3 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                    <i data-lucide="lock" class="w-4 h-4 mr-2 text-red-500"></i>
                                    Security Level: <span class="text-green-500 ml-1">HIGH</span>
                                </h4>
                                <div class="text-xs text-gray-600 dark:text-gray-400">
                                    <div class="flex items-center mb-1">
                                        <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2"></i>
                                        256-bit encryption active
                                    </div>
                                    <div class="flex items-center mb-1">
                                        <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2"></i>
                                        Perfect forward secrecy enabled
                                    </div>
                                    <div class="flex items-center">
                                        <i data-lucide="check" class="w-3 h-3 text-green-500 mr-2"></i>
                                        Zero-knowledge architecture
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex space-x-3">
                            <button onclick="familyHubSecurity.exportSecurityReport()" class="flex-1 flex items-center justify-center p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm">
                                <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                Security Report
                            </button>
                            <button onclick="familyHubSecurity.openKeyVerification()" class="flex-1 flex items-center justify-center p-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors text-sm">
                                <i data-lucide="key" class="w-4 h-4 mr-2"></i>
                                Verify Keys
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                initializeLucide();
            }

            openKeyVerification() {
                document.getElementById('chat-options-menu')?.remove();
                document.getElementById('security-settings-modal')?.remove();
                
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'key-verification-modal';
                
                const myFingerprint = this.keyFingerprints.get('self') || 'XXXX XXXX XXXX XXXX';
                
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i data-lucide="key" class="w-5 h-5 mr-2 text-purple-500"></i>
                                Key Verification
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="fingerprint" class="w-8 h-8 text-purple-500"></i>
                            </div>
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Your Security Fingerprint</h4>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-4">Share this with family members to verify secure communication</p>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                            <div class="font-mono text-sm text-center text-gray-900 dark:text-white leading-relaxed">
                                ${myFingerprint.match(/.{4}/g).join('<br/>')}
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <button onclick="familyHubSecurity.copyFingerprint()" class="w-full flex items-center justify-center p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors">
                                <i data-lucide="copy" class="w-4 h-4 mr-2"></i>
                                Copy Fingerprint
                            </button>
                            
                            <button onclick="familyHubSecurity.shareFingerprint()" class="w-full flex items-center justify-center p-3 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
                                <i data-lucide="share" class="w-4 h-4 mr-2"></i>
                                Share Fingerprint
                            </button>
                            
                            <button onclick="familyHubSecurity.scanFingerprint()" class="w-full flex items-center justify-center p-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors">
                                <i data-lucide="scan" class="w-4 h-4 mr-2"></i>
                                Scan Others' Fingerprint
                            </button>
                        </div>
                        
                        <div class="mt-6 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                            <div class="flex items-start">
                                <i data-lucide="info" class="w-4 h-4 text-blue-500 mr-2 mt-0.5"></i>
                                <div class="text-xs text-blue-700 dark:text-blue-300">
                                    <p class="font-medium mb-1">Why verify keys?</p>
                                    <p>Verifying encryption keys ensures you're communicating securely with the right person and prevents man-in-the-middle attacks.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                initializeLucide();
            }

            // Security Settings Methods
            toggleTwoFactor(enabled) {
                this.securitySettings.twoFactorAuth = enabled;
                this.saveSecuritySettings();
                this.showSecurityAlert(enabled ? '🔒 Two-factor authentication enabled' : '🔓 Two-factor authentication disabled');
            }

            toggleDisappearingMessages(enabled) {
                this.securitySettings.disappearingMessages = enabled;
                this.saveSecuritySettings();
                this.showSecurityAlert(enabled ? '⏱️ Disappearing messages enabled' : '⏱️ Disappearing messages disabled');
                
                // Refresh the modal to show/hide timer options
                if (enabled) {
                    setTimeout(() => {
                        this.openSecuritySettings();
                    }, 1000);
                }
            }

            setDisappearingTimer(milliseconds) {
                this.securitySettings.disappearingMessageTimer = parseInt(milliseconds);
                this.saveSecuritySettings();
                
                const hours = milliseconds / (1000 * 60 * 60);
                const days = hours / 24;
                
                let timeText;
                if (days >= 1) {
                    timeText = `${days} day${days > 1 ? 's' : ''}`;
                } else {
                    timeText = `${hours} hour${hours > 1 ? 's' : ''}`;
                }
                
                this.showSecurityAlert(`⏱️ Messages will disappear after ${timeText}`);
            }

            copyFingerprint() {
                const fingerprint = this.keyFingerprints.get('self');
                if (fingerprint) {
                    navigator.clipboard.writeText(fingerprint).then(() => {
                        this.showSecurityAlert('📋 Fingerprint copied to clipboard');
                    });
                }
            }

            shareFingerprint() {
                const fingerprint = this.keyFingerprints.get('self');
                if (fingerprint) {
                    const message = `My Family Hub security fingerprint: ${fingerprint}`;
                    
                    if (navigator.share) {
                        navigator.share({ text: message });
                    } else {
                        navigator.clipboard.writeText(message);
                        this.showSecurityAlert('📋 Fingerprint copied for sharing');
                    }
                }
            }

            scanFingerprint() {
                this.showSecurityAlert('📱 QR code scanner would open here to verify others\' fingerprints');
            }

            exportSecurityReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    securityLevel: this.securityLevel,
                    encryptionStatus: 'Active - AES-256',
                    keyFingerprint: this.keyFingerprints.get('self'),
                    settings: this.securitySettings,
                    trustedDevices: Array.from(this.trustedDevices),
                    lastKeyRotation: this.userKeys.timestamp
                };
                
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `family-hub-security-report-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showSecurityAlert('📄 Security report downloaded');
            }

            // Utility Methods
            setSecureStorage(key, value) {
                // In production, use secure storage like IndexedDB with encryption
                localStorage.setItem(`secure_${key}`, value);
            }

            getSecureStorage(key) {
                return localStorage.getItem(`secure_${key}`);
            }

            saveSecuritySettings() {
                this.setSecureStorage('securitySettings', JSON.stringify(this.securitySettings));
            }

            showSecurityAlert(message) {
                // Use existing alert system but with security styling
                showAlert(message);
            }

            initializeSecureSessions() {
                // Initialize secure communication channels
                console.log('🔐 Secure sessions initialized');
            }

            setupKeyVerification() {
                // Set up automatic key verification system
                console.log('🔍 Key verification system ready');
            }
        }

        // Initialize Security System
        let familyHubSecurity;
        
        // Override the original sendModernMessage to include encryption
        const originalSendModernMessage = sendModernMessage;
        sendModernMessage = async function() {
            if (!familyHubSecurity) {
                return originalSendModernMessage();
            }

            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message || uploadQueue.length > 0) {
                const messagesContainer = document.getElementById('chat-messages');
                const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Encrypt the message
                const encryptedMessage = await familyHubSecurity.encryptMessage(message, currentChat);
                
                // Create outgoing message with security indicator
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-end justify-end mb-4';
                
                let attachmentsHtml = '';
                if (uploadQueue.length > 0) {
                    attachmentsHtml = uploadQueue.map(file => {
                        if (file.type.startsWith('image/')) {
                            return `
                                <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600 mt-2">
                                    <img src="${URL.createObjectURL(file)}" alt="${file.name}" class="w-full h-auto max-h-64 object-cover">
                                </div>
                            `;
                        } else if (file.type.startsWith('video/')) {
                            return `
                                <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600 mt-2">
                                    <video controls class="w-full h-auto max-h-64">
                                        <source src="${URL.createObjectURL(file)}" type="${file.type}">
                                    </video>
                                </div>
                            `;
                        } else {
                            return `
                                <div class="flex items-center p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 mt-2">
                                    <i data-lucide="file" class="w-5 h-5 text-gray-500 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">${file.name}</p>
                                        <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(1)} MB</p>
                                    </div>
                                </div>
                            `;
                        }
                    }).join('');
                }
                
                messageDiv.innerHTML = `
                    <div class="flex-1 max-w-xs text-right">
                        <div class="bg-teal-500 rounded-2xl rounded-tr-sm p-3 shadow-sm">
                            ${message ? `<p class="text-white text-sm">${message}</p>` : ''}
                            ${attachmentsHtml}
                            ${encryptedMessage.encrypted ? `
                                <div class="flex items-center justify-end mt-2 text-white text-opacity-70">
                                    <i data-lucide="lock" class="w-3 h-3 mr-1"></i>
                                    <span class="text-xs">Encrypted</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex items-center justify-end mt-1 mr-2">
                            <i data-lucide="check-check" class="w-3 h-3 text-blue-500 mr-1"></i>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${timestamp}</span>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Clear input and reset state
                input.value = '';
                uploadQueue = [];
                clearFilePreview();
                hideEmojiPicker();
                
                // Auto-resize textarea
                input.style.height = 'auto';
                
                initializeLucide();
                
                // Simulate message delivery
                setTimeout(() => {
                    const checkIcons = messageDiv.querySelectorAll('[data-lucide="check-check"]');
                    checkIcons.forEach(icon => {
                        icon.classList.remove('text-blue-500');
                        icon.classList.add('text-blue-600');
                    });
                }, 1000);
            }
        };

        // Initialize security system when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            familyHubSecurity = new FamilyHubSecurity();
        });

        // =====================================
        // SYSTEM ADMIN FUNCTIONS
        // =====================================

        // Admin Access Control
        function checkAdminAccess(event) {
            event.preventDefault();
            
            // Simulate admin authentication
            const isAdmin = confirm('🔐 Admin Access Required\n\nDo you have administrator privileges?\n\nClick OK to proceed to admin panel or Cancel to return.');
            
            if (isAdmin) {
                navigateToPage('admin');
                showAlert('🛡️ Admin access granted. Welcome to System Administration.', 'success');
            } else {
                showAlert('❌ Access denied. Administrator privileges required.', 'error');
            }
        }

        // Admin Tab Management
        function showAdminTab(tabName, clickedButton) {
            console.log(`🔄 Switching to ${tabName} admin panel`);
            
            // Hide all tab contents by removing active class
            const allTabContents = document.querySelectorAll('.admin-tab-content');
            allTabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active styling from all tab buttons
            const allTabButtons = document.querySelectorAll('.admin-tab-btn');
            allTabButtons.forEach(button => {
                button.classList.remove('active', 'text-white', 'border-teal-500');
                button.classList.add('text-gray-400', 'border-transparent');
            });
            
            // Show selected tab content
            const selectedTabContent = document.getElementById(`admin-${tabName}`);
            if (selectedTabContent) {
                selectedTabContent.classList.add('active');
                console.log(`✅ Activated tab content: admin-${tabName}`);
            } else {
                console.error(`❌ Could not find tab content: admin-${tabName}`);
            }
            
            // Activate the correct tab button
            const allButtons = document.querySelectorAll('.admin-tab-btn');
            allButtons.forEach(button => {
                const onclick = button.getAttribute('onclick');
                if (onclick && onclick.includes(`'${tabName}'`)) {
                    button.classList.remove('text-gray-400', 'border-transparent');
                    button.classList.add('active', 'text-white', 'border-teal-500');
                    console.log(`✅ Activated tab button: ${tabName}`);
                }
            });
            
            // Re-initialize Lucide icons for the new content
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Show success notification
            setTimeout(() => {
                showAlert(`📊 Switched to ${tabName.charAt(0).toUpperCase() + tabName.slice(1)} panel`, 'success');
            }, 100);
        }

        // =====================================
        // SYSTEM OVERVIEW FUNCTIONS
        // =====================================

        function performBackup() {
            // Create and show backup progress modal
            const backupModal = document.createElement('div');
            backupModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            backupModal.id = 'backup-progress-modal';
            
            backupModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white flex items-center">
                            <i data-lucide="database" class="w-6 h-6 mr-2 text-blue-400"></i>
                            System Backup Process
                        </h3>
                        <button id="backup-close-btn" onclick="closeBackupModal()" class="text-gray-400 hover:text-white disabled:opacity-50" disabled>
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <!-- Overall Progress -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-300">Overall Progress</span>
                            <span id="overall-progress-text" class="text-white font-medium">0%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div id="overall-progress-bar" class="bg-blue-500 h-3 rounded-full transition-all duration-500 progress-0"></div>
                        </div>
                    </div>
                    
                    <!-- Status Display -->
                    <div class="mb-6">
                        <div class="flex items-center mb-3">
                            <div id="status-icon" class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="play" class="w-4 h-4 text-white"></i>
                            </div>
                            <div>
                                <div id="status-title" class="text-white font-medium">Initializing Backup Process...</div>
                                <div id="status-detail" class="text-gray-400 text-sm">Preparing system for backup operation</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backup Steps -->
                    <div class="space-y-4 mb-6">
                        <div id="step-prepare" class="backup-step flex items-center p-3 bg-gray-700 rounded-lg">
                            <div class="step-icon w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="settings" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-white font-medium">Prepare Backup Environment</div>
                                <div class="text-gray-400 text-sm">Setting up backup directories and permissions</div>
                            </div>
                            <div class="step-progress w-16 bg-gray-600 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300 progress-0"></div>
                            </div>
                        </div>
                        
                        <div id="step-database" class="backup-step flex items-center p-3 bg-gray-700 rounded-lg">
                            <div class="step-icon w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="database" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-white font-medium">Database Backup</div>
                                <div class="text-gray-400 text-sm">Exporting user data, ideas, and system settings</div>
                            </div>
                            <div class="step-progress w-16 bg-gray-600 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300 progress-0"></div>
                            </div>
                        </div>
                        
                        <div id="step-files" class="backup-step flex items-center p-3 bg-gray-700 rounded-lg">
                            <div class="step-icon w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="file-text" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-white font-medium">File System Backup</div>
                                <div class="text-gray-400 text-sm">Backing up documents, images, and configuration files</div>
                            </div>
                            <div class="step-progress w-16 bg-gray-600 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300 progress-0"></div>
                            </div>
                        </div>
                        
                        <div id="step-compress" class="backup-step flex items-center p-3 bg-gray-700 rounded-lg">
                            <div class="step-icon w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="archive" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-white font-medium">Compress & Finalize</div>
                                <div class="text-gray-400 text-sm">Creating backup archive and verifying integrity</div>
                            </div>
                            <div class="step-progress w-16 bg-gray-600 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300 progress-0"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-700 rounded-lg p-3 text-center">
                            <div id="files-backed-up" class="text-xl font-bold text-blue-400">0</div>
                            <div class="text-xs text-gray-400">Files Backed Up</div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-3 text-center">
                            <div id="data-size" class="text-xl font-bold text-green-400">0 MB</div>
                            <div class="text-xs text-gray-400">Data Size</div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-3 text-center">
                            <div id="elapsed-time" class="text-xl font-bold text-purple-400">0s</div>
                            <div class="text-xs text-gray-400">Elapsed Time</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-between">
                        <button id="backup-cancel-btn" onclick="cancelBackup()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            Cancel Backup
                        </button>
                        <button id="backup-download-btn" onclick="downloadBackup()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg hidden">
                            Download Backup
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(backupModal);
            
            // Initialize Lucide icons for the new modal
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Start the backup process
            startBackupProcess();
        }

        let backupProgress = 0;
        let backupCancelled = false;
        let backupStartTime = null;
        let backupTimer = null;

        function startBackupProcess() {
            backupProgress = 0;
            backupCancelled = false;
            backupStartTime = Date.now();
            
            // Start elapsed time counter
            updateElapsedTime();
            
            // Start backup steps
            setTimeout(() => executeBackupStep('prepare'), 500);
        }
        
        function executeBackupStep(step) {
            if (backupCancelled) return;
            
            const steps = {
                prepare: {
                    duration: 2000,
                    next: 'database',
                    title: 'Preparing Backup Environment...',
                    detail: 'Creating backup directories and setting permissions',
                    progressIncrement: 15,
                    files: 0,
                    size: 0
                },
                database: {
                    duration: 4000,
                    next: 'files',
                    title: 'Backing Up Database...',
                    detail: 'Exporting user data, ideas, and system configuration',
                    progressIncrement: 35,
                    files: 45,
                    size: 125
                },
                files: {
                    duration: 5000,
                    next: 'compress',
                    title: 'Backing Up Files...',
                    detail: 'Copying documents, images, and configuration files',
                    progressIncrement: 35,
                    files: 230,
                    size: 340
                },
                compress: {
                    duration: 3000,
                    next: 'complete',
                    title: 'Compressing & Finalizing...',
                    detail: 'Creating backup archive and verifying integrity',
                    progressIncrement: 15,
                    files: 0,
                    size: 465
                }
            };
            
            const currentStep = steps[step];
            if (!currentStep) return;
            
            // Update status
            updateBackupStatus(currentStep.title, currentStep.detail, step);
            
            // Animate step progress
            animateStepProgress(step, currentStep.duration);
            
            // Update overall progress and stats
            setTimeout(() => {
                if (backupCancelled) return;
                
                backupProgress += currentStep.progressIncrement;
                updateOverallProgress(backupProgress);
                updateBackupStats(currentStep.files, currentStep.size);
                
                if (currentStep.next === 'complete') {
                    completeBackup();
                } else {
                    executeBackupStep(currentStep.next);
                }
            }, currentStep.duration);
        }
        
        function animateStepProgress(stepId, duration) {
            if (backupCancelled) return;
            
            const stepElement = document.getElementById(`step-${stepId}`);
            const progressBar = stepElement.querySelector('.step-progress > div');
            const icon = stepElement.querySelector('.step-icon');
            
            // Activate step
            icon.classList.remove('bg-gray-600');
            icon.classList.add('bg-blue-500');
            icon.querySelector('i').classList.remove('text-gray-400');
            icon.querySelector('i').classList.add('text-white');
            
            // Animate progress bar
            let progress = 0;
            const increment = 100 / (duration / 50);
            
            const progressInterval = setInterval(() => {
                if (backupCancelled) {
                    clearInterval(progressInterval);
                    return;
                }
                
                progress += increment;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    
                    // Mark as complete
                    icon.classList.remove('bg-blue-500');
                    icon.classList.add('bg-green-500');
                    icon.innerHTML = '<i data-lucide="check" class="w-4 h-4 text-white"></i>';
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                }
                
                progressBar.style.width = `${progress}%`;
            }, 50);
        }
        
        function updateBackupStatus(title, detail, iconType) {
            if (backupCancelled) return;
            
            document.getElementById('status-title').textContent = title;
            document.getElementById('status-detail').textContent = detail;
            
            const statusIcon = document.getElementById('status-icon');
            const iconMap = {
                prepare: 'settings',
                database: 'database',
                files: 'file-text',
                compress: 'archive'
            };
            
            statusIcon.innerHTML = `<i data-lucide="${iconMap[iconType] || 'play'}" class="w-4 h-4 text-white"></i>`;
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        function updateOverallProgress(progress) {
            if (backupCancelled) return;
            
            document.getElementById('overall-progress-bar').style.width = `${progress}%`;
            document.getElementById('overall-progress-text').textContent = `${progress}%`;
        }
        
        function updateBackupStats(files, size) {
            if (backupCancelled) return;
            
            const currentFiles = parseInt(document.getElementById('files-backed-up').textContent);
            const currentSize = parseFloat(document.getElementById('data-size').textContent.replace(' MB', ''));
            
            // Animate counters
            animateCounter('files-backed-up', currentFiles, currentFiles + files, '');
            animateCounter('data-size', currentSize, currentSize + size, ' MB');
        }
        
        function animateCounter(elementId, start, end, suffix) {
            const element = document.getElementById(elementId);
            const duration = 1000;
            const increment = (end - start) / (duration / 50);
            let current = start;
            
            const counterInterval = setInterval(() => {
                if (backupCancelled) {
                    clearInterval(counterInterval);
                    return;
                }
                
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(counterInterval);
                }
                
                element.textContent = Math.floor(current) + suffix;
            }, 50);
        }
        
        function updateElapsedTime() {
            if (backupCancelled) return;
            
            backupTimer = setInterval(() => {
                if (backupCancelled) {
                    clearInterval(backupTimer);
                    return;
                }
                
                const elapsed = Math.floor((Date.now() - backupStartTime) / 1000);
                document.getElementById('elapsed-time').textContent = `${elapsed}s`;
            }, 1000);
        }
        
        function completeBackup() {
            clearInterval(backupTimer);
            
            // Update final status
            updateBackupStatus('Backup Completed Successfully!', 'All data has been backed up and verified', 'complete');
            
            const statusIcon = document.getElementById('status-icon');
            statusIcon.classList.remove('bg-blue-500');
            statusIcon.classList.add('bg-green-500');
            statusIcon.innerHTML = '<i data-lucide="check-circle" class="w-4 h-4 text-white"></i>';
            
            // Enable close button and show download button
            document.getElementById('backup-close-btn').disabled = false;
            document.getElementById('backup-close-btn').classList.remove('disabled:opacity-50');
            
            // Change cancel button to close button with proper handler
            const cancelBtn = document.getElementById('backup-cancel-btn');
            cancelBtn.textContent = 'Close';
            cancelBtn.onclick = closeBackupModal;
            cancelBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            cancelBtn.classList.add('bg-gray-600', 'hover:bg-gray-700');
            
            document.getElementById('backup-download-btn').classList.remove('hidden');
            
            // Update system activity
            updateSystemActivity('System backup completed successfully', 'success');
            
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Show success notification
            showAlert('✅ System backup completed successfully!', 'success');
        }
        
        function cancelBackup() {
            // Check if button text is already "Close" - if so, close the modal
            const cancelBtn = document.getElementById('backup-cancel-btn');
            if (cancelBtn && cancelBtn.textContent === 'Close') {
                closeBackupModal();
                return;
            }
            
            backupCancelled = true;
            clearInterval(backupTimer);
            
            updateBackupStatus('Backup Cancelled', 'The backup process has been cancelled by user request', 'cancel');
            
            const statusIcon = document.getElementById('status-icon');
            statusIcon.classList.remove('bg-blue-500');
            statusIcon.classList.add('bg-red-500');
            statusIcon.innerHTML = '<i data-lucide="x-circle" class="w-4 h-4 text-white"></i>';
            
            // Enable close button
            document.getElementById('backup-close-btn').disabled = false;
            document.getElementById('backup-close-btn').classList.remove('disabled:opacity-50');
            
            // Change cancel button to close button
            cancelBtn.textContent = 'Close';
            cancelBtn.onclick = closeBackupModal; // Change the click handler
            
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            showAlert('⚠️ Backup process cancelled', 'warning');
        }
        
        function closeBackupModal() {
            const modal = document.getElementById('backup-progress-modal');
            if (modal) {
                modal.remove();
            }
            backupCancelled = true;
            clearInterval(backupTimer);
        }
        
        function downloadBackup() {
            // Simulate backup download
            const backupData = {
                timestamp: new Date().toISOString(),
                version: '2.1.4',
                files: 275,
                size: '465 MB',
                users: 12,
                ideas: 48,
                checksum: 'a1b2c3d4e5f6'
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backupData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `family-hub-backup-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('📥 Backup file downloaded successfully!', 'success');
        }

        function runSecurityScan() {
            showAlert('🔍 Running comprehensive security scan...', 'info');
            
            // Simulate security scan
            setTimeout(() => {
                showAlert('🛡️ Security scan completed. No critical threats detected.', 'success');
                updateSystemActivity('Security scan completed - system secure', 'success');
            }, 5000);
        }

        function optimizeDatabase() {
            showAlert('⚡ Optimizing database performance...', 'info');
            
            // Simulate database optimization
            setTimeout(() => {
                showAlert('✅ Database optimization completed successfully!', 'success');
                updateSystemActivity('Database optimization completed', 'success');
            }, 4000);
        }

        function viewSystemLogs() {
            const logModal = document.createElement('div');
            logModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            logModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">System Logs</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="bg-black rounded-lg p-4 font-mono text-sm text-green-400 h-96 overflow-y-auto">
                        <div>[$(new Date().toISOString())] INFO: System startup completed</div>
                        <div>[$(new Date().toISOString())] INFO: All services initialized successfully</div>
                        <div>[$(new Date().toISOString())] INFO: Security scan completed - no threats detected</div>
                        <div>[$(new Date().toISOString())] INFO: Database backup completed</div>
                        <div>[$(new Date().toISOString())] WARN: High CPU usage detected - investigating</div>
                        <div>[$(new Date().toISOString())] INFO: User authentication successful</div>
                        <div>[$(new Date().toISOString())] INFO: Admin panel accessed</div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button onclick="downloadLogs()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Download Logs
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(logModal);
            initializeLucide();
        }

        function exportSystemReport() {
            const report = {
                timestamp: new Date().toISOString(),
                systemHealth: '98.5%',
                totalUsers: 247,
                securityAlerts: 3,
                storageUsed: '67%',
                uptime: '99.9%',
                services: {
                    webServer: 'Running',
                    database: 'Running',
                    cache: 'Running',
                    email: 'Warning',
                    storage: 'Running'
                },
                recentActivity: [
                    'System backup completed',
                    'Security scan passed',
                    'Database optimized',
                    'New user registered'
                ]
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(report, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `system-report-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('📊 System report exported successfully!', 'success');
        }

        function updateSystemActivity(message, type) {
            console.log(`[ADMIN] ${type.toUpperCase()}: ${message}`);
        }

        // Enhanced System Alert Functions
        function refreshAlerts() {
            showAlert('🔄 Refreshing system alerts...', 'info');
            
            setTimeout(() => {
                showAlert('✅ System alerts refreshed!', 'success');
                console.log('📊 System alerts updated');
            }, 1500);
        }

        function handleAlert(alertType) {
            const alertDetails = {
                'cpu-usage': {
                    title: 'High CPU Usage Investigation',
                    content: `
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">CPU Usage Analysis</h4>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-300">Current Usage:</span> <span class="text-red-400 font-semibold">85%</span></div>
                                    <div><span class="text-gray-300">Average (24h):</span> <span class="text-blue-400">45%</span></div>
                                    <div><span class="text-gray-300">Peak Usage:</span> <span class="text-yellow-400">92%</span></div>
                                    <div><span class="text-gray-300">Threshold:</span> <span class="text-green-400">80%</span></div>
                                </div>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-white font-medium mb-2">Top Processes:</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span class="text-gray-300">node.js (main)</span><span class="text-red-400">42%</span></div>
                                    <div class="flex justify-between"><span class="text-gray-300">database</span><span class="text-yellow-400">28%</span></div>
                                    <div class="flex justify-between"><span class="text-gray-300">file processor</span><span class="text-blue-400">15%</span></div>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="killHighCpuProcess()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                                    Kill Heavy Process
                                </button>
                                <button onclick="optimizePerformance()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    Optimize Performance
                                </button>
                            </div>
                        </div>
                    `
                },
                'ssl-expiry': {
                    title: 'SSL Certificate Renewal',
                    content: `
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">Certificate Information</h4>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between"><span class="text-gray-300">Domain:</span><span class="text-white">familybusinesshub.com</span></div>
                                    <div class="flex justify-between"><span class="text-gray-300">Issuer:</span><span class="text-blue-400">Let's Encrypt</span></div>
                                    <div class="flex justify-between"><span class="text-gray-300">Expires:</span><span class="text-yellow-400">30 days</span></div>
                                    <div class="flex justify-between"><span class="text-gray-300">Type:</span><span class="text-green-400">Wildcard SSL</span></div>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="renewSslCert()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                                    Auto-Renew Certificate
                                </button>
                                <button onclick="checkSslStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    Check SSL Status
                                </button>
                            </div>
                        </div>
                    `
                },
                'update-available': {
                    title: 'System Update Available',
                    content: `
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">Security Patch v2.1.4</h4>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-white font-medium mb-2">Update Details:</h5>
                                <ul class="space-y-1 text-sm text-gray-300">
                                    <li>• Critical security vulnerability fixes</li>
                                    <li>• Database performance improvements</li>
                                    <li>• Enhanced encryption protocols</li>
                                    <li>• Bug fixes for chat system</li>
                                    <li>• UI/UX improvements</li>
                                </ul>
                            </div>
                            <div class="bg-blue-500/20 border border-blue-500/50 rounded-lg p-3">
                                <div class="flex items-center">
                                    <i data-lucide="info" class="w-4 h-4 text-blue-400 mr-2"></i>
                                    <span class="text-blue-300 text-sm">Estimated downtime: 5-10 minutes</span>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="installUpdate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                                    Install Now
                                </button>
                                <button onclick="scheduleUpdate()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    Schedule for Later
                                </button>
                            </div>
                        </div>
                    `
                }
            };

            const alert = alertDetails[alertType];
            if (!alert) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">${alert.title}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    ${alert.content}
                </div>
            `;
            
            document.body.appendChild(modal);
            initializeLucide();
        }

        function resolveAlert(alertType) {
            const actions = {
                'cpu-usage': 'Investigating CPU usage spike...',
                'ssl-expiry': 'Processing SSL certificate renewal...',
                'update-available': 'Preparing system update...'
            };
            
            showAlert(`🔧 ${actions[alertType]}`, 'info');
            
            setTimeout(() => {
                showAlert(`✅ Alert resolved: ${alertType.replace('-', ' ')}`, 'success');
                // Hide the alert from the UI
                const alertElement = document.querySelector(`[onclick*="${alertType}"]`);
                if (alertElement) {
                    alertElement.style.opacity = '0.5';
                    alertElement.style.pointerEvents = 'none';
                    const resolveBtn = alertElement.querySelector('button');
                    if (resolveBtn) resolveBtn.textContent = 'Resolved';
                }
            }, 2000);
        }

        // Alert Action Functions
        function killHighCpuProcess() {
            showAlert('🔄 Terminating high CPU process...', 'info');
            setTimeout(() => {
                showAlert('✅ Process terminated. CPU usage reduced to 45%', 'success');
                document.querySelector('.fixed').remove();
            }, 2000);
        }

        function optimizePerformance() {
            showAlert('⚡ Running performance optimization...', 'info');
            setTimeout(() => {
                showAlert('✅ Performance optimized. CPU usage normalized.', 'success');
                document.querySelector('.fixed').remove();
            }, 3000);
        }

        function renewSslCert() {
            showAlert('🔐 Renewing SSL certificate...', 'info');
            setTimeout(() => {
                showAlert('✅ SSL certificate renewed successfully!', 'success');
                document.querySelector('.fixed').remove();
            }, 3000);
        }

        function checkSslStatus() {
            showAlert('🔍 Checking SSL certificate status...', 'info');
            setTimeout(() => {
                showAlert('✅ SSL certificate is valid and properly configured.', 'success');
            }, 1500);
        }

        function installUpdate() {
            if (confirm('⚠️ Install system update now?\n\nThis will restart the system and cause brief downtime.')) {
                showAlert('📥 Installing system update v2.1.4...', 'info');
                setTimeout(() => {
                    showAlert('✅ System update installed successfully!', 'success');
                    document.querySelector('.fixed').remove();
                }, 4000);
            }
        }

        function scheduleUpdate() {
            const time = prompt('⏰ Schedule update for when?\n\nEnter time (e.g., "2:00 AM", "Sunday 3:00 AM"):');
            if (time) {
                showAlert(`📅 Update scheduled for ${time}`, 'success');
                document.querySelector('.fixed').remove();
            }
        }

        // Enhanced Activity Feed Functions
        function refreshActivity() {
            showAlert('🔄 Refreshing activity feed...', 'info');
            
            // Simulate adding new activity
            setTimeout(() => {
                const activityFeed = document.getElementById('activity-feed');
                const newActivity = document.createElement('div');
                newActivity.className = 'flex items-center space-x-3 p-3 bg-gray-600 rounded-lg hover:bg-gray-500 cursor-pointer transition-colors';
                newActivity.innerHTML = `
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <div class="flex-1">
                        <p class="text-white text-sm">Admin login from new device detected</p>
                        <p class="text-gray-400 text-xs">Just now</p>
                    </div>
                `;
                activityFeed.insertBefore(newActivity, activityFeed.firstChild);
                showAlert('✅ Activity feed refreshed!', 'success');
            }, 1500);
        }

        function viewAllActivity() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Complete Activity Log</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <div>
                                        <p class="text-white">User Registration: john.doe@family.com</p>
                                        <p class="text-gray-400 text-sm">IP: 192.168.1.105 • Device: Chrome/Windows</p>
                                    </div>
                                </div>
                                <span class="text-gray-400 text-sm">2 min ago</span>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <div>
                                        <p class="text-white">System Backup Completed</p>
                                        <p class="text-gray-400 text-sm">Size: 2.3GB • Duration: 00:04:23</p>
                                    </div>
                                </div>
                                <span class="text-gray-400 text-sm">15 min ago</span>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                    <div>
                                        <p class="text-white">Security Scan Alert</p>
                                        <p class="text-gray-400 text-sm">1 low-risk issue found • Auto-resolved</p>
                                    </div>
                                </div>
                                <span class="text-gray-400 text-sm">1 hour ago</span>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                                    <div>
                                        <p class="text-white">Database Optimization</p>
                                        <p class="text-gray-400 text-sm">Performance improved by 15% • Cache cleared</p>
                                    </div>
                                </div>
                                <span class="text-gray-400 text-sm">3 hours ago</span>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <div>
                                        <p class="text-white">Failed Login Attempt</p>
                                        <p class="text-gray-400 text-sm">IP: 203.45.67.89 • Blocked after 3 attempts</p>
                                    </div>
                                </div>
                                <span class="text-gray-400 text-sm">5 hours ago</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end mt-6 space-x-3">
                        <button onclick="exportActivityLog()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Export Log
                        </button>
                        <button onclick="clearOldActivity()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            Clear Old Entries
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            initializeLucide();
        }

        function viewActivityDetails(type, id) {
            const details = {
                'user-registration': {
                    title: 'User Registration Details',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-white font-medium mb-3">Registration Information</h5>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-300">Email:</span> <span class="text-white">${id}</span></div>
                                    <div><span class="text-gray-300">Name:</span> <span class="text-white">John Doe</span></div>
                                    <div><span class="text-gray-300">IP Address:</span> <span class="text-blue-400">192.168.1.105</span></div>
                                    <div><span class="text-gray-300">Device:</span> <span class="text-white">Chrome/Windows 11</span></div>
                                    <div><span class="text-gray-300">Location:</span> <span class="text-white">New York, USA</span></div>
                                    <div><span class="text-gray-300">Status:</span> <span class="text-green-400">Email Verified</span></div>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="approveUser('${id}')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">Approve User</button>
                                <button onclick="flagUser('${id}')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">Flag for Review</button>
                            </div>
                        </div>
                    `
                },
                'backup': {
                    title: 'Backup Details',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-white font-medium mb-3">Backup Information</h5>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-300">Backup ID:</span> <span class="text-white">${id}</span></div>
                                    <div><span class="text-gray-300">Type:</span> <span class="text-blue-400">Full System</span></div>
                                    <div><span class="text-gray-300">Size:</span> <span class="text-white">2.3 GB</span></div>
                                    <div><span class="text-gray-300">Duration:</span> <span class="text-white">4:23 minutes</span></div>
                                    <div><span class="text-gray-300">Compression:</span> <span class="text-green-400">67%</span></div>
                                    <div><span class="text-gray-300">Status:</span> <span class="text-green-400">Success</span></div>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="downloadBackup('${id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Download Backup</button>
                                <button onclick="restoreFromBackup('${id}')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg">Restore System</button>
                            </div>
                        </div>
                    `
                }
            };

            const detail = details[type] || {
                title: 'Activity Details',
                content: `<p class="text-white">Details for ${type}: ${id}</p>`
            };

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">${detail.title}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    ${detail.content}
                </div>
            `;
            document.body.appendChild(modal);
            initializeLucide();
        }

        function viewUser(email) {
            showAlert(`👤 Opening user profile for ${email}...`, 'info');
            setTimeout(() => showAdminTab('users'), 500);
        }

        function downloadBackup(id) {
            showAlert(`💾 Preparing backup download for ${id}...`, 'info');
            setTimeout(() => {
                showAlert('✅ Backup download started!', 'success');
            }, 2000);
        }

        function viewSecurityReport(id) {
            showAlert(`🔍 Loading security report ${id}...`, 'info');
            setTimeout(() => showAdminTab('security'), 500);
        }

        function viewOptimizationReport(id) {
            showAlert(`📊 Loading optimization report ${id}...`, 'info');
            setTimeout(() => showAdminTab('system'), 500);
        }

        function approveUser(email) {
            showAlert(`✅ User ${email} approved successfully!`, 'success');
            document.querySelector('.fixed').remove();
        }

        function flagUser(email) {
            showAlert(`🚩 User ${email} flagged for manual review.`, 'info');
            document.querySelector('.fixed').remove();
        }

        function restoreFromBackup(id) {
            if (confirm(`⚠️ Restore system from backup ${id}?\n\nThis will overwrite current data and restart the system.`)) {
                showAlert('🔄 Starting system restore...', 'info');
                setTimeout(() => {
                    showAlert('✅ System restored successfully!', 'success');
                    document.querySelector('.fixed').remove();
                }, 4000);
            }
        }

        function clearOldActivity() {
            if (confirm('🗑️ Clear activity entries older than 30 days?')) {
                showAlert('🧹 Clearing old activity entries...', 'info');
                setTimeout(() => {
                    showAlert('✅ Old activity entries cleared!', 'success');
                }, 2000);
            }
        }

        function exportActivityLog() {
            showAlert('📊 Preparing activity log export...', 'info');
            
            const activityData = {
                exportDate: new Date().toISOString(),
                totalEntries: 127,
                activities: [
                    { timestamp: '2024-01-15T10:30:00Z', type: 'user-registration', user: 'john.doe@family.com', ip: '192.168.1.105', status: 'success' },
                    { timestamp: '2024-01-15T10:15:00Z', type: 'system-backup', size: '2.3GB', duration: '4:23', status: 'completed' },
                    { timestamp: '2024-01-15T09:30:00Z', type: 'security-scan', issues: 1, severity: 'low', status: 'resolved' },
                    { timestamp: '2024-01-15T06:00:00Z', type: 'database-optimization', improvement: '15%', status: 'completed' },
                    { timestamp: '2024-01-15T05:45:00Z', type: 'failed-login', ip: '203.45.67.89', attempts: 3, status: 'blocked' }
                ]
            };
            
            setTimeout(() => {
                const dataStr = JSON.stringify(activityData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute('href', URL.createObjectURL(dataBlob));
                downloadAnchorNode.setAttribute('download', `activity-log-${new Date().toISOString().split('T')[0]}.json`);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                
                showAlert('✅ Activity log exported successfully!', 'success');
            }, 2000);
        }

        // =====================================
        // USER MANAGEMENT FUNCTIONS
        // =====================================

        function bulkUserActions() {
            const actionModal = document.createElement('div');
            actionModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            actionModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Bulk User Actions</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <button onclick="bulkAction('activate')" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg">
                            Activate Selected Users
                        </button>
                        <button onclick="bulkAction('suspend')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg">
                            Suspend Selected Users
                        </button>
                        <button onclick="bulkAction('delete')" class="w-full bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg">
                            Delete Selected Users
                        </button>
                        <button onclick="bulkAction('export')" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg">
                            Export Selected Users
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(actionModal);
            initializeLucide();
        }

        function bulkAction(action) {
            showAlert(`🔄 Performing bulk ${action} action...`, 'info');
            
            setTimeout(() => {
                showAlert(`✅ Bulk ${action} completed successfully!`, 'success');
                document.querySelector('.fixed').remove();
            }, 2000);
        }

        function exportUserData() {
            const userData = {
                totalUsers: 247,
                exportDate: new Date().toISOString(),
                users: [
                    { id: 1, name: 'John Smith', email: 'john.smith@family.com', role: 'Administrator', status: 'Active' },
                    { id: 2, name: 'Sarah Davis', email: 'sarah.davis@family.com', role: 'Moderator', status: 'Active' },
                    { id: 3, name: 'Mike Johnson', email: 'mike.johnson@family.com', role: 'User', status: 'Active' }
                ]
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(userData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `user-data-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('👥 User data exported successfully!', 'success');
        }

        // =====================================
        // CONTENT MANAGEMENT FUNCTIONS
        // =====================================

        function moderateContent() {
            const moderationModal = document.createElement('div');
            moderationModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            moderationModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Content Moderation Tools</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="moderateAction('review-flagged')" class="bg-red-600 hover:bg-red-700 text-white p-4 rounded-lg">
                            🚩 Review Flagged Content (12)
                        </button>
                        <button onclick="moderateAction('auto-approve')" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg">
                            ✅ Auto-Approve Trusted Users
                        </button>
                        <button onclick="moderateAction('keyword-filter')" class="bg-yellow-600 hover:bg-yellow-700 text-white p-4 rounded-lg">
                            🔍 Keyword Filter Settings
                        </button>
                        <button onclick="moderateAction('user-reports')" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg">
                            📋 User Reports (7)
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(moderationModal);
            initializeLucide();
        }

        function moderateAction(action) {
            const actions = {
                'review-flagged': 'Opening flagged content review interface...',
                'auto-approve': 'Configuring auto-approval settings...',
                'keyword-filter': 'Opening keyword filter management...',
                'user-reports': 'Loading user report dashboard...'
            };
            showAlert(`👁️ ${actions[action]}`, 'info');
            document.querySelector('.fixed').remove();
        }

        function contentAnalytics() {
            const analyticsModal = document.createElement('div');
            analyticsModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            analyticsModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Content Analytics Dashboard</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="text-white font-semibold mb-3">Content Performance</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between"><span class="text-gray-300">Top Ideas</span><span class="text-green-400">+127%</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Chat Activity</span><span class="text-blue-400">+45%</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Engagement</span><span class="text-yellow-400">+89%</span></div>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="text-white font-semibold mb-3">Trending Topics</h4>
                            <div class="space-y-2">
                                <div class="text-gray-300">1. AI Technology</div>
                                <div class="text-gray-300">2. Business Strategy</div>
                                <div class="text-gray-300">3. Market Analysis</div>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="text-white font-semibold mb-3">Moderation Stats</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between"><span class="text-gray-300">Approved</span><span class="text-green-400">94%</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Flagged</span><span class="text-yellow-400">4%</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Removed</span><span class="text-red-400">2%</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="exportContentAnalytics()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg mr-3">
                            Export Report
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(analyticsModal);
            initializeLucide();
        }

        function exportContentAnalytics() {
            const contentAnalytics = {
                exportDate: new Date().toISOString(),
                contentPerformance: {
                    topIdeas: '+127%',
                    chatActivity: '+45%',
                    engagement: '+89%'
                },
                trendingTopics: [
                    'AI Technology',
                    'Business Strategy', 
                    'Market Analysis'
                ],
                moderationStats: {
                    approved: '94%',
                    flagged: '4%',
                    removed: '2%'
                }
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(contentAnalytics, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `content-analytics-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('📊 Content analytics exported successfully!', 'success');
            document.querySelector('.fixed').remove();
        }

        function bulkContentActions() {
            const bulkModal = document.createElement('div');
            bulkModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            bulkModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Bulk Content Actions</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <button onclick="bulkContentAction('approve-all')" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg">
                            ✅ Approve All Pending
                        </button>
                        <button onclick="bulkContentAction('archive-old')" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg">
                            📦 Archive Old Content
                        </button>
                        <button onclick="bulkContentAction('delete-flagged')" class="w-full bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg">
                            🗑️ Delete Flagged Content
                        </button>
                        <button onclick="bulkContentAction('update-categories')" class="w-full bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg">
                            🏷️ Update Categories
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(bulkModal);
            initializeLucide();
        }

        function bulkContentAction(action) {
            const actions = {
                'approve-all': 'Approving all pending content...',
                'archive-old': 'Archiving old content...',
                'delete-flagged': 'Deleting flagged content...',
                'update-categories': 'Updating content categories...'
            };
            
            showAlert(`📝 ${actions[action]}`, 'info');
            
            setTimeout(() => {
                showAlert(`✅ Bulk ${action.replace('-', ' ')} completed successfully!`, 'success');
                document.querySelector('.fixed').remove();
            }, 2000);
        }

        function contentBackup() {
            showAlert('💾 Starting content backup process...', 'info');
            
            setTimeout(() => {
                showAlert('✅ Content backup completed successfully!', 'success');
            }, 3000);
        }

        function contentSearch() {
            const searchModal = document.createElement('div');
            searchModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            searchModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Advanced Content Search</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Search Query</label>
                            <input type="text" placeholder="Enter keywords, phrases, or content ID..." class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Content Type</label>
                                <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    <option>All Content</option>
                                    <option>Ideas</option>
                                    <option>Chat Messages</option>
                                    <option>Business Plans</option>
                                    <option>Comments</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date Range</label>
                                <select class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white">
                                    <option>All Time</option>
                                    <option>Last 24 Hours</option>
                                    <option>Last Week</option>
                                    <option>Last Month</option>
                                    <option>Custom Range</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="performContentSearch()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg">
                                🔍 Search Content
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(searchModal);
            initializeLucide();
        }

        function performContentSearch() {
            showAlert('🔍 Searching content database...', 'info');
            setTimeout(() => {
                showAlert('✅ Found 127 matching results!', 'success');
                document.querySelector('.fixed').remove();
            }, 2000);
        }

        function editContentPolicies() {
            const policiesModal = document.createElement('div');
            policiesModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            policiesModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-3xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Content Policy Management</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">Automated Moderation Rules</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Auto-flag spam content</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Require approval for external links</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Auto-approve trusted users</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">Keyword Filters</h4>
                            <textarea rows="4" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-3 py-2 text-white" placeholder="Enter prohibited keywords (one per line)...">spam
promotional
advertising
inappropriate</textarea>
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button onclick="savePolicies()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg">
                                💾 Save Policies
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(policiesModal);
            initializeLucide();
        }

        function savePolicies() {
            showAlert('💾 Saving content policies...', 'info');
            setTimeout(() => {
                showAlert('✅ Content policies updated successfully!', 'success');
                document.querySelector('.fixed').remove();
            }, 1500);
        }

        function automationRules() {
            const automationModal = document.createElement('div');
            automationModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            automationModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Automation Rules</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="automationAction('backup')" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg">
                                🕐 Scheduled Backups
                            </button>
                            <button onclick="automationAction('cleanup')" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg">
                                🧹 Auto Cleanup Rules
                            </button>
                            <button onclick="automationAction('notifications')" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg">
                                🔔 Notification Rules
                            </button>
                            <button onclick="automationAction('moderation')" class="bg-yellow-600 hover:bg-yellow-700 text-white p-4 rounded-lg">
                                🛡️ Auto Moderation
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(automationModal);
            initializeLucide();
        }

        function automationAction(action) {
            const actions = {
                backup: 'Configure automated backup schedules...',
                cleanup: 'Set up automatic cleanup rules...',
                notifications: 'Configure notification automation...',
                moderation: 'Set up automated moderation rules...'
            };
            showAlert(`⚡ ${actions[action]}`, 'info');
            document.querySelector('.fixed').remove();
        }

        function reportTemplates() {
            const templatesModal = document.createElement('div');
            templatesModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            templatesModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Report Templates</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 gap-3">
                            <button onclick="useTemplate('daily')" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg text-left">
                                📊 Daily Activity Report
                            </button>
                            <button onclick="useTemplate('weekly')" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg text-left">
                                📈 Weekly Analytics Report
                            </button>
                            <button onclick="useTemplate('security')" class="bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg text-left">
                                🔒 Security Audit Report
                            </button>
                            <button onclick="useTemplate('content')" class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg text-left">
                                📝 Content Performance Report
                            </button>
                            <button onclick="useTemplate('custom')" class="bg-gray-600 hover:bg-gray-700 text-white p-3 rounded-lg text-left">
                                ⚙️ Create Custom Template
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(templatesModal);
            initializeLucide();
        }

        function useTemplate(templateType) {
            const templates = {
                daily: 'Generating daily activity report...',
                weekly: 'Creating weekly analytics report...',
                security: 'Preparing security audit report...',
                content: 'Building content performance report...',
                custom: 'Opening custom template builder...'
            };
            showAlert(`📄 ${templates[templateType]}`, 'info');
            document.querySelector('.fixed').remove();
        }

        // =====================================
        // SECURITY CENTER FUNCTIONS
        // =====================================

        function securityScan() {
            showAlert('🔍 Running comprehensive security scan...', 'info');
            
            setTimeout(() => {
                showAlert('🛡️ Security scan completed. System is secure!', 'success');
            }, 4000);
        }

        function securityReport() {
            const securityReport = {
                timestamp: new Date().toISOString(),
                securityScore: '94/100',
                encryptionStatus: 'Active',
                threatsDetected: 2,
                lastScan: '2 hours ago',
                vulnerabilities: [],
                recommendations: [
                    'Update 23 user passwords',
                    'Enable IP whitelist',
                    'Review admin access logs'
                ]
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(securityReport, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `security-report-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('🔒 Security report exported successfully!', 'success');
        }

        // =====================================
        // SYSTEM MONITOR FUNCTIONS
        // =====================================

        function refreshSystemStatus() {
            showAlert('🔄 Refreshing system status...', 'info');
            
            setTimeout(() => {
                showAlert('✅ System status updated!', 'success');
            }, 1500);
        }

        function systemMaintenance() {
            const maintenanceModal = document.createElement('div');
            maintenanceModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            maintenanceModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">System Maintenance</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <button onclick="performMaintenance('restart')" class="w-full bg-orange-600 hover:bg-orange-700 text-white p-3 rounded-lg">
                            🔄 Restart System
                        </button>
                        <button onclick="performMaintenance('cleanup')" class="w-full bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg">
                            🧹 Clean Temporary Files
                        </button>
                        <button onclick="performMaintenance('update')" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg">
                            ⬆️ Apply System Updates
                        </button>
                        <button onclick="performMaintenance('optimize')" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg">
                            ⚡ Optimize Performance
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(maintenanceModal);
            initializeLucide();
        }

        function performMaintenance(type) {
            const actions = {
                restart: 'Restarting system services...',
                cleanup: 'Cleaning temporary files...',
                update: 'Applying system updates...',
                optimize: 'Optimizing system performance...'
            };
            
            showAlert(`🔧 ${actions[type]}`, 'info');
            
            setTimeout(() => {
                showAlert(`✅ ${type.charAt(0).toUpperCase() + type.slice(1)} completed successfully!`, 'success');
                document.querySelector('.fixed').remove();
            }, 3000);
        }

        function restartService(service) {
            showAlert(`🔄 Restarting ${service} service...`, 'info');
            
            setTimeout(() => {
                showAlert(`✅ ${service.charAt(0).toUpperCase() + service.slice(1)} service restarted successfully!`, 'success');
            }, 2000);
        }

        function clearCache() {
            showAlert('🗑️ Clearing system cache...', 'info');
            
            setTimeout(() => {
                showAlert('✅ System cache cleared successfully!', 'success');
            }, 1500);
        }

        function runDiskCleanup() {
            showAlert('💽 Running disk cleanup...', 'info');
            
            setTimeout(() => {
                showAlert('✅ Disk cleanup completed. 2.3GB freed!', 'success');
            }, 3000);
        }

        // =====================================
        // ANALYTICS FUNCTIONS
        // =====================================

        function exportAnalytics() {
            const analyticsData = {
                period: 'Last 7 days',
                exportDate: new Date().toISOString(),
                dailyActiveUsers: 142,
                pageViews: 3247,
                ideasCreated: 28,
                chatMessages: 1892,
                featureUsage: {
                    chat: '85%',
                    ideas: '72%',
                    financial: '68%',
                    tasks: '54%'
                },
                userEngagement: {
                    averageSessionDuration: '18m 32s',
                    pagesPerSession: 4.2,
                    bounceRate: '23%',
                    returnVisitorRate: '76%'
                }
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(analyticsData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `analytics-report-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('📈 Analytics data exported successfully!', 'success');
        }

        // =====================================
        // SYSTEM SETTINGS FUNCTIONS
        // =====================================

        function saveSystemSettings() {
            showAlert('💾 Saving system settings...', 'info');
            
            // Simulate saving all form data
            const formData = {
                siteName: document.querySelector('input[value="Family Business Hub"]')?.value || 'Family Business Hub',
                timezone: 'UTC-5 (Eastern Time)',
                language: 'English',
                features: {
                    userRegistration: true,
                    emailNotifications: true,
                    chatFeature: true,
                    fileUploads: true,
                    apiAccess: false
                },
                backup: {
                    frequency: 'Daily',
                    time: '02:00',
                    retention: 30
                },
                savedAt: new Date().toISOString()
            };
            
            setTimeout(() => {
                console.log('💾 System Settings Saved:', formData);
                showAlert('✅ System settings saved successfully! All changes are now active.', 'success');
            }, 1500);
        }

        function resetToDefaults() {
            if (confirm('⚠️ Are you sure you want to reset all settings to defaults?\n\nThis action cannot be undone.')) {
                showAlert('🔄 Resetting to default settings...', 'info');
                
                setTimeout(() => {
                    showAlert('✅ Settings reset to defaults successfully!', 'success');
                }, 2000);
            }
        }

        function runManualBackup() {
            showAlert('💾 Starting manual backup...', 'info');
            
            setTimeout(() => {
                showAlert('✅ Manual backup completed successfully!', 'success');
            }, 3000);
        }

        function downloadLogs() {
            const logData = `[${new Date().toISOString()}] INFO: System startup completed
[${new Date().toISOString()}] INFO: All services initialized successfully
[${new Date().toISOString()}] INFO: Security scan completed - no threats detected
[${new Date().toISOString()}] INFO: Database backup completed
[${new Date().toISOString()}] WARN: High CPU usage detected - investigating
[${new Date().toISOString()}] INFO: User authentication successful
[${new Date().toISOString()}] INFO: Admin panel accessed`;
            
            const dataStr = "data:text/plain;charset=utf-8," + encodeURIComponent(logData);
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `system-logs-${Date.now()}.log`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('📄 System logs downloaded successfully!', 'success');
        }

        // =====================================
        // ADDITIONAL ADMIN UTILITY FUNCTIONS
        // =====================================

        // Initialize admin dashboard when page loads
        function initializeAdminDashboard() {
            // Set up toggle switch listeners
            document.addEventListener('change', function(e) {
                if (e.target.type === 'checkbox' && e.target.closest('.admin-tab-content')) {
                    const setting = e.target.closest('label').previousElementSibling?.textContent || 'setting';
                    const status = e.target.checked ? 'enabled' : 'disabled';
                    console.log(`🔧 Admin setting changed: ${setting} - ${status}`);
                }
            });

            // Auto-refresh admin stats every 30 seconds
            setInterval(refreshAdminStats, 30000);
        }

        function refreshAdminStats() {
            // Simulate real-time stat updates
            const stats = [
                { selector: '.admin-overview .text-3xl', values: ['247', '98.5%', '3', '67%'] },
            ];
            
            console.log('📊 Admin stats refreshed automatically');
        }

        // Enhanced security features
        function enableMaintenanceMode() {
            if (confirm('⚠️ Enable maintenance mode?\n\nThis will temporarily disable access for all users except admins.')) {
                showAlert('🔧 Maintenance mode enabled. Site is now in maintenance.', 'info');
                console.log('🔧 Maintenance mode: ENABLED');
            }
        }

        function disableMaintenanceMode() {
            showAlert('✅ Maintenance mode disabled. Site is now accessible to all users.', 'success');
            console.log('✅ Maintenance mode: DISABLED');
        }

        // Live user activity monitoring
        function viewLiveUserActivity() {
            const activityModal = document.createElement('div');
            activityModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            activityModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Live User Activity Monitor</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="bg-black rounded-lg p-4 font-mono text-sm h-96 overflow-y-auto">
                        <div class="text-green-400">🟢 john.smith@family.com - Viewing Financial Dashboard</div>
                        <div class="text-blue-400">🔵 sarah.davis@family.com - Active in Chat</div>
                        <div class="text-yellow-400">🟡 mike.johnson@family.com - Creating new idea</div>
                        <div class="text-purple-400">🟣 lisa.wilson@family.com - Task Management</div>
                        <div class="text-green-400">🟢 tom.brown@family.com - Business Planning</div>
                        <div class="text-gray-400">⚪ emma.davis@family.com - Idle (5 min)</div>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-gray-400 text-sm">Auto-updating every 5 seconds</span>
                        <button onclick="exportActivityLog()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Export Activity Log
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(activityModal);
            initializeLucide();
        }

        function exportActivityLog() {
            const activityData = {
                timestamp: new Date().toISOString(),
                activeUsers: [
                    { user: 'john.smith@family.com', activity: 'Viewing Financial Dashboard', status: 'active' },
                    { user: 'sarah.davis@family.com', activity: 'Active in Chat', status: 'active' },
                    { user: 'mike.johnson@family.com', activity: 'Creating new idea', status: 'active' },
                    { user: 'lisa.wilson@family.com', activity: 'Task Management', status: 'active' },
                    { user: 'tom.brown@family.com', activity: 'Business Planning', status: 'active' },
                    { user: 'emma.davis@family.com', activity: 'Idle', status: 'idle' }
                ]
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(activityData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `user-activity-${Date.now()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showAlert('📊 User activity log exported successfully!', 'success');
        }

        // Enhanced system monitoring
        function viewDetailedSystemInfo() {
            const systemModal = document.createElement('div');
            systemModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            systemModal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-3xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Detailed System Information</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">Server Information</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between"><span class="text-gray-300">OS:</span><span class="text-white">Ubuntu 22.04 LTS</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Node.js:</span><span class="text-white">v18.17.0</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Memory:</span><span class="text-white">16GB DDR4</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Storage:</span><span class="text-white">500GB NVMe SSD</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Uptime:</span><span class="text-white">15 days, 7 hours</span></div>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">Database Statistics</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between"><span class="text-gray-300">Type:</span><span class="text-white">PostgreSQL 15</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Size:</span><span class="text-white">2.1GB</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Tables:</span><span class="text-white">47</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Records:</span><span class="text-white">156,847</span></div>
                                <div class="flex justify-between"><span class="text-gray-300">Last Backup:</span><span class="text-white">2 hours ago</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(systemModal);
            initializeLucide();
        }

        // Add CSS for admin tab styling
        const adminStyle = document.createElement('style');
        adminStyle.textContent = `
            .admin-tab-content {
                display: none !important;
            }
            .admin-tab-content.active {
                display: block !important;
            }
            .admin-tab-btn.active {
                color: white !important;
                border-bottom-color: #14b8a6 !important;
                background-color: rgba(20, 184, 166, 0.1) !important;
            }
            .admin-tab-btn:hover {
                background-color: rgba(75, 85, 99, 0.5) !important;
            }
            .admin-tab-btn.active:hover {
                background-color: rgba(20, 184, 166, 0.2) !important;
            }
            .admin-overview .stat-card {
                animation: pulse-glow 2s infinite;
            }
            @keyframes pulse-glow {
                0%, 100% { box-shadow: 0 0 5px rgba(79, 70, 229, 0.3); }
                50% { box-shadow: 0 0 20px rgba(79, 70, 229, 0.6); }
            }
            /* Ensure proper visibility control */
            #admin-overview,
            #admin-users,
            #admin-content,
            #admin-security,
            #admin-system,
            #admin-analytics,
            #admin-settings {
                display: none !important;
            }
            #admin-overview.active,
            #admin-users.active,
            #admin-content.active,
            #admin-security.active,
            #admin-system.active,
            #admin-analytics.active,
            #admin-settings.active {
                display: block !important;
            }
        `;
        document.head.appendChild(adminStyle);

        // Initialize admin dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.location.hash === '#admin') {
                initializeAdminDashboard();
            }
            
            // Ensure overview tab is active by default when admin panel loads
            setTimeout(() => {
                const adminSection = document.getElementById('admin');
                if (adminSection && !adminSection.classList.contains('page-section')) {
                    // Admin panel is active, make sure overview tab is shown
                    const overviewTab = document.getElementById('admin-overview');
                    if (overviewTab) {
                        showAdminTab('overview');
                    }
                }
            }, 500);
        });

        // Add click event listeners as backup
        function addAdminTabListeners() {
            const tabButtons = document.querySelectorAll('.admin-tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const onclick = this.getAttribute('onclick');
                    if (onclick) {
                        const match = onclick.match(/showAdminTab\('(.+?)'\)/);
                        if (match) {
                            const tabName = match[1];
                            showAdminTab(tabName);
                            console.log(`🖱️ Tab clicked: ${tabName}`);
                        }
                    }
                });
            });
            console.log('🔧 Admin tab listeners added');
        }

        // Ensure addAdminTabListeners is available globally
        window.addAdminTabListeners = addAdminTabListeners;

        // Add functionality to all admin toggles and form elements
        function initializeAdminControls() {
            // Add event listeners to all toggle switches
            const toggles = document.querySelectorAll('#admin input[type="checkbox"]');
            toggles.forEach(toggle => {
                toggle.addEventListener('change', function() {
                    const container = this.closest('.flex');
                    const settingName = container?.querySelector('.text-white')?.textContent || 'Setting';
                    const isEnabled = this.checked;
                    
                    showAlert(`⚙️ ${settingName}: ${isEnabled ? 'Enabled' : 'Disabled'}`, 'info');
                    console.log(`🔧 Admin setting changed: ${settingName} = ${isEnabled}`);
                    
                    // Visual feedback
                    const description = container?.querySelector('.text-gray-400');
                    if (description) {
                        description.style.color = isEnabled ? '#6ee7b7' : '#9ca3af';
                        setTimeout(() => {
                            description.style.color = '#9ca3af';
                        }, 2000);
                    }
                });
            });
            
            // Add event listeners to form inputs
            const inputs = document.querySelectorAll('#admin input[type="text"], #admin textarea, #admin select');
            inputs.forEach(input => {
                input.addEventListener('change', function() {
                    const label = this.closest('div')?.querySelector('label')?.textContent || 'Setting';
                    showAlert(`📝 ${label} updated`, 'info');
                    console.log(`📝 Form field changed: ${label} = ${this.value}`);
                    
                    // Visual feedback
                    this.style.borderColor = '#14b8a6';
                    setTimeout(() => {
                        this.style.borderColor = '#6b7280';
                    }, 2000);
                });
            });
            
            console.log('🔧 Admin controls initialized');
        }

        // Real-time system metrics update
        function startLiveMetrics() {
            const metrics = [
                { id: 'cpu-usage', element: null, min: 45, max: 85 },
                { id: 'memory-usage', element: null, min: 30, max: 70 },
                { id: 'disk-usage', element: null, min: 75, max: 90 },
                { id: 'network-usage', element: null, min: 10, max: 50 }
            ];
            
            // Update metrics every 3 seconds
            setInterval(() => {
                metrics.forEach(metric => {
                    const randomValue = Math.floor(Math.random() * (metric.max - metric.min + 1)) + metric.min;
                    
                    // Update text values
                    const textElements = document.querySelectorAll('#admin-system .text-2xl');
                    textElements.forEach((el, index) => {
                        if (index < metrics.length) {
                            el.textContent = `${randomValue}%`;
                        }
                    });
                    
                    // Update progress bars
                    const progressBars = document.querySelectorAll('#admin-system .bg-blue-500, #admin-system .bg-green-500, #admin-system .bg-yellow-500, #admin-system .bg-purple-500');
                    progressBars.forEach((bar, index) => {
                        if (index < metrics.length) {
                            bar.style.width = `${randomValue}%`;
                        }
                    });
                });
            }, 3000);
            
            console.log('📊 Live metrics started');
        }

        // Enhanced auto-refresh for admin stats
        function startAutoRefresh() {
            setInterval(() => {
                const statsCards = document.querySelectorAll('#admin .text-4xl');
                if (statsCards.length >= 4) {
                    // Update Total Users
                    const currentUsers = parseInt(statsCards[0].textContent) || 247;
                    statsCards[0].textContent = currentUsers + Math.floor(Math.random() * 3);
                    
                    // Update System Health
                    const healthValue = 95 + Math.floor(Math.random() * 5);
                    if (statsCards[1]) statsCards[1].textContent = `${healthValue}.${Math.floor(Math.random() * 10)}%`;
                    
                    // Update Security Alerts (occasionally change)
                    if (Math.random() < 0.3) {
                        const alerts = Math.floor(Math.random() * 5);
                        if (statsCards[2]) statsCards[2].textContent = alerts;
                    }
                    
                    // Update Storage Used
                    const storage = 65 + Math.floor(Math.random() * 5);
                    if (statsCards[3]) statsCards[3].textContent = `${storage}%`;
                }
            }, 5000);
            
            console.log('🔄 Auto-refresh started');
        }
    </script>
</body>
</html>
